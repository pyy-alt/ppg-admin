import{i as _,r as s,b as $,j as e,B as G,y as T,aD as J,z as K,t as w,ad as Q}from"./index-Bkm0i40-.js";import{O as W}from"./OrganizationApi-M1CaO7zV.js";import{P as X}from"./PersonApi-BZdXp9je.js";import{C as Y,E as Z,a as ee,b as te,T as se,c as re,d as ae,D as ne}from"./clearable-input-CleWMoZm.js";import{T as oe,a as ie,b as D,c as E,d as ce,e as c}from"./table-t_A_f_TD.js";import{V as le}from"./ViewTeamDialog-CoFVDWax.js";import{S as p}from"./SortableTableHead-CcvqZgGb.js";import{D as de}from"./download-yrhL80Yv.js";import{S as ue}from"./search-BInq9IsI.js";import"./chevron-left-RM5v8unW.js";import"./chevron-right-C97o7tEJ.js";import"./input-DaKq_e4d.js";import"./x-CsoNbFna.js";import"./badge-MEVRXxP2.js";import"./dialog-DSGLXfvZ.js";import"./index-CnmrjRy4.js";import"./index-CN5U3HPo.js";import"./Combination-K-YKTF--.js";import"./index-BeLrdImO.js";import"./separator-Bthd58uT.js";import"./users-uvAbHv3x.js";import"./chevron-up-Ci4wS3K6.js";import"./chevron-down-Cduf7_rY.js";function me(){const{user:f}=_(t=>t.auth),[x,b]=s.useState(1),[u,O]=s.useState(""),[g,B]=s.useState([]),[N,k]=s.useState(0),[U,m]=s.useState(!1),l=20,I=Math.ceil(N/l),j=s.useRef(null),[R,M]=s.useState([]),[q,v]=s.useState(!1),[F,H]=s.useState([]),[n,P]=s.useState("dateLastSubmitted"),[o,y]=s.useState(!1),C=$(),A=async(t,a)=>{try{const i=new X,r=Q.create({type:t,organizationId:a}),d=T.create({resultsOrderBy:"firstName",resultsOrderAscending:!1});r.resultParameter=d,i.search(r,{status200:S=>{H(S.persons),v(!0)},error:S=>{},else:(S,he)=>{}})}catch{}},L=async()=>{if(f){m(!0);try{const t=new W,a={type:"Dealership",smartFilter:u||void 0},i=T.create({resultsLimitOffset:(x-1)*l,resultsLimitCount:l,resultsOrderBy:n,resultsOrderAscending:o});a.resultParameter=i;const r=J.create(a);t.search(r,{status200:d=>{B(d.organizations||[]),k(d.totalItemCount||0),m(!1)},error:d=>{m(!1)},status403:d=>{m(!1)}})}catch{m(!1)}}},h=t=>{n===t?o?(P("dateLastSubmitted"),y(!1)):y(!0):(P(t),y(!1)),b(1)};s.useEffect(()=>{if(!f)return;const t=setTimeout(()=>{L()},u?500:0);return()=>clearTimeout(t)},[u,x,f,n,o]),s.useEffect(()=>{b(1)},[u]);const z=()=>{const t=(x-1)*l,a=t+l;return g.slice(t,a).map(r=>({Name:r.name,Number:r.dealershipNumber,"# of Pending Orders":r.countPendingUsers||0,City:r.city||"--",State:r.state||"--","# of Active Users":r.countActiveUsers||0,"# of Pending Users":r.countPendingUsers||0}))},V=async()=>{try{const t=z();await K(t,R,"Manage_Dealers")&&w.success("Exported successfully")}catch{w.error("Export failed")}};return s.useEffect(()=>{if(j.current){const t=j.current.querySelectorAll("thead th"),a=Array.from(t).map(i=>i.textContent.trim());M(a)}},[g]),e.jsxs("div",{className:"bg-background min-h-screen",children:[e.jsxs("div",{className:"bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("h1",{className:"text-foreground text-2xl font-bold",children:"Manage Dealers"}),e.jsxs(G,{onClick:V,children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Report"]})]}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsx("div",{className:"mb-6 max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(Y,{value:u,onChange:t=>O(t.target.value),placeholder:"Filter by Name, #, City",className:"border-gray-300 pl-10"})]})}),U?e.jsx("div",{className:"bg-background overflow-hidden rounded-lg shadow-sm",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"loading..."})})}):g.length===0?e.jsx("div",{className:"bg-background overflow-hidden rounded-lg shadow-sm",children:e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsx(te,{variant:"icon",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(re,{children:"No data to display"}),e.jsx(ae,{children:"There are no records in this table yet. Add your first entry to get started."})]})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-background overflow-hidden rounded-lg shadow-sm",children:e.jsxs(oe,{ref:j,children:[e.jsx(ie,{children:e.jsxs(D,{className:"bg-muted",children:[e.jsx(p,{field:"name",currentSortBy:n,currentAscending:o,onSort:h,children:"Name"}),e.jsx(p,{field:"dealershipNumber",currentSortBy:n,currentAscending:o,onSort:h,children:"Number"}),e.jsx(p,{field:"countPendingOrders",currentSortBy:n,currentAscending:o,onSort:h,children:"# of Pending Orders"}),e.jsx(E,{children:"City"}),e.jsx(E,{children:"State"}),e.jsx(p,{field:"countActiveUsers",currentSortBy:n,currentAscending:o,onSort:h,children:"# of Active Users"}),e.jsx(p,{field:"countPendingUsers",currentSortBy:n,currentAscending:o,onSort:h,children:"# of Pending Users"})]})}),e.jsx(ce,{children:g.map(t=>e.jsxs(D,{className:"hover:bg-background",children:[e.jsx(c,{className:"cursor-pointer font-medium text-blue-600 hover:cursor-pointer hover:underline",onClick:()=>{C({to:"/parts_orders"})},children:t.name||"--"}),e.jsx(c,{children:t.dealershipNumber||"--"}),e.jsx(c,{className:"text-center font-medium text-blue-600 underline hover:cursor-pointer",onClick:()=>{C({to:"/repair_orders",search:{id:t.id.toString()}})},children:t.countPendingOrders??0}),e.jsx(c,{children:t.city||"--"}),e.jsx(c,{children:t.state||"--"}),e.jsx(c,{className:"text-center text-blue-600 underline hover:cursor-pointer",onClick:()=>{A("Dealership",t.id)},children:t.countActiveUsers??0}),e.jsx(c,{className:"text-center text-blue-600 underline hover:cursor-pointer",onClick:()=>{A("Dealership",t.id)},children:t.countPendingUsers??0})]},t.id))})]})}),e.jsx(ne,{currentPage:x,totalPages:I,totalItems:N,itemsPerPage:l,onPageChange:b})]})]})]}),e.jsx(le,{teamMembers:F,open:q,onOpenChange:v})]})}const Me=me;export{Me as component};
