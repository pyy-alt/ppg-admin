import{a as v,r as g,o as N,j as e,B as i,s as b,M}from"./index-BLoyOwMx.js";import{u as q,a as z,g as V,F as B,b as L,c as U,e as H,f as K}from"./form-Bv7oDV2N.js";import{u as X,U as Y}from"./index-u2uRDXMG.js";import{D as G,a as J,b as Q,c as W,d as Z}from"./dialog-Bc8KpLtT.js";import{I as D}from"./input-CT4loVds.js";import{L as o}from"./label-BkpQnFCu.js";import{S as p}from"./separator-BqvfaLvR.js";import{T as ee,a as se,b as re,c as te}from"./tooltip-CBRPLaFc.js";import{X as le}from"./x-BrS1Xc2W.js";import{T as oe}from"./trash-2-BqW1ygo0.js";import{P as ae}from"./plus-C4zipe18.js";import{T as ne}from"./triangle-alert-C8DJLGBA.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],h=v("package",me);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],ce=v("paperclip",de),ie=N({parts:M(N({number:b().min(1,"Part number is required")})),_estimateFile:b().optional()});function we({open:d,onOpenChange:f,initialData:s=null,mode:a="create",defaultDealership:y}){const[n,m]=g.useState([]),l=q({resolver:z(ie),defaultValues:{parts:[{number:""},{number:""},{number:""},{number:""}]}}),{fields:j,append:F,remove:w}=V({control:l.control,name:"parts"}),x=s?.partsOrderNumber!==void 0&&s.partsOrderNumber>0,P=s?.isAlternateDealer===!0,S=!s?.status||["CsrReview","DealershipProcessing"].includes(s.status),k=()=>{if(x){const r=s?.partsOrderNumber||1;return a==="edit"?`Edit Supplement #${r}`:`New Supplement #${r}`}else return a==="edit"?"Edit Parts Order":"New Parts Order"},O=()=>x?`Supplement #${s?.partsOrderNumber||1} Information`:"Parts Order Information",C=()=>a==="edit"&&S?"Update":"Save";g.useEffect(()=>{if(d&&s){const r=s.parts&&s.parts.length>0?s.parts.map(t=>({number:t})):[{number:""}];l.reset({parts:r.length>0?r:[{number:""}]}),m(s.estimateFiles||[])}else d&&a==="create"&&(l.reset({parts:[{number:""},{number:""},{number:""},{number:""}]}),m([]))},[d,s,a,l]);const T=r=>{if(n&&n.length===0&&(a==="create"||!s?.estimateFiles?.length)){l.setError("_estimateFile",{type:"manual",message:"Estimate PDF is required"});const t=document.querySelector("[data-estimate-error]");t&&t.scrollIntoView({behavior:"smooth",block:"center"});return}console.log("Submitted:",{mode:a,data:r,estimateFiles:n,isSupplement:x,partsOrderNumber:s?.partsOrderNumber}),f(!1)},{getRootProps:E,getInputProps:I,isDragActive:A}=X({accept:{"application/pdf":[".pdf"]},onDrop:r=>{m(t=>[...t,...r])}}),_=r=>{m(t=>t.filter((c,R)=>R!==r))},u=()=>{l.reset(),m([]),f(!1)},$=()=>P&&s?.alternateDealerName?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:[s.alternateDealerName,s.alternateDealerId&&` (${s.alternateDealerId})`]}),e.jsx(ee,{children:e.jsxs(se,{children:[e.jsx(re,{asChild:!0,children:e.jsx(ne,{className:"h-4 w-4 text-yellow-500"})}),e.jsx(te,{children:e.jsx("p",{children:"Ordered from an alternate dealer"})})]})})]}):e.jsx("p",{className:"font-medium",children:s?.orderFromDealership||y||"---"});return e.jsx(G,{open:d,onOpenChange:u,children:e.jsxs(J,{className:"flex max-h-[90vh] flex-col sm:max-w-4xl",children:[e.jsxs(Q,{className:"flex-shrink-0",children:[e.jsx(W,{className:"pr-10 text-2xl font-semibold",children:k()}),e.jsx(p,{}),e.jsxs("button",{onClick:u,className:"ring-offset-background focus:ring-ring absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsx(B,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(T),className:"flex min-h-0 flex-1 flex-col",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:[e.jsxs("section",{className:"mb-8",children:[e.jsxs("div",{className:"mb-5 flex items-center gap-3",children:[e.jsx(h,{className:"text-foreground h-5 w-5"}),e.jsx("h3",{className:"text-foreground text-lg font-semibold",children:"Repair Order Information"})]}),e.jsxs("div",{className:"bg-muted/50 grid grid-cols-1 gap-4 rounded-lg p-5 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-muted-foreground text-xs",children:"Shop RO #"}),e.jsx("p",{className:"font-medium",children:s?.shopRo||"---"})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-muted-foreground text-xs",children:"Order From Dealership"}),$()]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-muted-foreground text-xs",children:"Customer"}),e.jsx("p",{className:"font-medium",children:s?.customer||"---"})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-muted-foreground text-xs",children:"VIN"}),e.jsx("p",{className:"font-medium",children:s?.vin||"---"})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-muted-foreground text-xs",children:"Year/Make/Model"}),e.jsxs("p",{className:"font-medium",children:[s?.year||"---"," ",s?.make||"---"," ",s?.model||"---"]})]})]})]}),e.jsx(p,{className:"my-8"}),e.jsxs("section",{className:"mb-8",children:[e.jsxs("div",{className:"mb-5 flex items-center gap-3",children:[e.jsx(h,{className:"text-foreground h-5 w-5"}),e.jsx("h3",{className:"text-foreground text-lg font-semibold",children:O()})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-8 text-sm",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-muted-foreground",children:"Order Submitted"}),e.jsx("p",{className:"mt-1 font-medium",children:"---"})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-muted-foreground",children:"Order Approved"}),e.jsx("p",{className:"mt-1 font-medium",children:"---"})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-muted-foreground",children:"Order Shipped"}),e.jsx("p",{className:"mt-1 font-medium",children:"---"})]}),a==="edit"&&s?.salesOrderNumber&&e.jsxs("div",{children:[e.jsx(o,{className:"text-muted-foreground",children:"Sales Order #"}),e.jsx("p",{className:"mt-1 font-medium",children:s.salesOrderNumber})]})]})]}),e.jsx(p,{className:"my-8"}),e.jsxs("div",{className:"grid grid-cols-1 gap-12 md:grid-cols-2",children:[e.jsxs("section",{children:[e.jsxs("div",{className:"mb-5 flex items-center gap-3",children:[e.jsx(h,{className:"text-foreground h-5 w-5"}),e.jsx("h3",{className:"text-foreground text-lg font-semibold",children:"Requested Part Numbers"})]}),e.jsxs("div",{className:"space-y-4",children:[j.map((r,t)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-muted-foreground w-12 text-sm",children:["Part ",t+1]}),e.jsx(L,{control:l.control,name:`parts.${t}.number`,render:({field:c})=>e.jsxs(U,{className:"flex-1",children:[e.jsx(H,{children:e.jsx(D,{placeholder:"Enter part number",...c})}),e.jsx(K,{})]})}),j.length>1&&e.jsx(i,{type:"button",variant:"ghost",size:"icon",onClick:()=>w(t),children:e.jsx(oe,{className:"text-destructive h-4 w-4"})})]},r.id)),e.jsxs(i,{type:"button",variant:"outline",size:"sm",onClick:()=>F({number:""}),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"})," Add a Part"]})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"mb-5 flex items-center gap-3",children:[e.jsx(ce,{className:"text-foreground h-5 w-5"}),e.jsx("h3",{className:"text-foreground text-lg font-semibold",children:"Attachments"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(o,{className:"text-foreground text-sm font-medium",children:["Estimate",(a==="create"||!s?.estimateFiles?.length)&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{...E(),className:`flex cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed p-10 text-center transition-all ${A?"border-primary bg-muted":"border-border hover:border-primary"}`,children:[e.jsx("input",{...I()}),e.jsx(Y,{className:"text-muted-foreground mb-3 h-12 w-12"}),n&&n.length>0?e.jsxs("div",{className:"w-full space-y-2",children:[n.map((r,t)=>e.jsxs("div",{className:"bg-muted/50 flex items-center justify-between rounded-md border p-2",children:[e.jsxs("div",{className:"flex-1 truncate",title:r.name,children:[e.jsx("p",{className:"text-foreground truncate text-sm font-medium",children:r.name}),e.jsxs("p",{className:"text-muted-foreground text-xs",children:[(r.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{type:"button",onClick:c=>{c.stopPropagation(),_(t)},className:"text-destructive ml-2 text-xs hover:underline",children:"Remove"})]},`${r.name}-${t}`)),e.jsxs("p",{className:"text-muted-foreground mt-2 text-xs",children:["Drop more PDF files here or"," ",e.jsx("span",{className:"text-primary hover:underline",children:"click to browse"})]})]}):e.jsxs("p",{className:"text-muted-foreground text-sm",children:["Drop your PDF files here or"," ",e.jsx("span",{className:"text-primary hover:underline",children:"click to browse"})]})]}),l.formState.errors._estimateFile&&e.jsx("p",{className:"text-destructive text-sm",children:l.formState.errors._estimateFile.message})]})]})]})]}),e.jsx(Z,{className:"bg-muted/50 flex-shrink-0 border-t px-6 py-4 backdrop-blur",children:e.jsxs("div",{className:"flex w-full justify-end gap-3",children:[e.jsx(i,{type:"button",variant:"outline",onClick:u,children:"Cancel"}),e.jsx(i,{type:"submit",variant:"default",children:C()})]})})]})})]})})}export{we as P};
