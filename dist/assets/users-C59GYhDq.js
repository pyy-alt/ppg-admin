import{r as i,K as O,h as Z,aa as oe,j as e,B as U,ag as le,aK as z,t as g,Z as ie,a3 as ce,M as D,aL as X,ac as de,w as me}from"./index-DiI2ffAh.js";import{P as J}from"./PersonApi-CgbCoTOu.js";import{C as Q}from"./checkbox-DnhwHROs.js";import{E as xe,a as fe,b as ue,T as he,c as ge,d as je,D as pe}from"./data-table-pagination-BYSKvq0r.js";import{u as Ne,a as ve,i as be,F as Se,b as C,c as w,d as F,e as A,f as E,L as H}from"./form-BztM4JIr.js";import{S as G,a as K,b as W,c as _,d as j}from"./select-BfIdXsKN.js";import{T as ye,a as Re,b as Y,c as p,d as Ce,e as N}from"./table-DfggTbkb.js";import{u as we}from"./use-dialog-with-confirm-Cryg7EXi.js";import{D as Fe,a as Ae,b as Pe,c as Ie,e as ke}from"./dialog-BfbMbQ8-.js";import{I as L}from"./input-anrjtq5m.js";import{R as De,a as Te}from"./radio-group-B3DdS3ys.js";import{S as Ee}from"./separator-unOUWFl-.js";import{X as V}from"./x-DoFJH5Nd.js";import{P as Le}from"./plus-DWHwyz7k.js";import{S as Ue}from"./search-Dee6z3yd.js";import{P as Be}from"./pencil-Cb2doz10.js";import"./index-B9OW1ajA.js";import"./index-I18K8_cQ.js";import"./index-lW_6OgVn.js";import"./check-Ca0fbDYF.js";import"./chevron-left-CVoIS1tR.js";import"./chevron-right-B2dPWAbi.js";import"./index-DHosPbdR.js";import"./index-BesrJGlS.js";import"./Combination-D_vfDq5J.js";import"./index-B0ORnztA.js";import"./chevron-down-kGCTDs5u.js";import"./confirm-dialog-CtLfmpMe.js";import"./index-qMrSr97y.js";import"./index-DTR4e_QT.js";function Me(l,c,n=500){const u=i.useRef(!0);i.useEffect(()=>{if(u.current){u.current=!1,l();return}const h=setTimeout(()=>{l()},n);return()=>{clearTimeout(h)}},[...c,n])}const qe=O({firstName:D().min(1,"First name is required"),lastName:D().min(1,"Last name is required"),email:D().email("Invalid email address"),role:ce(["ProgramAdministrator","Csr","FieldStaff"]).optional().refine(l=>l!==void 0,{message:"Please select a role"}),csrRegion:O({id:X(),name:D()}).optional(),fieldStaffRegions:ie(O({id:X(),name:D()})).optional()});function Oe({open:l,onOpenChange:c,initialValues:n,onSuccess:u,onError:h}){const a=Ne({resolver:ve(qe),defaultValues:{firstName:"",lastName:"",email:"",role:void 0,csrRegion:void 0,fieldStaffRegions:[]}}),v=Z(t=>t.auth.user?.regions||[]);i.useEffect(()=>{n&&l?a.reset({firstName:n.firstName||"",lastName:n.lastName||"",email:n.email||"",role:n.type,csrRegion:n.csrRegion,fieldStaffRegions:n.fieldStaffRegions}):!n&&l&&a.reset({firstName:"",lastName:"",email:"",role:void 0,csrRegion:void 0,fieldStaffRegions:[]})},[n,l,a]);const S=be({control:a.control,name:"role"}),P=S==="FieldStaff",B=S==="Csr",{handleCloseRequest:y,ConfirmDialogComponent:M}=we({form:a,onClose:()=>{a.reset(),c(!1)},title:"Discard Changes?",description:"You have unsaved changes. Are you sure you want to close? All your changes will be lost."}),R=async t=>{try{const r=le.create({firstName:t.firstName,lastName:t.lastName,email:t.email,type:t.role,id:n?.id||void 0,csrRegion:t.csrRegion?z.create({id:t.csrRegion.id,name:t.csrRegion.name}):void 0,fieldStaffRegions:t.fieldStaffRegions?t.fieldStaffRegions.map(o=>z.create(o)):[]}),d=new J;await new Promise(o=>{n?d.edit(r,{status200:m=>{u?.(m),g.success("User updated successfully",{position:"top-right"}),c(!1),a.reset(),o(!0)},error:m=>{h?.(m),o(!1)},else:(m,k)=>{g.error(k),o(!1)}}):d.createNetworkUser(r,{status200:m=>{u?.(m),g.success("User created successfully",{position:"top-right"}),c(!1),a.reset(),o(!0)},error:m=>{h?.(m),o(!1)},else:()=>{o(!1)}})})}catch(r){throw h?.(r),r}},I=t=>{t?c(!0):y()};i.useEffect(()=>{S&&(a.setValue("csrRegion",void 0),a.setValue("fieldStaffRegions",[]))},[S,a]);const{t:x}=oe();return e.jsxs(e.Fragment,{children:[e.jsx(Fe,{open:l,onOpenChange:I,children:e.jsxs(Ae,{className:"sm:max-w-lg",children:[e.jsxs(Pe,{className:"shrink-0",children:[e.jsx(Ie,{className:"px-6 py-4 text-2xl font-semibold",children:n?"Edit Network User":"Add Network User"}),e.jsx(Ee,{}),e.jsxs("button",{onClick:()=>I(!1),className:"ring-offset-background focus:ring-ring absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsx(Se,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(R),className:"grid gap-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsx(C,{control:a.control,name:"firstName",render:({field:t})=>e.jsxs(w,{children:[e.jsx(F,{children:x("user.firstName")}),e.jsx(A,{children:e.jsx(L,{placeholder:"Enter first name",...t})}),e.jsx(E,{})]})}),e.jsx(C,{control:a.control,name:"lastName",render:({field:t})=>e.jsxs(w,{children:[e.jsx(F,{children:"Last Name"}),e.jsx(A,{children:e.jsx(L,{placeholder:"Enter last name",...t})}),e.jsx(E,{})]})})]}),e.jsx(C,{control:a.control,name:"email",render:({field:t})=>e.jsxs(w,{children:[e.jsx(F,{children:"Email Address"}),e.jsx(A,{children:e.jsx(L,{type:"email",placeholder:"user@vwgoa.com",...t})}),e.jsx(E,{})]})}),e.jsx(C,{control:a.control,name:"role",render:({field:t})=>e.jsxs(w,{children:[e.jsx(F,{children:"Role"}),e.jsxs(G,{onValueChange:t.onChange,value:t.value,children:[e.jsx(A,{className:"w-full",children:e.jsx(K,{children:e.jsx(W,{placeholder:"Select role"})})}),e.jsxs(_,{children:[e.jsx(j,{value:"ProgramAdministrator",children:"Admin"}),e.jsx(j,{value:"Csr",children:"CSR"}),e.jsx(j,{value:"FieldStaff",children:"Field Staff"})]})]}),e.jsx(E,{})]})}),P&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(H,{children:"Field Staff Region(s))"}),e.jsx("div",{className:"bg-muted space-y-3 rounded-md border p-4",children:v.map(t=>e.jsx(C,{control:a.control,name:"fieldStaffRegions",render:({field:r})=>e.jsxs(w,{className:"flex items-center space-x-3",children:[e.jsx(A,{children:e.jsx(Q,{checked:r.value?.some(d=>d.id===t.id),onCheckedChange:d=>{const o=d?[...r.value||[],{id:t.id,name:t.name}]:(r.value||[]).filter(m=>m.id!==t.id);r.onChange(o)}})}),e.jsx(F,{className:"cursor-pointer font-normal",children:t.name})]})},t.id))})]}),B&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(H,{children:"CSR Region"}),e.jsx("div",{className:"bg-muted space-y-3 rounded-md border p-4",children:e.jsx(C,{control:a.control,name:"csrRegion",render:({field:t})=>e.jsx(De,{value:t.value?.id?.toString()||"",onValueChange:r=>{const d=v.find(o=>o.id?.toString()===r);t.onChange(d?{id:d.id,name:d.name}:void 0)},children:v.map(r=>e.jsxs(w,{className:"flex items-center space-y-0 space-x-3",children:[e.jsx(A,{children:e.jsx(Te,{value:r.id?.toString()||"",id:r.id?.toString()||""})}),e.jsx(F,{htmlFor:r.id?.toString()||"",className:"cursor-pointer font-normal",children:r.name})]},r.id))})})})]}),e.jsxs(ke,{className:"mt-4 gap-3 pt-4",children:[e.jsx(U,{type:"button",variant:"outline",onClick:()=>I(!1),children:x("common.cancel")}),e.jsx(U,{type:"submit",variant:"default",disabled:a.formState.isSubmitting,children:n?a.formState.isSubmitting?x("common.submiting"):x("common.submit"):a.formState.isSubmitting?x("common.creating"):x("common.create")})]})]})})]})}),M," "]})}function He({value:l,onChange:c,className:n,...u}){const h=()=>{if(!c)return;c({target:{value:""}})},a=typeof l=="string"&&l.length>0;return e.jsxs("div",{className:"relative flex-1",children:[e.jsx(L,{...u,value:l,onChange:c,className:`${n??""} pr-8`}),a&&e.jsx(U,{type:"button",variant:"ghost",size:"icon",className:"absolute top-1/2 right-1 h-5 w-5 -translate-y-1/2 rounded-full hover:bg-muted",onClick:h,children:e.jsx(V,{className:"h-3 w-3 text-muted-foreground"})})]})}function Ge(){const[l,c]=i.useState(!1),[n,u]=i.useState([]),[h,a]=i.useState(null),[v,S]=i.useState(0),[P,B]=i.useState(1),y=20,M=Math.ceil(v/y),[R,I]=i.useState(""),[x,t]=i.useState(void 0),[r,d]=i.useState(!1),[o,m]=i.useState("all"),k=Z(s=>s.auth.user?.regions||[]),q=i.useMemo(()=>o==="all"?void 0:Number(o),[o]),ee=i.useMemo(()=>{if(o==="all"||!o)return null;const s=k.find(f=>f.id===Number(o));return s&&s.id!==void 0&&s.name?{id:s.id,name:s.name}:null},[o,k]),$=(s="",f=!1,te,ae,re=1)=>{try{const b=de.create({smartFilter:s,includeInactiveFlag:f,type:"Network",filterByRegionId:te,filterByNetworkRole:ae}),ne=me.create({resultsLimitOffset:(re-1)*y,resultsLimitCount:y,resultsOrderBy:"dateLastAccess",resultsOrderAscending:!1});b.resultParameter=ne,new J().search(b,{status200:T=>{u(T.persons),S(T.totalItemCount)},error:T=>{g.error(T.message)}})}catch(b){b&&typeof b=="object"&&"message"in b?g.error(b.message):g.error("An unexpected error occurred")}},se=s=>{try{a(s),c(!0)}catch(f){f&&typeof f=="object"&&"message"in f?g.error(f.message):g.error("An unexpected error occurred")}};return Me(()=>{$(R,r,q,x,P)},[R,r,q,x,P],1e3),e.jsxs("div",{className:"bg-background text-foreground min-h-screen",children:[e.jsx("div",{className:"bg-background border-b",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("h1",{className:"text-foreground text-2xl font-bold",children:"Manage Network Users"}),e.jsxs(U,{onClick:()=>{a(null),c(!0)},children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),"Add New User"]})]})}),e.jsx(Oe,{open:l,onOpenChange:c,initialValues:h,filterByRegion:ee,onSuccess:()=>{$(R,r,q,x)},onError:s=>{g.error(s.message)}}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 lg:flex-row lg:items-center",children:[e.jsxs("div",{className:"relative max-w-md flex-1",children:[e.jsx(Ue,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(He,{placeholder:"Filter by First Name, Last Name, Email",value:R,onChange:s=>I(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(G,{value:x??"all",onValueChange:s=>t(s==="all"?void 0:s),children:[e.jsx(K,{className:"bg-muted w-48",children:e.jsx(W,{placeholder:"Role"})}),e.jsxs(_,{children:[e.jsx(j,{value:"all",children:"All Roles"}),e.jsx(j,{value:"Csr",children:"Csr"}),e.jsx(j,{value:"FieldStaff",children:"FieldStaff"}),e.jsx(j,{value:"ProgramAdministrator",children:"ProgramAdministrator"})]})]}),e.jsxs(G,{value:o,onValueChange:m,children:[e.jsx(K,{className:"bg-muted w-48",children:e.jsx(W,{placeholder:"CSR Region"})}),e.jsxs(_,{children:[e.jsx(j,{value:"all",children:"All Regions"}),k.map(s=>e.jsx(j,{value:String(s.id),children:s.name},s.id))]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"rounded-full",id:"show-inactive",onCheckedChange:s=>d(s)}),e.jsx(H,{htmlFor:"show-inactive",className:"cursor-pointer text-sm font-medium",children:"Show Inactive Users"})]})]})]}),n.length===0?e.jsx("div",{children:e.jsx(xe,{children:e.jsxs(fe,{children:[e.jsx(ue,{variant:"icon",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(ge,{children:"No data to display"}),e.jsx(je,{children:"There are no records in this table yet. Add your first entry to get started."})]})})}):e.jsxs("div",{children:[e.jsx("div",{className:"bg-background overflow-hidden rounded-lg border shadow-sm",children:e.jsxs(ye,{children:[e.jsx(Re,{children:e.jsxs(Y,{className:"bg-muted",children:[e.jsx(p,{className:"text-foreground font-semibold",children:"First Name"}),e.jsx(p,{className:"text-foreground font-semibold",children:"Last Name"}),e.jsx(p,{className:"text-foreground font-semibold",children:"Email"}),e.jsx(p,{className:"text-foreground font-semibold",children:"Role"}),e.jsx(p,{className:"text-foreground font-semibold",children:"Region"}),e.jsx(p,{className:"text-foreground font-semibold",children:"Date Added"}),e.jsx(p,{className:"text-foreground font-semibold",children:"Date Last Accessed"}),e.jsx(p,{className:"text-foreground font-semibold",children:"Status"})]})}),e.jsx(Ce,{children:n.map(s=>e.jsxs(Y,{className:"hover:bg-background",children:[e.jsx(N,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-1",onClick:()=>se(s),children:[e.jsx(Be,{className:"h-4 w-4 hover:underline"}),e.jsx("span",{className:s.status==="Pending"?"cursor-pointer text-orange-600 hover:underline":s.status==="Inactive"?"text-gray-300":"text-foreground cursor-pointer hover:underline",children:s.firstName})]})}),e.jsx(N,{className:s.status==="Inactive"?"text-gray-300":s.status==="Pending"?"text-orange-600":"",children:s.lastName}),e.jsx(N,{className:"text-sm",children:s.status==="Inactive"?e.jsx("span",{className:"text-gray-300",children:s.email}):s.email}),e.jsx(N,{children:s.status==="Inactive"?e.jsx("span",{className:"text-gray-300",children:s.type}):s.type}),e.jsx(N,{className:s.status==="Inactive"?"text-gray-300":"",children:s.type==="Csr"?s.csrRegion?.name||"--":s.type==="FieldStaff"?s.fieldStaffRegions?.map(f=>f.name).join(", ")||"--":s.type==="ProgramAdministrator"?"All Regions":"--"}),e.jsx(N,{children:s.status==="Inactive"?e.jsx("span",{className:"text-gray-300",children:s.dateCreated&&new Date(s.dateCreated).toLocaleDateString()||"--"}):s.dateCreated&&new Date(s.dateCreated).toLocaleDateString()||"--"}),e.jsx(N,{className:s.status==="Inactive"?"text-gray-300":s.status==="Pending"?"text-orange-600":"",children:s.dateLastAccess&&new Date(s.dateLastAccess).toLocaleDateString()||"--"}),e.jsx(N,{children:s.status==="Inactive"?e.jsx("span",{className:"text-gray-300",children:s.status}):e.jsx("span",{children:s.status})})]},s.email))})]})}),e.jsx(pe,{currentPage:P,totalPages:M,totalItems:v,itemsPerPage:y,onPageChange:B})]})]})]})}const vs=Ge;export{vs as component};
