import{r as i,Q as M,i as J,ac as oe,j as e,B as O,ah as ne,aL as Y,t as u,a0 as ie,a5 as le,S as D,aM as $,ad as ce,y as de}from"./index-Bkm0i40-.js";import{P as K}from"./PersonApi-BZdXp9je.js";import{C as Z}from"./checkbox-s4dkUmJo.js";import{C as me,E as xe,a as fe,b as ue,T as he,c as ge,d as pe,D as je}from"./clearable-input-CleWMoZm.js";import{L as H}from"./label-BN8Qe8K3.js";import{S as G,a as W,b as _,c as Q,d as h}from"./select-CXq6ZKY2.js";import{T as Ne,a as ve,b as z,c as g,d as be,e as p}from"./table-t_A_f_TD.js";import{u as Se,a as ye,i as Re,F as Ce,b as C,c as w,d as F,e as P,f as U}from"./form-FwhVnNbA.js";import{u as we}from"./use-dialog-with-confirm-aTOHhxte.js";import{D as Fe,a as Pe,b as Ae,c as Ie,e as ke}from"./dialog-DSGLXfvZ.js";import{I as q}from"./input-DaKq_e4d.js";import{R as De,a as Ee}from"./radio-group-CLhQPRck.js";import{S as Te}from"./separator-Bthd58uT.js";import{X as Le}from"./x-CsoNbFna.js";import{P as Ue}from"./plus-BIUHcGpT.js";import{S as Be}from"./search-BInq9IsI.js";import{P as Me}from"./pencil-f03JEi-E.js";import"./index-CnmrjRy4.js";import"./index-Dti7BYom.js";import"./index-B51CDgwY.js";import"./index-BeLrdImO.js";import"./check-BRFXV1aI.js";import"./chevron-left-RM5v8unW.js";import"./chevron-right-C97o7tEJ.js";import"./index-ChYaYNrd.js";import"./index-Dt-JkpPh.js";import"./Combination-K-YKTF--.js";import"./index-CN5U3HPo.js";import"./index-CM-w1TYN.js";import"./chevron-down-Cduf7_rY.js";import"./chevron-up-Ci4wS3K6.js";import"./confirm-dialog-BSEgRwpb.js";import"./index-C9L9NCNz.js";import"./index-tCO809zo.js";function qe(m,x,n=500){const j=i.useRef(!0);i.useEffect(()=>{if(j.current){j.current=!1,m();return}const N=setTimeout(()=>{m()},n);return()=>{clearTimeout(N)}},[...x,n])}const Oe=M({firstName:D().min(1,"First name is required"),lastName:D().min(1,"Last name is required"),email:D().email("Invalid email address"),role:le(["ProgramAdministrator","Csr","FieldStaff"]).optional().refine(m=>m!==void 0,{message:"Please select a role"}),csrRegion:M({id:$(),name:D()}).optional(),fieldStaffRegions:ie(M({id:$(),name:D()})).optional()});function He({open:m,onOpenChange:x,initialValues:n,onSuccess:j,onError:N}){const a=Se({resolver:ye(Oe),defaultValues:{firstName:"",lastName:"",email:"",role:void 0,csrRegion:void 0,fieldStaffRegions:[]}}),S=J(t=>t.auth.user?.regions||[]);i.useEffect(()=>{n&&m?a.reset({firstName:n.firstName||"",lastName:n.lastName||"",email:n.email||"",role:n.type,csrRegion:n.csrRegion,fieldStaffRegions:n.fieldStaffRegions}):!n&&m&&a.reset({firstName:"",lastName:"",email:"",role:void 0,csrRegion:void 0,fieldStaffRegions:[]})},[n,m,a]);const y=Re({control:a.control,name:"role"}),A=y==="FieldStaff",E=y==="Csr",{handleCloseRequest:R,ConfirmDialogComponent:B}=we({form:a,onClose:()=>{a.reset(),x(!1)},title:"Discard Changes?",description:"You have unsaved changes. Are you sure you want to close? All your changes will be lost."}),v=async t=>{try{const r=ne.create({firstName:t.firstName,lastName:t.lastName,email:t.email,type:t.role,id:n?.id||void 0,csrRegion:t.csrRegion?Y.create({id:t.csrRegion.id,name:t.csrRegion.name}):void 0,fieldStaffRegions:t.fieldStaffRegions?t.fieldStaffRegions.map(o=>Y.create(o)):[]}),c=new K;await new Promise(o=>{n?c.edit(r,{status200:d=>{j?.(d),u.success("User updated successfully",{position:"top-right"}),x(!1),a.reset(),o(!0)},error:d=>{N?.(d),o(!1)},else:(d,k)=>{u.error(k),o(!1)}}):c.createNetworkUser(r,{status200:d=>{j?.(d),u.success("User created successfully",{position:"top-right"}),x(!1),a.reset(),o(!0)},error:d=>{N?.(d),o(!1)},else:()=>{o(!1)}})})}catch(r){throw N?.(r),r}},I=t=>{t?x(!0):R()};i.useEffect(()=>{y&&(a.setValue("csrRegion",void 0),a.setValue("fieldStaffRegions",[]))},[y,a]);const{t:l}=oe();return e.jsxs(e.Fragment,{children:[e.jsx(Fe,{open:m,onOpenChange:I,children:e.jsxs(Pe,{className:"sm:max-w-lg",children:[e.jsxs(Ae,{className:"shrink-0",children:[e.jsx(Ie,{className:"px-6 py-4 text-2xl font-semibold",children:n?"Edit Network User":"Add Network User"}),e.jsx(Te,{}),e.jsxs("button",{onClick:()=>I(!1),className:"ring-offset-background focus:ring-ring absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsx(Ce,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(v),className:"grid gap-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsx(C,{control:a.control,name:"firstName",render:({field:t})=>e.jsxs(w,{children:[e.jsx(F,{children:l("user.firstName")}),e.jsx(P,{children:e.jsx(q,{placeholder:"Enter first name",...t})}),e.jsx(U,{})]})}),e.jsx(C,{control:a.control,name:"lastName",render:({field:t})=>e.jsxs(w,{children:[e.jsx(F,{children:"Last Name"}),e.jsx(P,{children:e.jsx(q,{placeholder:"Enter last name",...t})}),e.jsx(U,{})]})})]}),e.jsx(C,{control:a.control,name:"email",render:({field:t})=>e.jsxs(w,{children:[e.jsx(F,{children:"Email Address"}),e.jsx(P,{children:e.jsx(q,{type:"email",placeholder:"user@vwgoa.com",...t})}),e.jsx(U,{})]})}),e.jsx(C,{control:a.control,name:"role",render:({field:t})=>e.jsxs(w,{children:[e.jsx(F,{children:"Role"}),e.jsxs(G,{onValueChange:t.onChange,value:t.value,children:[e.jsx(P,{className:"w-full",children:e.jsx(W,{children:e.jsx(_,{placeholder:"Select role"})})}),e.jsxs(Q,{children:[e.jsx(h,{value:"ProgramAdministrator",children:"Admin"}),e.jsx(h,{value:"Csr",children:"CSR"}),e.jsx(h,{value:"FieldStaff",children:"Field Staff"})]})]}),e.jsx(U,{})]})}),A&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(H,{children:"Field Staff Region(s))"}),e.jsx("div",{className:"bg-muted space-y-3 rounded-md border p-4",children:S.map(t=>e.jsx(C,{control:a.control,name:"fieldStaffRegions",render:({field:r})=>e.jsxs(w,{className:"flex items-center space-x-3",children:[e.jsx(P,{children:e.jsx(Z,{checked:r.value?.some(c=>c.id===t.id),onCheckedChange:c=>{const o=c?[...r.value||[],{id:t.id,name:t.name}]:(r.value||[]).filter(d=>d.id!==t.id);r.onChange(o)}})}),e.jsx(F,{className:"cursor-pointer font-normal",children:t.name})]})},t.id))})]}),E&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(H,{children:"CSR Region"}),e.jsx("div",{className:"bg-muted space-y-3 rounded-md border p-4",children:e.jsx(C,{control:a.control,name:"csrRegion",render:({field:t})=>e.jsx(De,{value:t.value?.id?.toString()||"",onValueChange:r=>{const c=S.find(o=>o.id?.toString()===r);t.onChange(c?{id:c.id,name:c.name}:void 0)},children:S.map(r=>e.jsxs(w,{className:"flex items-center space-y-0 space-x-3",children:[e.jsx(P,{children:e.jsx(Ee,{value:r.id?.toString()||"",id:r.id?.toString()||""})}),e.jsx(F,{htmlFor:r.id?.toString()||"",className:"cursor-pointer font-normal",children:r.name})]},r.id))})})})]}),e.jsxs(ke,{className:"mt-4 gap-3 pt-4",children:[e.jsx(O,{type:"button",variant:"outline",onClick:()=>I(!1),children:l("common.cancel")}),e.jsx(O,{type:"submit",variant:"default",disabled:a.formState.isSubmitting,children:n?a.formState.isSubmitting?l("common.submiting"):l("common.submit"):a.formState.isSubmitting?l("common.creating"):l("common.create")})]})]})})]})}),B," "]})}function Ge(){const[m,x]=i.useState(!1),[n,j]=i.useState([]),[N,a]=i.useState(null),[S,y]=i.useState(0),[A,E]=i.useState(1),R=20,B=Math.ceil(S/R),[v,I]=i.useState(""),[l,t]=i.useState(void 0),[r,c]=i.useState(!1),[o,d]=i.useState("all"),k=J(s=>s.auth.user?.regions||[]),T=i.useMemo(()=>o==="all"?void 0:Number(o),[o]),V=i.useMemo(()=>{if(o==="all"||!o)return null;const s=k.find(f=>f.id===Number(o));return s&&s.id!==void 0&&s.name?{id:s.id,name:s.name}:null},[o,k]),X=(s="",f=!1,se,te,ae=1)=>{try{const b=ce.create({smartFilter:s,includeInactiveFlag:f,type:"Network",filterByRegionId:se,filterByNetworkRole:te}),re=de.create({resultsLimitOffset:(ae-1)*R,resultsLimitCount:R,resultsOrderBy:"dateLastAccess",resultsOrderAscending:!1});b.resultParameter=re,new K().search(b,{status200:L=>{j(L.persons),y(L.totalItemCount)},error:L=>{u.error(L.message)}})}catch(b){b&&typeof b=="object"&&"message"in b?u.error(b.message):u.error("An unexpected error occurred")}},ee=s=>{try{a(s),x(!0)}catch(f){f&&typeof f=="object"&&"message"in f?u.error(f.message):u.error("An unexpected error occurred")}};return qe(()=>{X(v,r,T,l,A)},[v,r,T,l,A],1e3),i.useEffect(()=>{E(1)},[v,r,T,l]),e.jsxs("div",{className:"bg-background text-foreground min-h-screen",children:[e.jsx("div",{className:"bg-background border-b",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("h1",{className:"text-foreground text-2xl font-bold",children:"Manage Network Users"}),e.jsxs(O,{onClick:()=>{a(null),x(!0)},children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),"Add New User"]})]})}),e.jsx(He,{open:m,onOpenChange:x,initialValues:N,filterByRegion:V,onSuccess:()=>{X(v,r,T,l)},onError:s=>{u.error(s.message)}}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 lg:flex-row lg:items-center",children:[e.jsxs("div",{className:"relative max-w-md flex-1",children:[e.jsx(Be,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(me,{placeholder:"Filter by First Name, Last Name, Email",value:v,onChange:s=>I(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(G,{value:l??"all",onValueChange:s=>t(s==="all"?void 0:s),children:[e.jsx(W,{className:"bg-muted w-48",children:e.jsx(_,{placeholder:"Role"})}),e.jsxs(Q,{children:[e.jsx(h,{value:"all",children:"All Roles"}),e.jsx(h,{value:"Csr",children:"Csr"}),e.jsx(h,{value:"FieldStaff",children:"Field Staff"}),e.jsx(h,{value:"ProgramAdministrator",children:"Program Administrator"})]})]}),e.jsxs(G,{value:o,onValueChange:d,children:[e.jsx(W,{className:"bg-muted w-48",children:e.jsx(_,{placeholder:"CSR Region"})}),e.jsxs(Q,{children:[e.jsx(h,{value:"all",children:"All Regions"}),k.map(s=>e.jsx(h,{value:String(s.id),children:s.name},s.id))]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"rounded-full",id:"show-inactive",onCheckedChange:s=>c(s)}),e.jsx(H,{htmlFor:"show-inactive",className:"cursor-pointer text-sm font-medium",children:"Show Inactive Users"})]})]})]}),n.length===0?e.jsx("div",{children:e.jsx(xe,{children:e.jsxs(fe,{children:[e.jsx(ue,{variant:"icon",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(ge,{children:"No data to display"}),e.jsx(pe,{children:"No results could be found."})]})})}):e.jsxs("div",{children:[e.jsx("div",{className:"bg-background overflow-hidden rounded-lg border shadow-sm",children:e.jsxs(Ne,{children:[e.jsx(ve,{children:e.jsxs(z,{className:"bg-muted",children:[e.jsx(g,{className:"text-foreground font-semibold",children:"First Name"}),e.jsx(g,{className:"text-foreground font-semibold",children:"Last Name"}),e.jsx(g,{className:"text-foreground font-semibold",children:"Email"}),e.jsx(g,{className:"text-foreground font-semibold",children:"Role"}),e.jsx(g,{className:"text-foreground font-semibold",children:"Region"}),e.jsx(g,{className:"text-foreground font-semibold",children:"Date Added"}),e.jsx(g,{className:"text-foreground font-semibold",children:"Date Last Accessed"}),e.jsx(g,{className:"text-foreground font-semibold",children:"Status"})]})}),e.jsx(be,{children:n.map(s=>e.jsxs(z,{className:"hover:bg-background",children:[e.jsx(p,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-1",onClick:()=>ee(s),children:[e.jsx(Me,{className:"h-4 w-4 hover:underline"}),e.jsx("span",{className:s.status==="Pending"?"cursor-pointer text-orange-600 hover:underline":s.status==="Inactive"?"text-gray-400":"text-foreground cursor-pointer hover:underline",children:s.firstName})]})}),e.jsx(p,{className:s.status==="Inactive"?"text-gray-400":s.status==="Pending"?"text-orange-600":"",children:s.lastName}),e.jsx(p,{className:"text-sm",children:s.status==="Inactive"?e.jsx("span",{className:"text-gray-400",children:s.email}):s.email}),e.jsx(p,{children:s.status==="Inactive"?e.jsx("span",{className:"text-gray-400",children:s.type}):s.type}),e.jsx(p,{className:s.status==="Inactive"?"text-gray-400":"",children:s.type==="Csr"?s.csrRegion?.name||"--":s.type==="FieldStaff"?s.fieldStaffRegions?.map(f=>f.name).join(", ")||"--":s.type==="ProgramAdministrator"?"All Regions":"--"}),e.jsx(p,{children:s.status==="Inactive"?e.jsx("span",{className:"text-gray-400",children:s.dateCreated&&new Date(s.dateCreated).toLocaleDateString()||"--"}):s.dateCreated&&new Date(s.dateCreated).toLocaleDateString()||"--"}),e.jsx(p,{className:s.status==="Inactive"?"text-gray-400":s.status==="Pending"?"text-orange-600":"",children:s.dateLastAccess&&new Date(s.dateLastAccess).toLocaleDateString()||"Pending Registration"}),e.jsx(p,{children:s.status==="Inactive"?e.jsx("span",{className:"text-gray-400",children:s.status}):e.jsx("span",{children:s.status})})]},s.email))})]})}),e.jsx(je,{currentPage:A,totalPages:B,totalItems:S,itemsPerPage:R,onPageChange:E})]})]})]})}const Rs=Ge;export{Rs as component};
