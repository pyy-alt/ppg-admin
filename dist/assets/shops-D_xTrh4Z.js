import{i as se,r,b as re,j as e,B as ae,y as F,aD as ne,z as ie,t as H,ad as le}from"./index-Bkm0i40-.js";import{O as oe}from"./OrganizationApi-M1CaO7zV.js";import{P as ce}from"./PersonApi-BZdXp9je.js";import{B as de}from"./badge-MEVRXxP2.js";import{C as ue,E as me,a as he,b as xe,T as fe,c as ge,d as pe,D as je}from"./clearable-input-CleWMoZm.js";import{S as B,a as T,b as w,c as D,d as o}from"./select-CXq6ZKY2.js";import{T as Se,a as be,b as M,c as v,d as ye,e as n}from"./table-t_A_f_TD.js";import{V as Ne}from"./ViewTeamDialog-CoFVDWax.js";import{S as u}from"./SortableTableHead-CcvqZgGb.js";import{D as ve}from"./download-yrhL80Yv.js";import{S as Ce}from"./search-BInq9IsI.js";import"./chevron-left-RM5v8unW.js";import"./chevron-right-C97o7tEJ.js";import"./input-DaKq_e4d.js";import"./x-CsoNbFna.js";import"./index-ChYaYNrd.js";import"./index-CnmrjRy4.js";import"./index-Dt-JkpPh.js";import"./Combination-K-YKTF--.js";import"./index-CN5U3HPo.js";import"./index-CM-w1TYN.js";import"./index-B51CDgwY.js";import"./index-Dti7BYom.js";import"./chevron-down-Cduf7_rY.js";import"./check-BRFXV1aI.js";import"./chevron-up-Ci4wS3K6.js";import"./dialog-DSGLXfvZ.js";import"./index-BeLrdImO.js";import"./separator-Bthd58uT.js";import"./users-uvAbHv3x.js";function Ae(){const{user:x}=se(t=>t.auth),[g,C]=r.useState(1),[j,q]=r.useState(""),[S,z]=r.useState("Certified"),[b,L]=r.useState("all"),[y,_]=r.useState("all"),[N,W]=r.useState([]),[R,$]=r.useState(0),[G,p]=r.useState(!1),f=20,J=Math.ceil(R/f),[K,Q]=r.useState([]),A=r.useRef(null),[X,I]=r.useState(!1),[Y,Z]=r.useState([]),[i,E]=r.useState("name"),O=re(),[l,P]=r.useState(!1),U=async(t,a)=>{try{const d=new ce,s=le.create({type:t,organizationId:a}),m=F.create({resultsOrderBy:"firstName",resultsOrderAscending:!1});s.resultParameter=m,d.search(s,{status200:h=>{Z(h.persons),I(!0)},error:h=>{},else:(h,k)=>{}})}catch{}},V=async()=>{if(x){p(!0);try{const t=new oe,a={type:"Shop",smartFilter:j,filterByRegionId:y&&parseInt(y)};S!=="all"&&(a.filterByShopStatus=S),b!=="all"&&(a.filterByShopCertification=b);const d=F.create({resultsLimitOffset:(g-1)*f,resultsLimitCount:f,resultsOrderBy:i,resultsOrderAscending:l});a.resultParameter=d;const s=ne.create(a);t.search(s,{status200:m=>{W(m.organizations||[]),$(m.totalItemCount||0),p(!1)},error:m=>{p(!1)},status403:m=>{p(!1)}})}catch{p(!1)}}};r.useEffect(()=>{if(!x)return;C(1);const t=setTimeout(()=>{V()},j?500:0);return()=>clearTimeout(t)},[j,S,b,y,x,i,l]),r.useEffect(()=>{!x||g===1||V()},[g,x]);const ee=()=>{const t=(g-1)*f,a=t+f;return N.slice(t,a).map(s=>({Name:s.name,Number:s.shopNumber,"# of Pending Orders":s.countPendingUsers||0,"# of Active Users":s.countActiveUsers||0,"# of Pending Users":s.countPendingUsers||0,Status:s.status||"--",Certification:s.certification||"--",address:s.address||"--",City:s.city||"--",State:s.state||"--",Dealer:s.sponsorDealership.name||"--","Dealer #":s.sponsorDealership.dealershipNumber||"--",Region:s.region.name||"--"}))},te=async()=>{try{const t=ee();await ie(t,K,"Manage_Shops")&&H.success("Exported successfully")}catch{H.error("Export failed")}},c=t=>{i===t?l?(E("name"),P(!1)):P(!0):(E(t),P(!1)),C(1)};return r.useEffect(()=>{if(A.current){const t=A.current.querySelectorAll("thead th"),a=Array.from(t).map(d=>d.textContent.trim());Q(a)}},[N]),e.jsxs("div",{className:"bg-background min-h-screen",children:[e.jsx("div",{className:"bg-background",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("h1",{className:"text-foreground text-2xl font-bold",children:"Manage Shops"}),e.jsxs(ae,{onClick:te,children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Report"]})]})}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 lg:flex-row lg:items-center",children:[e.jsxs("div",{className:"relative max-w-md flex-1",children:[e.jsx(Ce,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(ue,{value:j,onChange:t=>q(t.target.value),placeholder:"Filter by Name, #, City",className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(B,{value:S,onValueChange:t=>z(t),children:[e.jsx(T,{className:"bg-muted w-48",children:e.jsx(w,{placeholder:"Status"})}),e.jsxs(D,{children:[e.jsx(o,{value:"all",children:"All Status"}),e.jsx(o,{value:"Certified",children:"Certified"}),e.jsx(o,{value:"Closed",children:"Closed"}),e.jsx(o,{value:"InProcess",children:"In-Process"}),e.jsx(o,{value:"Suspended",children:"Suspended"}),e.jsx(o,{value:"Terminated",children:"Terminated"})]})]}),e.jsxs(B,{value:b,onValueChange:t=>L(t),children:[e.jsx(T,{className:"bg-muted w-48",children:e.jsx(w,{placeholder:"Certification"})}),e.jsxs(D,{children:[e.jsx(o,{value:"all",children:"All Certifications"}),e.jsx(o,{value:"AudiHybrid",children:"Audi Hybrid"}),e.jsx(o,{value:"AudiUltra",children:"Audi Ultra"}),e.jsx(o,{value:"VW",children:"VW"})]})]}),e.jsxs(B,{value:y,onValueChange:t=>_(t),children:[e.jsx(T,{className:"bg-muted w-48",children:e.jsx(w,{placeholder:"CSR Region"})}),e.jsxs(D,{children:[e.jsx(o,{value:"all",children:"All Regions"}),x?.regions?.map(t=>e.jsx(o,{value:t.id?.toString()||"",children:t.name},t.id))]})]})]})]}),G?e.jsx("div",{className:"bg-background overflow-hidden rounded-lg border shadow-sm",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"loading..."})})}):N.length===0?e.jsx("div",{className:"bg-background overflow-hidden rounded-lg border shadow-sm",children:e.jsx(me,{children:e.jsxs(he,{children:[e.jsx(xe,{variant:"icon",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx(ge,{children:"No data to display"}),e.jsx(pe,{children:"No results could be found."})]})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-background overflow-hidden rounded-lg border shadow-sm",children:e.jsxs(Se,{ref:A,children:[e.jsx(be,{children:e.jsxs(M,{className:"bg-muted",children:[e.jsx(u,{field:"name",currentSortBy:i,currentAscending:l,onSort:c,children:"Name"}),e.jsx(u,{field:"shopNumber",currentSortBy:i,currentAscending:l,onSort:c,children:"Number"}),e.jsx(u,{field:"countPendingOrders",currentSortBy:i,currentAscending:l,onSort:c,children:"# of Pending Orders"}),e.jsx(u,{field:"countActiveUsers",currentSortBy:i,currentAscending:l,onSort:c,children:"# of Active Users"}),e.jsx(u,{field:"countPendingUsers",currentSortBy:i,currentAscending:l,onSort:c,children:"# of Pending Users"}),e.jsx(u,{field:"status",currentSortBy:i,currentAscending:l,onSort:c,children:"Status"}),e.jsx(v,{className:"text-foreground font-semibold",children:"Certification"}),e.jsx(v,{className:"text-foreground font-semibold",children:"Address"}),e.jsx(v,{className:"text-foreground font-semibold",children:"City"}),e.jsx(v,{className:"text-foreground font-semibold",children:"State"}),e.jsx(u,{field:"dealer",currentSortBy:i,currentAscending:l,onSort:c,children:"Dealer"}),e.jsx(u,{field:"sponsorDealership.name",currentSortBy:i,currentAscending:l,onSort:c,children:"Dealer #"}),e.jsx(u,{field:"region.name",currentSortBy:i,currentAscending:l,onSort:c,children:"Region"})]})}),e.jsx(ye,{children:N.map(t=>{const a=t.sponsorDealership,d=a?.name||"--",s=a?.dealershipNumber||"--",m=t.region?.name||"--",h=t.filterByShopStatus||"--",k=t.filterByShopCertification||"--";return e.jsxs(M,{className:"hover:bg-background",children:[e.jsx(n,{className:"font-medium text-blue-600",children:e.jsx("span",{className:"cursor-pointer hover:underline",onClick:()=>{O({to:"/repair_orders",search:{id:t.id}})},children:t.name||"--"})}),e.jsx(n,{children:t.shopNumber||"--"}),e.jsx(n,{className:"text-center font-medium text-blue-600 underline",onClick:()=>{O({to:"/repair_orders",search:{id:t.id.toString()}})},children:t.countPendingOrders??0}),e.jsx(n,{className:"text-center text-blue-600 underline hover:cursor-pointer",onClick:()=>{U("Shop",t.id)},children:t.countActiveUsers??0}),e.jsx(n,{className:"text-center text-blue-600 underline hover:cursor-pointer",onClick:()=>{U("Shop",t.id)},children:t.countPendingUsers??0}),e.jsx(n,{children:e.jsx(de,{variant:h==="certified"?"default":"secondary",className:h==="certified"?"bg-green-100 text-green-800 hover:bg-green-200":"",children:h})}),e.jsx(n,{children:k}),e.jsx(n,{className:"text-muted-foreground text-sm",children:t.address||"--"}),e.jsx(n,{children:t.city||"--"}),e.jsx(n,{children:t.state||"--"}),e.jsx(n,{children:d}),e.jsx(n,{children:s}),e.jsx(n,{children:m})]},t.id)})})]})}),e.jsx(je,{currentPage:g,totalPages:J,totalItems:R,itemsPerPage:f,onPageChange:C})]})]}),e.jsx(Ne,{teamMembers:Y,open:X,onOpenChange:I})]})}const st=Ae;export{st as component};
