import{a as se,j as e,D as re,r as P,B as C,t as N,q as Y,I as me,J as ue,X as ye,ax as we,h as he,aF as Se,aG as K}from"./index-B-Z7yNlO.js";import{O as z}from"./OrderApi-CGMXsDX2.js";import{u as fe,F as ge,U as je,C as Re,n as Ce,R as Oe}from"./RepairOrderDialog-D9vPz0Lo.js";import{D as le,a as ie,b as oe,c as ce,e as Pe}from"./dialog-BFKdIpyt.js";import{L as b,u as ke,a as Fe,g as Ae,F as Ie,b as Me,c as Te,e as $e,f as _e}from"./form-qz6utvQt.js";import{S as W}from"./separator-DDFY1sx8.js";import{X as G}from"./x-DRPXTlq9.js";import{T as ve}from"./trash-2-Co7bTAQc.js";import{I as te}from"./input-CYr9y3VT.js";import{T as qe}from"./textarea-KHrfRtO-.js";import{C as ee}from"./check-CNKoX3WN.js";import{u as Ee}from"./use-dialog-with-confirm-CT2VAKFI.js";import{P as Ne}from"./plus-VTREtdL2.js";import{B as _}from"./badge-rRRKVG41.js";import{P as pe}from"./pencil-BHEAkqcH.js";import{T as ze}from"./confirm-dialog-DWx-kDl3.js";import"./OrganizationApi-1Zl7W6PC.js";import"./Combination-BYZD_UMj.js";import"./index-DhZ6krBt.js";import"./index-TuNWgU8l.js";import"./select-DzdYbDWA.js";import"./index-BBPgPd72.js";import"./index-Cy9rQrAY.js";import"./index-D5jFdGIL.js";import"./chevron-down-lARmK8u4.js";import"./index-CbrVU0fF.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ae=se("loader-circle",Le);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]],ne=se("notebook-pen",Ue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Z=se("package",De);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],be=se("paperclip",We);function de({className:x,...g}){return e.jsx("div",{"data-slot":"card",className:re("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",x),...g})}function Ye({className:x,...g}){return e.jsx("div",{"data-slot":"card-header",className:re("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",x),...g})}function Be({className:x,...g}){return e.jsx("div",{"data-slot":"card-title",className:re("leading-none font-semibold",x),...g})}function Ve({className:x,...g}){return e.jsx("div",{"data-slot":"card-content",className:re("px-6",x),...g})}function Ge({open:x,onOpenChange:g,onComplete:i,initRepaitOrderData:n}){const[k,u]=P.useState([new File(["file_name.pdf"],"file_name.pdf",{type:"application/pdf"}),new File(["file_name.pdf"],"file2_name.pdf",{type:"application/pdf"}),new File(["file_name.pdf"],"file3_name.pdf",{type:"application/pdf"})]),{getRootProps:I,getInputProps:m,isDragActive:O}=fe({accept:{"image/*":[]},onDrop:y=>{u(v=>[...v,...y])}}),t=y=>{u(v=>v.filter((A,F)=>F!==y))},p=()=>{if(k.length===0)return N.error("Please upload at least one photo");i?.(k),g(!1)},j=()=>{u([]),g(!1)};return e.jsx(le,{open:x,onOpenChange:j,children:e.jsxs(ie,{className:"flex max-h-[90vh] flex-col p-0 sm:max-w-4xl",children:[e.jsxs(oe,{className:"flex-shrink-0",children:[e.jsx(ce,{className:"px-6 py-4 text-2xl font-semibold",children:"Mark Repair as Complete"}),e.jsx(W,{}),e.jsxs("button",{onClick:j,className:"ring-offset-background focus:ring-ring absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("div",{className:"min-h-0 flex-1 space-y-10 overflow-y-auto p-6 pt-8",children:[e.jsxs("section",{children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-3 text-lg font-medium",children:[e.jsx(ge,{className:"text-muted-foreground h-6 w-6"}),"Repair Order Information"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-x-12 gap-y-6 text-sm sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"Shop RO#"}),e.jsx("p",{className:"text-foreground mt-1.5 font-medium",children:n?.roNumber||"--"})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"Ordered From Dealership"}),e.jsx("p",{className:"text-foreground mt-1.5 font-medium",children:n?.dealership?.name||"--"})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"Customer"}),e.jsx("p",{className:"text-foreground mt-1.5 font-medium",children:n?.customer||"--"})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"VIN"}),e.jsx("p",{className:"text-foreground mt-1.5 font-mono",children:n?.vin||"--"})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"Year/Make/Model"}),e.jsxs("p",{className:"text-foreground mt-1.5 font-medium",children:[n?.year,"/",n?.make,"/",n?.model]})]})]})]}),e.jsx(W,{className:"bg-border/60"}),e.jsxs("section",{children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-3 text-lg font-medium",children:[e.jsx(be,{className:"text-muted-foreground h-6 w-6"}),"Attachments"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(b,{className:"text-foreground font-medium",children:["Post-Repair Photos ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{...I(),className:`relative cursor-pointer rounded-lg border-2 border-dashed p-12 text-center transition-all ${O?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:[e.jsx("input",{...m()}),e.jsx(je,{className:"text-muted-foreground mx-auto mb-4 h-12 w-12"}),e.jsxs("p",{className:"text-muted-foreground",children:["Drop your photos here or"," ",e.jsx("span",{className:"text-primary font-medium hover:underline",children:"click to browse"})]})]}),e.jsxs(C,{variant:"outline",size:"sm",className:"w-fit",children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Open camera"]})]}),e.jsx("div",{children:k.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:k.map((y,v)=>e.jsxs("div",{className:"flex items-center justify-between rounded-md p-1.5",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"text-left",children:e.jsx("p",{className:"max-w-xs truncate text-sm font-medium text-blue-500 hover:underline",children:y.name})})}),e.jsx("button",{type:"button",onClick:A=>{A.stopPropagation(),t(v)},className:"text-destructive hover:bg-destructive/10 rounded p-1",children:e.jsx(ve,{className:"h-4 w-4"})})]},v))})})]})]}),e.jsxs("div",{className:"bg-muted/30 flex items-center justify-end gap-3 border-t px-6 py-4",children:[e.jsx(C,{variant:"outline",size:"lg",onClick:j,children:"Cancel"}),e.jsx(C,{size:"lg",className:"bg-black px-8 font-medium text-white hover:bg-black/90",onClick:p,children:"Mark Repair as Complete"})]})]})})}function He({open:x,onOpenChange:g,onApprove:i,isReject:n=!1,onReject:k,initRepaitOrderData:u}){const[I,m]=P.useState(""),[O,t]=P.useState(""),[p,j]=P.useState(!1),y=()=>new Promise(async v=>{try{if(n){if(!O){N.error("Reason for rejection is required");return}}else if(!I){N.error("Sales order number is required");return}j(!0),n?(await k?.(O),v(void 0)):(await i?.(I),v(void 0)),t(""),m(""),g(!1),v(void 0)}catch(A){N.error(`Failed to ${n?"reject":"approve"} parts order ${A}|`),v(void 0)}finally{j(!1)}});return e.jsx(le,{open:x,onOpenChange:g,children:e.jsxs(ie,{className:"max-h-screen overflow-y-auto sm:max-w-5xl",children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-3 text-2xl font-semibold",children:[n?e.jsx(G,{className:"h-7 w-7 rounded-full bg-red-500 p-1 text-white"}):e.jsx(ee,{className:"h-7 w-7 rounded-full bg-green-500 p-1 text-white"}),n?"Parts Order Rejected":"Parts Order Approved"]}),e.jsx(W,{}),e.jsxs("button",{onClick:()=>g(!1),className:"focus:ring-ring absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("div",{className:"space-y-10 p-6 pt-8",children:[e.jsxs("section",{children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-3 text-lg font-medium",children:[e.jsx(ge,{className:"text-muted-foreground h-6 w-6"}),"Repair Order Information"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-x-12 gap-y-6 text-sm sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"Shop RO#"}),e.jsx("p",{className:"text-foreground mt-1.5 font-medium",children:u?.roNumber||"--"})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"Ordered From Dealership"}),e.jsx("p",{className:"text-foreground mt-1.5 font-medium",children:u?.dealership?.name||"--"})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"Customer"}),e.jsx("p",{className:"text-foreground mt-1.5 font-medium",children:u?.customer||"--"})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"VIN"}),e.jsx("p",{className:"text-foreground mt-1.5 font-mono",children:u?.vin||"--"})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"Year/Make/Model"}),e.jsxs("p",{className:"text-foreground mt-1.5 font-medium",children:[u?.year,"/",u?.make,"/",u?.model]})]})]})]}),e.jsx(W,{className:"bg-border/60"}),e.jsxs("section",{children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-3 text-lg font-medium",children:[e.jsx(Z,{className:"text-muted-foreground h-6 w-6"}),"Parts Order Information"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-x-12 gap-y-6 text-sm sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"Order Submitted"}),e.jsx("p",{className:"mt-1.5",children:Y(u?.dateLastSubmitted)||"--"})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"Order Approved"}),e.jsx("p",{className:"mt-1.5 font-medium",children:Y(u?.dateClosed)||"--"})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"Order Shipped"}),e.jsx("p",{className:"text-muted-foreground mt-1.5",children:u?.dealership.name||"--"})]})]})]}),e.jsx(W,{className:"bg-border/60"}),n?e.jsxs("section",{children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-3 text-lg font-medium",children:[e.jsx(ne,{className:"text-muted-foreground h-6 w-6"}),"Reason for Rejection"]}),e.jsx(qe,{value:O,onChange:v=>t(v.target.value),id:"sales-order",placeholder:"Provied a reason for rejection",className:"mt-2 h-11"})]}):e.jsxs("section",{children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-3 text-lg font-medium",children:[e.jsx(ne,{className:"text-muted-foreground h-6 w-6"}),"Sales Order #"]}),e.jsxs("div",{className:"max-w-sm",children:[e.jsx(b,{htmlFor:"sales-order",className:"text-muted-foreground",children:"Assign a Sales Order #"}),e.jsx(te,{id:"sales-order",placeholder:"Enter sales order number (e.g. SO-174)",className:"mt-2 h-11",value:I,onChange:v=>m(v.target.value.trim())})]})]})]}),e.jsxs("div",{className:"bg-muted/30 flex items-center justify-end gap-3 border-t px-6 py-4",children:[e.jsx(C,{variant:"outline",size:"lg",onClick:()=>g(!1),children:"Cancel"}),e.jsx(C,{size:"lg",className:n?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700",onClick:y,disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4 animate-spin"}),n?"Rejecting...":"Approving..."]}):n?"Reject":"Approve"})]})]})})}const Xe=me({parts:ye(me({number:ue().min(1,"Part number is required")})),_estimateFile:ue().optional()});function Je({open:x,onOpenChange:g,isReject:i=!1,initialData:n,mode:k="create",initRepaitOrderData:u,onSuccess:I,onHandleResubmit:m}){const[O,t]=P.useState([]),p=ke({resolver:Fe(Xe),defaultValues:{parts:[{number:""},{number:""},{number:""},{number:""}]}}),[j,y]=P.useState(!1),[v,A]=P.useState(""),{handleCloseRequest:F,ConfirmDialogComponent:T}=Ee({form:p,hasUnsavedFiles:O.length>0,onClose:()=>{p.reset(),t([]),g(!1)},title:"Discard Changes?",description:"You have unsaved changes. Are you sure you want to close? All your changes will be lost."}),E=()=>{F()},L=c=>c?!0:(F(),!1),{fields:U,append:$,remove:D}=Ae({control:p.control,name:"parts"}),M=n?.partsOrderNumber!==void 0&&n.partsOrderNumber>0,l=()=>{if(i)return"Resubmit Parts Order";if(M){const c=n?.partsOrderNumber||1;return n.parts&&n.parts?.length>0?`Edit Supplement #${c}`:`New Supplement #${c}`}else return n&&n?.id?"Edit Parts Order":"New Parts Order"},H=()=>M?`Supplement #${n?.partsOrderNumber||1} Information`:"Parts Order Information";P.useEffect(()=>{if(x&&n){const c=n.parts&&n.parts.length>0?n.parts.map(w=>({number:w})):[{number:""}];p.reset({parts:c.length>0?c:[{number:""}]}),setTimeout(()=>{t(n.estimateFileAssets||[])},0)}else x&&k==="create"&&(p.reset({parts:[{number:""},{number:""},{number:""},{number:""}]}),t([]))},[x,n,k,p]);const B=c=>{try{const w=new z,s=we.create({...n,parts:c.parts.map(a=>a.number),estimateFileAssets:O,repairOrder:u});return y(!0),new Promise((a,h)=>{w.partsOrderSave(s,{status200:()=>{N.success("Parts Order saved successfully"),g(!1),I?.(),y(!1),a(void 0)},error:d=>{N.error("Error saving parts order:",d),y(!1),h(void 0)},else:(d,o)=>{N.error(o),y(!1),h(void 0)}})})}catch(w){y(!1),N.error("Error saving parts order:",w)}},{getRootProps:X,getInputProps:J,isDragActive:V}=fe({accept:{"application/pdf":[".pdf"]},onDrop:c=>{t(w=>[...w,...c])}}),r=c=>{t(w=>w.filter((s,a)=>a!==c))};return e.jsxs(e.Fragment,{children:[e.jsx(le,{open:x,onOpenChange:c=>L(c),children:e.jsxs(ie,{className:"flex max-h-[90vh] flex-col p-0 sm:max-w-4xl",children:[e.jsxs(oe,{className:"flex-shrink-0",children:[e.jsx(ce,{className:"px-6 py-4 text-2xl font-semibold",children:l()}),e.jsx(W,{}),e.jsxs("button",{onClick:E,className:"ring-offset-background focus:ring-ring absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsx(Ie,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit(B),className:"flex min-h-0 flex-1 flex-col",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:[e.jsxs("section",{className:"mb-8",children:[e.jsxs("div",{className:"mb-5 flex items-center gap-3",children:[e.jsx(Z,{className:"text-foreground h-5 w-5"}),e.jsx("h3",{className:"text-foreground text-lg font-semibold",children:"Repair Order Information"})]}),e.jsxs("div",{className:"bg-muted/50 grid grid-cols-1 gap-4 rounded-lg p-5 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground text-xs",children:"Shop RO #"}),e.jsx("p",{className:"font-medium",children:u?.roNumber||"---"})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground text-xs",children:"Order From Dealership"}),u?.dealership.name||"---"]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground text-xs",children:"Customer"}),e.jsx("p",{className:"font-medium",children:u?.customer||"---"})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground text-xs",children:"VIN"}),e.jsx("p",{className:"font-medium",children:u?.vin||"---"})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground text-xs",children:"Year/Make/Model"}),e.jsx("p",{className:"font-medium",children:u?.year&&u?.make&&u?.model?`${u?.year} ${u?.make} ${u?.model}`:"---"})]})]})]}),e.jsx(W,{className:"my-8"}),e.jsxs("section",{className:"mb-8",children:[e.jsxs("div",{className:"mb-5 flex items-center gap-3",children:[e.jsx(Z,{className:"text-foreground h-5 w-5"}),e.jsx("h3",{className:"text-foreground text-lg font-semibold",children:H()})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-8 text-sm",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"Order Submitted"}),e.jsx("p",{className:"mt-1 font-medium",children:n?.dateSubmitted?Y(n?.dateSubmitted):"---"})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"Order Approved"}),e.jsx("p",{className:"mt-1 font-medium",children:n?.dateReviewed?Y(n?.dateReviewed):"---"})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"Order Shipped"}),e.jsx("p",{className:"mt-1 font-medium",children:n?.dateShipped?Y(n?.dateShipped):"---"})]}),n?.id&&n?.salesOrderNumber&&e.jsxs("div",{children:[e.jsx(b,{className:"text-muted-foreground",children:"Sales Order #"}),e.jsx("p",{className:"mt-1 font-medium",children:n.salesOrderNumber||"---"})]})]})]}),e.jsx(W,{className:"my-8"}),e.jsxs("div",{className:"grid grid-cols-1 gap-12 md:grid-cols-2",children:[e.jsxs("section",{children:[e.jsxs("div",{className:"mb-5 flex items-center gap-3",children:[e.jsx(Z,{className:"text-foreground h-5 w-5"}),e.jsx("h3",{className:"text-foreground text-lg font-semibold",children:"Requested Part Numbers"})]}),e.jsxs("div",{className:"space-y-4",children:[U.map((c,w)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-muted-foreground w-12 text-sm",children:["Part ",w+1]}),e.jsx(Me,{disabled:n?.status==="DealershipProcessing",control:p.control,name:`parts.${w}.number`,render:({field:s})=>e.jsxs(Te,{className:"flex-1",children:[e.jsx($e,{children:e.jsx(te,{placeholder:"Enter part number",...s})}),e.jsx(_e,{})]})}),U.length>1&&e.jsx(C,{disabled:n?.status==="DealershipProcessing",type:"button",variant:"ghost",size:"icon",onClick:()=>D(w),children:e.jsx(ve,{className:"text-destructive h-4 w-4"})})]},c.id)),e.jsxs(C,{disabled:n?.status==="DealershipProcessing",type:"button",variant:"outline",size:"sm",onClick:()=>$({number:""}),children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"})," Add a Part"]})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"mb-5 flex items-center gap-3",children:[e.jsx(be,{className:"text-foreground h-5 w-5"}),e.jsx("h3",{className:"text-foreground text-lg font-semibold",children:"Attachments"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(b,{className:"text-foreground text-sm font-medium",children:["Estimate",(k==="create"||!n?.estimateFileAssets?.length)&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{...X(),className:`flex cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed p-10 text-center transition-all ${V?"border-primary bg-muted":"border-border hover:border-primary"}`,children:[e.jsx("input",{...J(),disabled:n?.status==="DealershipProcessing"}),e.jsx(je,{className:"text-muted-foreground mb-3 h-12 w-12"}),e.jsxs("p",{className:"text-muted-foreground text-sm",children:["Drop your PDF files here or"," ",e.jsx("span",{className:"text-primary hover:underline",children:"click to browse"})]})]}),e.jsx("div",{children:O&&O.length>0&&e.jsx("div",{className:"w-full space-y-2",children:O.map((c,w)=>e.jsxs("div",{className:"flex items-center justify-between rounded-md p-1.5",children:[e.jsx("div",{className:"flex-1 truncate",title:c.name,children:e.jsx("p",{className:"cursor-pointer truncate text-sm font-medium text-blue-500 hover:underline",children:c.name})}),e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),r(w)},className:"text-destructive ml-2 text-xs hover:underline",children:"Remove"})]},`${c.name}-${w}`))})}),p.formState.errors._estimateFile&&e.jsx("p",{className:"text-destructive text-sm",children:p.formState.errors._estimateFile.message})]})]})]}),e.jsx("div",{children:i&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"flex items-center gap-3 text-lg font-medium",children:[e.jsx(ne,{className:"text-muted-foreground h-5 w5"}),"Comment"]}),e.jsx(te,{type:"textarea",placeholder:"Enter comment",value:v,className:"mt-2 h-11",onChange:c=>A(c.target.value)})]})})]}),e.jsx(Pe,{className:"bg-muted/50 w-full flex-shrink-0 border-t px-6 py-4 backdrop-blur",children:e.jsxs("div",{className:"flex w-full justify-end gap-3",children:[e.jsx(C,{type:"button",variant:"outline",onClick:E,children:"Cancel"}),i?e.jsxs(C,{type:"button",onClick:async()=>{y(!0),await B(p.getValues()),await m?.(v),y(!1)},disabled:j,children:[j?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4 animate-spin"}),"Resubmitting..."]}):"Resubmit","Resubmit"]}):e.jsx(C,{type:"submit",variant:"default",disabled:j||p.formState.isSubmitting,children:j||p.formState.isSubmitting?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4 animate-spin"}),n?.id?"Updating...":"Saving..."]}):n?.id?"Update":"Save"})]})})]})})]})}),T]})}const xe=["OrderReview","OrderFulfillment","OrderReceived","RepairCompleted"],q=x=>{if(!x)return"";const g=typeof x=="string"?new Date(x):x;return isNaN(g.getTime())?"":g.toLocaleString("en-US",{month:"2-digit",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},S=x=>x?`${x.firstName||""} ${x.lastName||""}`.trim():"";function Ke({partsOrder:x,onResubmit:g,onMarkReceived:i,onMarkShipped:n,onApprove:k,onReject:u}){const{auth:I}=he(),m=I.user?.person?.type;if(!x)return e.jsxs(de,{className:"p-6",children:[e.jsx("h2",{className:"mb-6 text-2xl font-bold",children:"Parts Tracker"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No parts order data available"})]});const{stage:O,status:t,approvalFlag:p,dateSubmitted:j,dateReviewed:y,dateShipped:v,dateReceived:A,submittedByPerson:F,reviewedByPerson:T,shippedByPerson:E,receivedByPerson:L,orderReviewActivityLogItems:U,orderFulfillmentActivityLogItems:$,orderReceivedActivityLogItems:D}=x,l=(()=>{const r=U&&U?.length>0?U:$&&$?.length>0?$:D&&D?.length>0?D:[],c=r.find(R=>R?.type==="Submitted"),w=r.find(R=>R?.type==="Rejected"),s=r.find(R=>R?.type==="Resubmitted"),a=r.find(R=>R?.type==="Approved"),h=r.find(R=>R?.type==="Shipped"),d=r.find(R=>R?.type==="Unshipped"),o=r.find(R=>R?.type==="Received"),f=r.find(R=>R?.type==="Unreceived");return{submitted:c,rejected:w,resubmitted:s,approved:a,shipped:h,unshipped:d,received:o,unreceived:f}})(),H=()=>["OrderReview","OrderFulfillment","OrderReceived"],B=()=>{const r=[];let c=O||"OrderReview";O==="OrderFulfillment"&&t==="DealershipShipped"&&v&&(c="OrderReceived"),O==="OrderReceived"&&(t==="ShopReceived"||t==="RepairCompleted")&&A&&(c="RepairCompleted");const w=xe.indexOf(c);return H().forEach(a=>{const h=xe.indexOf(a);let d,o,f,R=!1,Q=!1;h<w?(d="completed",a==="OrderReview"&&(p===!0||p===!1?(o=y,f=S(T)):(o=j,f=S(F))),a==="OrderFulfillment"&&t==="DealershipShipped"&&v&&(o=v,f=S(E))):h===w&&(a==="OrderReview"?(o=j,f=S(F),p===!0?(d="approved",o=y,f=S(T)):p===!1?(d="rejected",o=y,f=S(T)):t==="CsrReview"&&(d="waiting",R=!0,Q=!0)):a==="OrderFulfillment"?(o=y,f=S(T),t==="DealershipProcessing"||t==="DealershipShipped"?t==="DealershipShipped"?(o=v,f=S(E),d="completed"):d="waiting":t==="CsrReview"&&p===!0&&(d="waiting")):a==="OrderReceived"?(o=v,f=S(E),t==="ShopReceived"||t==="RepairCompleted"?(d="completed",o=A,f=S(L)):t==="DealershipShipped"&&(d="waiting")):a==="RepairCompleted"&&t==="RepairCompleted"&&(d="completed")),r.push({id:h+1,stage:a,title:X(a),status:d,date:o,by:f,canApprove:R,canReject:Q})}),r},X=r=>({OrderReview:"Order Review",OrderFulfillment:"Order Fulfillment",OrderReceived:"Order Received",RepairCompleted:"Repair Completed"})[r],J=r=>m==="Csr"&&r.stage==="OrderReview"&&t==="CsrReview"&&r.status==="waiting"?e.jsx(_,{className:"bg-blue-700 text-white",children:"Waiting on You"}):m==="Csr"&&r.stage==="OrderFulfillment"&&r.status==="waiting"?e.jsx(_,{className:"text-muted bg-orange-400",children:"Pending Dealer"}):m==="Shop"&&r.stage==="OrderReview"&&t==="CsrReview"&&r.status==="waiting"?e.jsx(_,{className:"text-muted bg-orange-400",children:"Pending CSR"}):m==="Shop"&&r.stage==="OrderReview"&&r.status==="rejected"?e.jsx(_,{className:"bg-blue-100 text-blue-700",children:"Waiting on You"}):m==="Shop"&&r.stage==="OrderFulfillment"&&r.status==="waiting"?e.jsx(_,{className:"text-muted bg-orange-400",children:"Pending Dealer"}):m==="Dealership"&&r.stage==="OrderFulfillment"&&r.status==="waiting"?e.jsx(_,{className:"bg-blue-100 text-blue-700",children:"Waiting on You"}):m==="Shop"&&r.stage==="OrderReceived"&&r.status==="waiting"?e.jsx(_,{className:"bg-blue-100 text-blue-700",children:"Waiting on You"}):(m==="Dealership"||m==="Csr")&&r.stage==="OrderReceived"&&r.status==="waiting"?e.jsx(_,{className:"text-muted bg-orange-400",children:"Pending Shop"}):r.status==="waiting"?e.jsx(_,{className:"bg-blue-100 text-blue-700",children:"Waiting on You"}):r.status==="pending"?r.stage==="OrderReview"&&t==="CsrReview"?e.jsx(_,{className:"text-muted bg-orange-400",children:"Pending CSR"}):e.jsx(_,{className:"bg-gray-400 text-white",children:"Pending"}):null,V=B();return e.jsxs(de,{className:"p-6",children:[e.jsx("h2",{className:"mb-6 text-2xl font-bold",children:"Parts Tracker"}),e.jsx("div",{className:"space-y-8",children:V.map((r,c)=>{const s=r.stage==="OrderReview"&&r.status==="rejected"&&m==="Shop",a=r.stage==="OrderReceived"&&r.status==="waiting"&&i&&m==="Shop",h=r.stage==="OrderFulfillment"&&(r.status==="waiting"||r.status==="completed"&&t==="DealershipShipped")&&n&&m==="Dealership"&&!A,d=r.canApprove&&r.canReject&&m==="Csr"&&k&&u;return e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`flex h-6 w-6 items-center justify-center rounded-full p-1 text-sm font-bold text-white ${r.status==="approved"||r.status==="completed"?"bg-green-600":r.status==="rejected"?"bg-red-500":r.status==="waiting"?"bg-black":"bg-gray-400"}`,children:r.status==="approved"||r.status==="completed"?e.jsx(ee,{className:"h-5 w-5"}):r.status==="rejected"?e.jsx(G,{className:"h-5 w-5"}):r.id}),c<V.length-1&&e.jsx("div",{className:"mt-2 h-full w-px border-l border-gray-300"})]}),e.jsxs("div",{className:"flex-1 pb-8",children:[e.jsxs("div",{className:"mb-1 flex items-center gap-2 p-2",children:[e.jsx("h3",{className:"font-semibold",children:r.title}),J(r)]}),r.stage==="OrderReview"&&e.jsx("div",{className:"space-y-2 text-sm",children:l?e.jsxs(e.Fragment,{children:[l.submitted&&e.jsxs("p",{className:"text-muted-foreground",children:["Request was Submitted on"," ",e.jsx("strong",{children:q(l.submitted.dateCreated)}),l.submitted.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsx("strong",{children:S(l.submitted.person)})]}),"."]}),l.rejected&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-muted-foreground",children:["Request was ",e.jsx("span",{className:"font-semibold text-red-600",children:"Rejected"})," on"," ",e.jsx("strong",{children:q(l.rejected.dateCreated)}),l.rejected.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsxs("strong",{children:[S(l.rejected.person),"."]})]})]}),l.rejected.comment&&e.jsxs("p",{className:"text-muted-foreground",children:["(Reason: ",l.rejected.comment,")"]})]}),l.resubmitted&&e.jsxs("p",{className:"text-muted-foreground",children:["Request was Resubmitted on"," ",e.jsx("strong",{children:q(l.resubmitted.dateCreated)}),l.resubmitted.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsx("strong",{children:S(l.resubmitted.person)})]}),"."]}),l.approved&&e.jsxs("p",{className:"text-muted-foreground",children:["Request was ",e.jsx("span",{className:"font-semibold text-green-600",children:"Approved"})," on"," ",e.jsx("strong",{children:q(l.approved.dateCreated)}),l.approved.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsxs("strong",{children:[S(l.approved.person),"."]})]})]})]}):j&&e.jsxs("p",{className:"text-muted-foreground",children:["Request was Submitted on ",e.jsx("strong",{children:q(j)}),F&&e.jsxs(e.Fragment,{children:[" by ",e.jsxs("strong",{children:[S(F),"."]})]})]})}),r.stage==="OrderFulfillment"&&e.jsx("div",{className:"space-y-2 text-sm",children:l?e.jsxs(e.Fragment,{children:[l.shipped&&e.jsxs("p",{className:"text-muted-foreground",children:["Parts were Shipped on ",e.jsx("strong",{children:q(l.shipped.dateCreated)}),l.shipped.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsx("strong",{children:S(l.shipped.person)})]})]}),l.unshipped&&e.jsxs("p",{className:"text-muted-foreground",children:["Parts were Unshipped on ",e.jsx("strong",{children:q(l.unshipped.dateCreated)}),l.unshipped.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsx("strong",{children:S(l.unshipped.person)})]})]})]}):j&&e.jsxs("p",{className:"text-muted-foreground",children:["Request was Submitted on ",e.jsx("strong",{children:q(j)}),F&&e.jsxs(e.Fragment,{children:[" by ",e.jsxs("strong",{children:[S(F),"."]})]})]})}),r.stage==="OrderReceived"&&e.jsx("div",{className:"space-y-2 text-sm",children:l?e.jsxs(e.Fragment,{children:[l.received&&e.jsxs("p",{className:"text-muted-foreground",children:["Parts were Received on ",e.jsx("strong",{children:q(l.received.dateCreated)}),l.received.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsx("strong",{children:S(l.received.person)})]})]}),l.unreceived&&e.jsxs("p",{className:"text-muted-foreground",children:["Parts were Unreceived on"," ",e.jsx("strong",{children:q(l.unreceived.dateCreated)}),l.unreceived.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsx("strong",{children:S(l.unreceived.person)})]})]})]}):j&&e.jsxs("p",{className:"text-muted-foreground",children:["Request was Submitted on ",e.jsx("strong",{children:q(j)}),F&&e.jsxs(e.Fragment,{children:[" by ",e.jsxs("strong",{children:[S(F),"."]})]})]})}),d&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"mb-3 text-sm",children:"This request is"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:k,children:[e.jsx(ee,{className:"mr-1 h-4 w-4"}),"Approved"]}),e.jsxs(C,{size:"sm",className:"bg-red-600 hover:bg-red-700",onClick:u,children:[e.jsx(G,{className:"mr-1 h-4 w-4"}),"Rejected"]})]})]}),s&&e.jsx("div",{className:"mt-4",children:e.jsx(C,{size:"sm",variant:"outline",onClick:g,className:"bg-gray-100 hover:bg-gray-200",children:"Resubmit Request"})}),h&&e.jsx("div",{className:"mt-4",children:e.jsx(C,{size:"sm",variant:"outline",onClick:()=>n(t),className:"bg-gray-100 hover:bg-gray-200",children:t==="DealershipShipped"?"Unmark Parts as Shipped":"Mark Parts as Shipped"})}),a&&e.jsx("div",{className:"mt-4",children:e.jsx(C,{size:"sm",variant:"outline",onClick:()=>i(r.status),className:"bg-gray-100 hover:bg-gray-200",children:"Mark Parts as Received"})})]})]},r.id)})})]})}function Qe(){const[x,g]=P.useState(!1),[i,n]=P.useState(),[k,u]=P.useState(!1),I=Se({from:"/_authenticated/repair_orders/$id"}).id,[m,O]=P.useState(),[t,p]=P.useState(),[j,y]=P.useState(0),[v,A]=P.useState(!1),[F,T]=P.useState(!1),[E,L]=P.useState(!1),{auth:U}=he(),$=U.user?.person?.type,D=async()=>{try{return new Promise((s,a)=>{new z().repairOrderGet(I,{status200:d=>{n(d),s(d)},error:d=>{a(d)}})})}catch{}},M=async()=>{try{return new Promise((s,a)=>{new z().partsOrderGetAllForRepairOrder(I,{status200:d=>{Object.prototype.toString.call(d)==="[object Array]"?O(d):O([d]);const o=Object.prototype.toString.call(d)==="[object Array]"?d:[d];p(f=>{if(o.length!==0){if(j>=0&&j<o.length)return o[j];if(f&&f.id!=null){const R=o.find(Q=>Q.id===f.id);if(R)return R}return o[0]}}),s(d)},error:d=>{N.error("Error:",d),a()},else:(d,o)=>{N.error(o),a()}})})}catch{}},l=async s=>{if(!(!t||!t.id))try{await new Promise((a,h)=>{const d=new z,o=K.create({partsOrderId:t.id,action:"Approved",salesOrderNumber:s});d.partsOrderSubmitWorkflowAction(o,{status200:()=>{N.success("Parts order approved successfully"),M(),a(!0)},error:f=>{N.error(`Failed to approve parts order ${f}|`),h(!1)},else:()=>{h(!1)}})})}catch{}},H=async s=>{if(!(!t||!t.id))try{await new Promise((a,h)=>{const d=new z,o=K.create({partsOrderId:t.id,action:"Rejected",comment:s});d.partsOrderSubmitWorkflowAction(o,{status200:()=>{N.success("Parts order rejected successfully"),M(),a(!0)},error:f=>{N.error(`Failed to reject parts order ${f}|`),h(!1)},else:()=>{h(!1)}})})}catch{}},B=async s=>{try{await new Promise((a,h)=>{const d=new z,o=K.create({partsOrderId:t.id,action:"Resubmitted",comment:s,salesOrderNumber:t.salesOrderNumber});d.partsOrderSubmitWorkflowAction(o,{status200:()=>{N.success("Parts order resubmitted successfully"),M(),a(!0)},error:f=>{N.error(`Failed to resubmit parts order ${f}|`),h(!1)},else:()=>{h(!1)}})})}catch(a){N.error(`Failed to resubmit parts order ${a}|`)}},X=()=>{g(!0),L(!0)},J=async s=>{try{await new Promise((a,h)=>{const d=new z,o=K.create({partsOrderId:t.id,action:s==="DealershipShipped"?"Unshipped":"Shipped"});d.partsOrderSubmitWorkflowAction(o,{status200:()=>{N.success("Parts order marked as shipped successfully"),M(),a(!0)},error:f=>{N.error(`Failed to mark parts order as shipped ${f}|`),h(!1)},else:()=>{h(!1)}})})}catch(a){N.error(`Failed to mark parts order as shipped ${a}|`)}},V=async s=>{try{await new Promise((a,h)=>{const d=new z,o=K.create({partsOrderId:t.id,action:s==="DealershipShipped"?"Unreceived":"Received"});d.partsOrderSubmitWorkflowAction(o,{status200:()=>{N.success("Parts order marked as received successfully"),M(),a(!0)},error:f=>{N.error(`Failed to mark parts order as received ${f}|`),h(!1)},else:()=>{h(!1)}})})}catch(a){N.error(`Failed to mark parts order as received ${a}|`)}},r=async s=>{try{await new Promise((a,h)=>{const d=new z,o={id:i.id,preRepairPhotoFileAssets:s,...i};d.repairOrderComplete(o,{status200:()=>{N.success("Repair order marked as complete successfully"),D(),M(),a(!0)},error:f=>{N.error(`Failed to mark repair order as complete ${f}|`),h(!1)},else:()=>{h(!1)}})})}catch(a){N.error(`Failed to mark repair order as complete ${a}|`)}},c=()=>{T(!0),L(!1)},w=()=>{T(!0),L(!0)};return P.useEffect(()=>{D(),M()},[]),e.jsxs("div",{className:"bg-background text-foreground",children:[e.jsx("div",{className:"mt-8 h-full w-full",children:e.jsx("img",{src:Ce,alt:"Repair Order List",className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"mx-4 my-6 p-3",children:[e.jsxs("div",{className:"flex w-full flex-col rounded-sm border",children:[e.jsxs("div",{className:"bg-muted text-foreground flex w-full items-center justify-between p-5",children:[e.jsxs("h1",{className:"text-2xl font-bold tracking-tight",children:["Repair Order # :",i?.roNumber||"--"]}),e.jsxs("div",{className:"flex gap-3",children:[m?.every(s=>s.status==="ShopReceived"||s.status==="CsrRejected")&&$==="Shop"?e.jsxs(C,{onClick:()=>u(!0),size:"sm",className:"h-9 bg-green-600 text-xs font-medium",children:[e.jsx(ee,{className:"mr-1.5 h-3.5 w-3.5"}),"Mark Repair as Complete"]}):null,$==="Shop"&&m?.every(s=>s.status!=="RepairCompleted")?e.jsxs(C,{size:"sm",variant:"outline",className:"h-9 text-xs font-medium",onClick:()=>A(!0),children:[e.jsx(pe,{className:"mr-1.5 h-3.5 w-3.5"}),"Edit Repair Order"]}):null]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 p-5 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Customer"}),e.jsx("p",{className:"font-medium",children:i?.customer||"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"VIN"}),e.jsx("p",{className:"font-mono",children:i?.vin||"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Year/Make/Model"}),e.jsxs("p",{className:"font-medium",children:[i?.year,"/",i?.make,"/",i?.model]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Date Submitted"}),e.jsx("p",{children:Y(i?.dateLastSubmitted)||"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Submitted To"}),e.jsx("p",{className:"font-medium",children:i?.dealership?.name||"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Date Closed"}),e.jsx("p",{className:"text-muted-foreground",children:Y(i?.dateClosed)||"--"})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Pre-Repair Photos"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-2",children:i&&i?.preRepairPhotoFileAssets&&i?.preRepairPhotoFileAssets.length>0?i?.preRepairPhotoFileAssets?.map(s=>e.jsx("a",{href:s.downloadUrl,className:"text-blue-700 underline hover:underline",children:s.filename},s.id)):"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Structural Measurements"}),e.jsx("br",{}),e.jsx("a",{href:"#",className:"text-primary hover:underline",children:i?.structuralMeasurementFileAssets&&i?.structuralMeasurementFileAssets.length>0?i?.structuralMeasurementFileAssets?.map(s=>e.jsx("a",{href:s.downloadUrl,className:"text-blue-700 underline hover:underline",children:s.filename},s.id)):"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Post-Repair Photos"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-2",children:i?.postRepairPhotoFileAssets&&i?.postRepairPhotoFileAssets.length>0?i?.postRepairPhotoFileAssets?.map(s=>e.jsx("a",{href:s.downloadUrl,className:"text-blue-700 underline hover:underline",children:s.filename},s.id)):"--"})]})]})]})]}),e.jsxs("div",{className:"my-5 flex flex-col rounded-sm border",children:[e.jsxs("div",{className:"bg-muted flex items-center justify-between overflow-hidden p-5",children:[e.jsx("div",{className:"flex items-center gap-6 text-sm font-medium",children:m&&m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:j===0?"default":"outline",size:"sm",onClick:()=>{const s=m.find(a=>a.partsOrderNumber===0);y(0),p(s)},children:"Parts Order"}),m.filter(s=>s.partsOrderNumber&&s.partsOrderNumber>0).map((s,a)=>e.jsxs(C,{variant:j===a+1?"default":"outline",onClick:()=>{p(s),y(a+1)},children:[s.hasAlert&&e.jsx(ze,{className:"text-destructive h-4 w-4"}),"Supplement ",s.partsOrderNumber]},s.id||a))]})}),m?.some(s=>s.status!=="RepairCompleted"||s.status==="CsrRejected"||s.status!=="RepairCompleted")&&$==="Shop"&&e.jsxs(C,{onClick:()=>{p(void 0),g(!0),L(!1)},variant:"outline",size:"sm",className:"h-9 rounded-lg font-medium",children:[e.jsx(Ne,{className:"mr-1.5 h-3.5 w-3.5"}),"Supplemental Parts Order"]})]}),e.jsxs("div",{className:"m-5 flex gap-8",children:[e.jsx("div",{className:"max-w-lg flex-1",children:(t||m&&m.length>0&&m[0])&&e.jsxs(de,{className:"rounded-xl border shadow-sm",children:[e.jsx(Ye,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Be,{className:"text-foreground text-base font-semibold",children:["Sales Order #"," ",t?.salesOrderNumber||"--"]}),$==="Shop"&&t?.stage=="OrderReview"&&t?.status!=="DealershipProcessing"||$==="Csr"&&t?.status!=="CsrReview"&&t?.status!=="CsrRejected"&&t?.stage!=="OrderReceived"?e.jsxs(C,{onClick:()=>{p(t),g(!0)},size:"sm",variant:"outline",className:"h-9 px-4 text-xs",children:[e.jsx(pe,{className:"h-3.5 w-3.5"}),"Edit Parts Order"]}):null]})}),e.jsxs(Ve,{className:"space-y-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-3 font-medium",children:"Requested Parts"}),e.jsx("ol",{className:"text-foreground/90 space-y-2 pl-5 font-mono",children:t?.parts?.length>0&&t?.parts?.map((s,a)=>e.jsxs("li",{children:["(",a+1,") ",s]},s+a))||"-- No parts requested"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Parts Estimate"}),e.jsx("br",{}),t&&t.estimateFileAssets&&t.estimateFileAssets.length>0&&t.estimateFileAssets.map(s=>e.jsx("a",{href:s.viewUrl,className:"text-blue-700 underline hover:underline",children:s.filename},s.id))||"-- No estimate file"]})]})]})||"-- No parts order data"}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx(Ke,{partsOrder:t||m&&m.length>0&&m?.[0],onApprove:c,onReject:w,onResubmit:X,onMarkShipped:s=>J(s),onMarkReceived:s=>V(s)})})]})]})]}),e.jsx(Je,{open:x,onOpenChange:g,initialData:t,initRepaitOrderData:i,onSuccess:()=>{M()},isReject:E,onHandleResubmit:B}),e.jsx(He,{open:F,onOpenChange:T,onApprove:l,onReject:H,isReject:E,initRepaitOrderData:i}),e.jsx(Ge,{open:k,onOpenChange:u,initRepaitOrderData:i,onComplete:s=>r(s)}),e.jsx(Oe,{open:v,onOpenChange:A,initialData:i})]})}const Rs=Qe;export{Rs as component};
