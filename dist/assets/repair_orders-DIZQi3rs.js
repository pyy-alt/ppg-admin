import{h as Q,r as a,b as z,p as G,j as e,B as J,q as x,s as K,w as U,i as W,O as X}from"./index-DiI2ffAh.js";import{u as Z}from"./use-authenticated-DyXd3Kpo.js";import{L as ee}from"./Loading-QGL_XBaH.js";import{O as te}from"./OrderApi-C0c8zPF8.js";import{n as se,R as re}from"./RepairOrderDialog-p6ZjJT5H.js";import{B as ae}from"./badge-CmxtL1uP.js";import{C as le}from"./checkbox-DnhwHROs.js";import{E as ie,a as oe,b as de,T as ne,c as ce,d as me,D as ue}from"./data-table-pagination-BYSKvq0r.js";import{I as he}from"./input-anrjtq5m.js";import{L as pe}from"./form-BztM4JIr.js";import{S as w,a as T,b as D,c as L,d as r}from"./select-BfIdXsKN.js";import{T as xe,a as je,b as P,c as i,d as fe,e as o}from"./table-DfggTbkb.js";import{D as F}from"./date-picker-C8C4Gnlb.js";import{P as ge}from"./plus-DWHwyz7k.js";import{S as ve}from"./search-Dee6z3yd.js";import{T as be}from"./confirm-dialog-CtLfmpMe.js";import"./OrganizationApi-C5kJOLq0.js";import"./Combination-D_vfDq5J.js";import"./index-B9OW1ajA.js";import"./index-B0ORnztA.js";import"./use-dialog-with-confirm-Cryg7EXi.js";import"./dialog-BfbMbQ8-.js";import"./index-lW_6OgVn.js";import"./x-DoFJH5Nd.js";import"./separator-unOUWFl-.js";import"./index-I18K8_cQ.js";import"./check-Ca0fbDYF.js";import"./chevron-left-CVoIS1tR.js";import"./chevron-right-B2dPWAbi.js";import"./index-DHosPbdR.js";import"./index-BesrJGlS.js";import"./chevron-down-kGCTDs5u.js";import"./popover-DSwKj0iH.js";const Se=l=>l.includes("Rejected")?"destructive":l.includes("Review")?"secondary":l.includes("Processing")?"outline":l.includes("Shipped")?"default":"secondary";function Ne(){const{user:l}=Q(s=>s.auth),[d,m]=a.useState(void 0),[S,I]=a.useState([]),[u,N]=a.useState(void 0),[j,k]=a.useState(1),h=20,[y,A]=a.useState(0),E=Math.ceil(y/h),[B,R]=a.useState(!1),[f,V]=a.useState(!0),[g,M]=a.useState("all"),[p,q]=a.useState(""),[n,$]=a.useState("all"),[H,Y]=a.useState(void 0),C=async()=>{try{const s=new te,t=l?.person?.shop?.id;if(t==null)return;const v=g==="all"?void 0:g,c=K.create({shopId:t,smartFilter:p||void 0,filterByStatus:v,showRepairCompleted:f,dateLastSubmittedFrom:d,dateLastSubmittedTo:u});c.dateLastSubmittedFrom&&(c.dateLastSubmittedFrom=x(d)),c.dateLastSubmittedTo&&(c.dateLastSubmittedTo=x(u));const _=U.create({resultsLimitOffset:(j-1)*h,resultsLimitCount:h,resultsOrderBy:"dateLastSubmitted",resultsOrderAscending:!1});c.resultParameter=_,s.repairOrderSearch(c,{status200:b=>{I(b.repairOrders),A(b.totalItemCount||0)},error:b=>{}})}catch{}},O=z();return a.useEffect(()=>{if(!l)return;const s=l?.person?.type;if(s==="Dealership"||s==="Csr"||s==="FieldStaff"){O({to:"/parts_orders",replace:!0});return}const t=setTimeout(()=>{C()},p?500:0);return()=>clearTimeout(t)},[p,g,f,d,u,l,j]),a.useEffect(()=>{if(n!=="custom"){const{from:s,to:t}=G(n);m(s),N(t)}},[n]),e.jsxs("div",{className:"bg-background min-h-screen",children:[e.jsx("img",{src:se,alt:"Repair Order List",className:"h-full w-full object-cover"}),e.jsx("div",{className:"bg-background border-b",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("h1",{className:"text-foreground text-2xl font-bold",children:"Repair Order List"}),e.jsxs(J,{variant:"default",onClick:()=>{R(!0),Y(void 0)},children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"New Repair Order"]})]})}),e.jsx(re,{open:B,onOpenChange:R,onSuccess:()=>{C()},initialData:H}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"lg:items-cente mb-6 flex flex-col items-center gap-4 lg:flex-row",children:[e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(ve,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(he,{value:p,onChange:s=>q(s.target.value),placeholder:"Filter by RO#, Order #, VIN, Customer",className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(w,{defaultValue:"all",onValueChange:s=>M(s),children:[e.jsx(T,{className:"w-48",children:e.jsx(D,{placeholder:"Status"})}),e.jsxs(L,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"CsrReview",children:"CsrReview"}),e.jsx(r,{value:"CsrRejected",children:"CsrRejected"}),e.jsx(r,{value:"DealershipProcessing",children:"DealershipProcessing"}),e.jsx(r,{value:"DealershipShipped",children:"DealershipShipped"}),e.jsx(r,{value:"ShopReceived",children:"ShopReceived"}),e.jsx(r,{value:"RepairCompleted",children:"RepairCompleted"})]})]}),e.jsxs(w,{defaultValue:n,onValueChange:s=>$(s),children:[e.jsx(T,{className:"w-40",children:e.jsx(D,{placeholder:"Date Range"})}),e.jsxs(L,{children:[e.jsx(r,{value:"all",children:"All Dates"}),e.jsx(r,{value:"7",children:"Past 7 days"}),e.jsx(r,{value:"30",children:"Past 30 Days"}),e.jsx(r,{value:"month-to-date",children:"Month-To-Date"}),e.jsx(r,{value:"quarter-to-date",children:"Quarter-To-Date"}),e.jsx(r,{value:"year-to-date",children:"Year-To-Date"}),e.jsx(r,{value:"last-month",children:"Last Month"}),e.jsx(r,{value:"last-quarter",children:"Last Quarter"}),e.jsx(r,{value:"last-year",children:"Last Year"}),e.jsx(r,{value:"custom",children:"Custom"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"From"}),e.jsx(F,{selected:d,disabled:n!="custom",onSelect:s=>m(s),placeholder:"Select from date"}),e.jsx("span",{className:"text-sm font-medium",children:"To"}),e.jsx(F,{selected:u,disabled:n!="custom",onSelect:s=>N(s),placeholder:"Select to date"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{id:"show-completed",checked:f,onCheckedChange:s=>V(s),className:"rounded-full"}),e.jsx(pe,{htmlFor:"show-completed",className:"cursor-pointer text-sm font-medium",children:"Show Repair Completed"})]})]})]}),S.length===0?e.jsx("div",{children:e.jsx(ie,{children:e.jsxs(oe,{children:[e.jsx(de,{variant:"icon",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(ce,{children:"No data to display"}),e.jsx(me,{children:"There are no records in this table yet. Add your first entry to get started."})]})})}):e.jsxs("div",{children:[e.jsx("div",{className:"bg-card overflow-hidden rounded-lg border shadow-sm",children:e.jsxs(xe,{children:[e.jsx(je,{children:e.jsxs(P,{className:"bg-muted",children:[e.jsx(i,{className:"text-foreground font-semibold",children:"RO #"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Order #"}),e.jsx(i,{className:"text-foreground font-semibold",children:"VIN"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Year/Make/Model"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Status"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Customer"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Date Submitted"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Date Completed"})]})}),e.jsx(fe,{children:S.map(s=>{const t=s,v=t.year&&t.make&&t.model?`${t.year} ${t.make} ${t.model}`:"--";return e.jsxs(P,{className:"hover:bg-muted/50",children:[e.jsx(o,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.hasAlert&&e.jsx(be,{className:"text-destructive h-4 w-4"}),e.jsx("span",{className:"cursor-pointer text-blue-600 hover:underline",onClick:()=>{O({to:"/repair_orders/$id",params:{id:t.id.toString()}})},children:t.roNumber||"--"})]})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-1",children:t.salesOrderNumber?e.jsx("div",{children:t.salesOrderNumber}):e.jsx("div",{children:"--"})})}),e.jsx(o,{className:"font-mono text-sm",children:t.vin||"--"}),e.jsx(o,{children:v}),e.jsx(o,{children:e.jsx(ae,{variant:Se(t.status||""),className:"whitespace-nowrap",children:t.status||"--"})}),e.jsx(o,{children:t.customer||"--"}),e.jsx(o,{children:x(t.dateLastSubmitted)}),e.jsx(o,{className:"text-muted-foreground",children:x(t.dateClosed)})]},t.id||t.roNumber)})})]})}),e.jsx(ue,{currentPage:j,totalPages:E,totalItems:y,itemsPerPage:h,onPageChange:k})]})]})]})}function st(){const{isAuthenticated:l,isLoading:d}=Z(),m=W();return d||!l?e.jsx(ee,{}):m.pathname==="/repair_orders"?e.jsx(Ne,{}):e.jsx(X,{})}export{st as component};
