import{i as me,r as a,b as ue,j as e,B as he,s as pe,C as xe,w as H,y as fe,P as je,t as I,z as ge}from"./index-Bkm0i40-.js";import{O as Se}from"./OrderApi-CGuh07sy.js";import{B as ve}from"./badge-MEVRXxP2.js";import{C as be}from"./checkbox-s4dkUmJo.js";import{C as ye,E as Ce,a as Ne,b as De,T as Re,c as Te,d as Oe,D as Pe}from"./clearable-input-CleWMoZm.js";import{L as we}from"./label-BN8Qe8K3.js";import{S as R,a as T,b as O,c as P,d as r}from"./select-CXq6ZKY2.js";import{T as Be,a as Ie,b as w,c as i,d as Ae,e as n}from"./table-t_A_f_TD.js";import{T as Ee,a as Le,b as $e,c as ke}from"./tooltip-DwlT4A8H.js";import{D as Me,u as Fe}from"./DateRangePicker-d2Mn7GNR.js";import{D as Ve}from"./download-yrhL80Yv.js";import{S as qe}from"./search-BInq9IsI.js";import{L as He}from"./Loading-Z72NCMiE.js";import"./index-CnmrjRy4.js";import"./index-Dti7BYom.js";import"./index-B51CDgwY.js";import"./index-BeLrdImO.js";import"./check-BRFXV1aI.js";import"./chevron-left-RM5v8unW.js";import"./chevron-right-C97o7tEJ.js";import"./input-DaKq_e4d.js";import"./x-CsoNbFna.js";import"./index-ChYaYNrd.js";import"./index-Dt-JkpPh.js";import"./Combination-K-YKTF--.js";import"./index-CN5U3HPo.js";import"./index-CM-w1TYN.js";import"./chevron-down-Cduf7_rY.js";import"./chevron-up-Ci4wS3K6.js";import"./calendar-CwXp5SEl.js";import"./popover-PyNfnk6w.js";function Ye(){const{user:d}=me(t=>t.auth),[p,Y]=a.useState(!1),[A,E]=a.useState(void 0),[L,$]=a.useState(void 0),[y,Q]=a.useState("all"),[j,z]=a.useState("all"),[g,U]=a.useState("all"),[S,W]=a.useState("all"),[C,k]=a.useState(1),[v,_]=a.useState(""),[N,G]=a.useState([]),[M,J]=a.useState(0),[K,b]=a.useState(!1),x=20,X=Math.ceil(M/x),Z=ue(),[ee,F]=a.useState(),B=a.useRef(null),[te,se]=a.useState([]),re=()=>{const t=(C-1)*x,s=t+x;return N.slice(t,s).map(c=>{const l=c.repairOrder||{},o=l.shop||{},u=l.dealership||{};return{"RO#":l.roNumber||"--","Sales#":c.salesOrderNumber||"--",Type:q(c.partsOrderNumber||0),VIN:l.vin||"--","Year/Make/Model":[l.year,l.make,l.model].filter(Boolean).join(" ")||"--",Status:c.status||"--",Shop:o.name?`${o.name} (${o.id})`:"--",Dealer:u.name?`${u.name} (${u.id})`:"--","CSR Region":l.region||"--","Date Completed":D(c.dateCreated),"Date Closed":D(l.dateClosed)||"--"}})},ae=async()=>{try{const t=re();await ge(t,te)&&I.success("Exported successfully")}catch{I.error("Export failed")}};a.useEffect(()=>{if(B.current){const t=B.current.querySelectorAll("thead th"),s=Array.from(t).map(m=>m.textContent.trim());se(s)}},[N]);const le=t=>{switch(t){case"CsrReview":return"CSR Review";case"CsrRejected":return"Csr Rejected";case"DealershipProcessing":return"Dealer Processing";case"DealershipShipped":return"Dealer Shipped";case"ShopReceived":return"Shop Received";case"RepairCompleted":return"Repair Completed"}},V=async(t,s)=>{if(d){b(!0);try{const m=new Se,c=A?H(A):void 0,l=L?H(L):void 0,o={smartFilter:v,filterByWaitingOnMe:p,filterByDealershipId:d?.person?.type==="Dealership"?d?.person?.dealership.id:void 0};j!=="all"&&(o.filterByPartsOrderNumber=parseInt(j)),g!=="all"&&(o.filterByStatus=g),S!=="all"&&(o.filterByRegionId=parseInt(S));const u=fe.create({resultsLimitOffset:(C-1)*x,resultsLimitCount:x,resultsOrderBy:"dateSubmitted",resultsOrderAscending:!1});o.resultParameter=u;const h=je.create(o);c&&(h.dateSubmittedFrom=c),l&&(h.dateSubmittedTo=l),t&&!s&&(h.dateSubmittedFrom=void 0,h.dateSubmittedTo=void 0),m.partsOrderSearch(h,{status200:f=>{G(f.partOrders||[]),J(f.totalItemCount||0),b(!1)},error:f=>{I.error(`Error: ${f||"Failed to fetch data"}`),b(!1)},else:()=>{b(!1)}})}catch{b(!1)}}};a.useEffect(()=>{if(!d)return;const t=setTimeout(()=>{V()},v?500:0);return()=>clearTimeout(t)},[v,p,j,g,S,y,C,d]),a.useEffect(()=>{k(1)},[v,p,j,g,S,y]);const D=t=>{if(!t)return"--";const s=typeof t=="string"?new Date(t):t;return isNaN(s.getTime())?"--":s.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"})},q=t=>t===0?"Parts Order":t===1?"Supplement 1":t===2?"Supplement 2":`Supplement ${t}`;return e.jsx("div",{className:"min-h-scree",children:e.jsxs("div",{className:"bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("h1",{className:"text-foreground text-2xl font-bold",children:"Parts Order List"}),e.jsxs(he,{onClick:ae,children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Report"]})]}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 lg:flex-row lg:items-center",children:[e.jsxs("div",{className:"relative max-w-md flex-1",children:[e.jsx(qe,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(ye,{value:v,onChange:t=>_(t.target.value),placeholder:"Filter by RO#, Sales Order #, VIN, Shop, Dealer",className:"pl-10"})]}),(d?.person?.type==="Csr"||d?.person?.type==="Dealership")&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{id:"my-orders",checked:p,onCheckedChange:t=>Y(t),className:"bg-muted rounded-full"}),e.jsx(we,{htmlFor:"my-orders",className:"flex cursor-pointer items-center gap-2 text-sm font-medium",children:"Only View Parts Orders that are waiting On Me"})]})]}),e.jsxs("div",{className:"mb-6 flex flex-wrap items-center gap-3",children:[e.jsxs(R,{value:j,onValueChange:t=>z(t),children:[e.jsx(T,{className:"bg-muted w-48",children:e.jsx(O,{placeholder:"Type of Order"})}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"All Types"}),e.jsx(r,{value:"0",children:"original Parts Order"}),e.jsx(r,{value:"1",children:"Supplement #1"}),e.jsx(r,{value:"2",children:"Supplement #2"}),e.jsx(r,{value:"3",children:"Supplement #3"})]})]}),e.jsxs(R,{value:g,onValueChange:t=>U(t),children:[e.jsx(T,{className:"bg-muted w-48",children:e.jsx(O,{placeholder:"Status"})}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"CsrReview",children:"CSR Review"}),e.jsx(r,{value:"CsrRejected",children:"CSR Rejected"}),e.jsx(r,{value:"DealershipProcessing",children:"Dealer Processing"}),e.jsx(r,{value:"DealershipShipped",children:"Dealer Shipped"}),e.jsx(r,{value:"ShopReceived",children:"Shop Received"}),e.jsx(r,{value:"RepairCompleted",children:"Repair Completed"})]})]}),e.jsxs(R,{value:S,onValueChange:t=>W(t),children:[e.jsx(T,{className:"bg-muted w-48",children:e.jsx(O,{placeholder:"CSR Region"})}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"All Regions"}),d?.regions?.map(t=>e.jsx(r,{value:t.id?.toString()||"",children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Date Submitted Range"}),e.jsxs(R,{value:y,onValueChange:t=>{F(void 0),Q(t);const{from:s,to:m}=pe(t);E(s),$(m)},children:[e.jsx(T,{className:"bg-muted w-48",children:e.jsx(O,{placeholder:"ALL Dates"})}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"All Dates"}),e.jsx(r,{value:"7",children:"Past 7 days"}),e.jsx(r,{value:"30",children:"Past 30 Days"}),e.jsx(r,{value:"month-to-date",children:"Month-To-Date"}),e.jsx(r,{value:"quarter-to-date",children:"Quarter-To-Date"}),e.jsx(r,{value:"year-to-date",children:"Year-To-Date"}),e.jsx(r,{value:"last-month",children:"Last Month"}),e.jsx(r,{value:"last-quarter",children:"Last Quarter"}),e.jsx(r,{value:"last-year",children:"Last Year"}),e.jsx(r,{value:"custom",children:"Custom"})]})]})]}),y==="custom"&&e.jsx(Me,{value:ee,onChange:t=>{F(t),E(t?.from??void 0),$(t?.to??void 0)},onClose:t=>{V(!0,t)},placeholder:"Select date range",disabled:!1})]}),e.jsx("div",{className:"bg-background overflow-hidden rounded-lg border shadow-sm",children:e.jsxs(Be,{ref:B,children:[e.jsx(Ie,{children:e.jsxs(w,{className:"bg-muted",children:[e.jsx(i,{className:"text-foreground font-semibold",children:"RO#"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Sales#"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Type"}),e.jsx(i,{className:"text-foreground font-semibold",children:"VIN"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Year/Make/Model"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Status"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Shop"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Dealer"}),e.jsx(i,{className:"text-foreground font-semibold",children:"CSR Region"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Date Completed"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Date Closed"})]})}),e.jsx(Ae,{children:K?e.jsx(w,{children:e.jsx(n,{colSpan:11,className:"py-8 text-center",children:"loading..."})}):N.length===0?e.jsx(w,{children:e.jsx(n,{colSpan:11,className:"py-8 text-center",children:e.jsx(Ce,{children:e.jsxs(Ne,{children:[e.jsx(De,{variant:"icon",children:e.jsx(Re,{className:"h-4 w-4"})}),e.jsx(Te,{children:"No data to display"}),e.jsx(Oe,{children:"There are no records in this table yet. Add your first entry to get started."})]})})})}):N.map(t=>{const s=t.repairOrder,m=s?.roNumber||"--",c=t.salesOrderNumber||"--",l=q(t.partsOrderNumber||0),o=s?.vin||"--",u=s&&`${s.year||""} ${s.make||""} ${s.model||""}`.trim()||"--",h=t.status||"--",f=s?.shop?`${s.shop.name||""} (${s.shop.id||""})`:"--",ne=s?.dealership?`${s.dealership.name||""} (${s.dealership.id||""})`:"--",oe=s?.region||"--",ie=D(t.dateCreated),de=D(s?.dateClosed),ce=s?.dealership.id!==s?.shop.sponsorDealership.id;return e.jsxs(w,{className:"hover:bg-muted/50",children:[e.jsx(n,{className:"cursor-pointer text-blue-600 underline",onClick:()=>{Z({to:"/repair_orders/$id",params:{id:t.repairOrder.id.toString()}})},children:m}),e.jsx(n,{children:c}),e.jsx(n,{children:l}),e.jsx(n,{className:"font-mono text-xs",children:o}),e.jsx(n,{children:u}),e.jsx(n,{children:e.jsx(ve,{variant:"secondary",className:"whitespace-nowrap",children:le(h)})}),e.jsx(n,{className:"text-sm",children:f}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[ce&&e.jsx(Ee,{children:e.jsxs(Le,{children:[e.jsx($e,{asChild:!0,children:e.jsx(xe,{className:"h-4 w-4 text-yellow-600 cursor-pointer"})}),e.jsx(ke,{children:e.jsx("p",{children:"Ordered from an alternate dealer"})})]})}),e.jsx("span",{className:"text-sm",children:ne})]})}),e.jsx(n,{children:oe}),e.jsx(n,{children:ie}),e.jsx(n,{children:de||"--"})]},t.id)})})]})}),e.jsx(Pe,{currentPage:C,totalPages:X,totalItems:M,itemsPerPage:x,onPageChange:k})]})]})})}function bt(){const{isAuthenticated:d,isLoading:p}=Fe();return p||!d?e.jsx(He,{}):e.jsx(Ye,{})}export{bt as component};
