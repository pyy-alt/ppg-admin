import{i as me,r as a,b as ue,j as e,B as pe,s as he,C as xe,w as H,y as je,P as fe,t as I,z as ge}from"./index-Bkm0i40-.js";import{H as Se}from"./header-only-layout-DIMOGv9B.js";import{O as ve}from"./OrderApi-CGuh07sy.js";import{B as ye}from"./badge-MEVRXxP2.js";import{C as be}from"./checkbox-s4dkUmJo.js";import{C as Ce,E as Ne,a as De,b as Re,T as Oe,c as Te,d as Pe,D as we}from"./clearable-input-CleWMoZm.js";import{L as Be}from"./label-BN8Qe8K3.js";import{S as R,a as O,b as T,c as P,d as r}from"./select-CXq6ZKY2.js";import{T as Ie,a as Le,b as w,c as d,d as Ee,e as o}from"./table-t_A_f_TD.js";import{T as $e,a as Ae,b as ke,c as Me}from"./tooltip-DwlT4A8H.js";import{D as Fe,u as Ve}from"./DateRangePicker-d2Mn7GNR.js";import{D as qe}from"./download-yrhL80Yv.js";import{S as He}from"./search-BInq9IsI.js";import{L as Ye}from"./Loading-Z72NCMiE.js";import"./header-Vf3flhB_.js";import"./PersonApi-BZdXp9je.js";import"./ViewTeamDialog-CoFVDWax.js";import"./dialog-DSGLXfvZ.js";import"./index-CnmrjRy4.js";import"./index-CN5U3HPo.js";import"./Combination-K-YKTF--.js";import"./index-BeLrdImO.js";import"./x-CsoNbFna.js";import"./separator-Bthd58uT.js";import"./users-uvAbHv3x.js";import"./dropdown-menu-BJ11OL3K.js";import"./index-Dt-JkpPh.js";import"./index-CM-w1TYN.js";import"./index-B51CDgwY.js";import"./index-tCO809zo.js";import"./check-BRFXV1aI.js";import"./chevron-right-C97o7tEJ.js";import"./form-FwhVnNbA.js";import"./input-DaKq_e4d.js";import"./search-provider-Ch1B4iWn.js";import"./command-DLpKp-qg.js";import"./building-2-jFbUc3tZ.js";import"./scroll-area-Cgs0ge7_.js";import"./index-ChYaYNrd.js";import"./index-Dti7BYom.js";import"./chevron-left-RM5v8unW.js";import"./chevron-down-Cduf7_rY.js";import"./chevron-up-Ci4wS3K6.js";import"./calendar-CwXp5SEl.js";import"./popover-PyNfnk6w.js";function Qe(){const{user:n}=me(t=>t.auth),[h,Y]=a.useState(!0),[L,E]=a.useState(void 0),[$,A]=a.useState(void 0),[b,Q]=a.useState("all"),[f,z]=a.useState("all"),[g,U]=a.useState("all"),[S,W]=a.useState("all"),[C,k]=a.useState(1),[v,_]=a.useState(""),[N,G]=a.useState([]),[M,J]=a.useState(0),[K,y]=a.useState(!1),x=20,X=Math.ceil(M/x),Z=ue(),B=a.useRef(null),[ee,te]=a.useState([]),[se,F]=a.useState(),re=()=>{const t=(C-1)*x,s=t+x;return N.slice(t,s).map(c=>{const l=c.repairOrder||{},i=l.shop||{},u=l.dealership||{};return{"RO#":l.roNumber||"--","Sales#":c.salesOrderNumber||"--",Type:q(c.partsOrderNumber||0),VIN:l.vin||"--","Year/Make/Model":[l.year,l.make,l.model].filter(Boolean).join(" ")||"--",Status:c.status||"--",Shop:i.name?`${i.name} (${i.id})`:"--",Dealer:u.name?`${u.name} (${u.id})`:"--","CSR Region":l.region||"--","Date Completed":D(c.dateCreated),"Date Closed":D(l.dateClosed)||"--"}})},ae=async()=>{try{const t=re();await ge(t,ee)&&I.success("Exported successfully")}catch{I.error("Export failed")}};a.useEffect(()=>{if(B.current){const t=B.current.querySelectorAll("thead th"),s=Array.from(t).map(m=>m.textContent.trim());te(s)}},[N]);const le=t=>{switch(t){case"CsrReview":return"CSR Review";case"CsrRejected":return"Csr Rejected";case"DealershipProcessing":return"Dealer Processing";case"DealershipShipped":return"Dealer Shipped";case"ShopReceived":return"Shop Received";case"RepairCompleted":return"Repair Completed"}},V=async(t,s)=>{if(n){y(!0);try{const m=new ve,c=L?H(L):void 0,l=$?H($):void 0,i={smartFilter:v,filterByWaitingOnMe:h,filterByDealershipId:n?.person?.type==="Dealership"?n?.person?.dealership.id:void 0};f!=="all"&&(i.filterByPartsOrderNumber=parseInt(f)),g!=="all"&&(i.filterByStatus=g),S!=="all"&&(i.filterByRegionId=parseInt(S));const u=je.create({resultsLimitOffset:(C-1)*x,resultsLimitCount:x,resultsOrderBy:"dateSubmitted",resultsOrderAscending:!1});i.resultParameter=u;const p=fe.create(i);c&&(p.dateSubmittedFrom=c),l&&(p.dateSubmittedTo=l),t&&!s&&(p.dateSubmittedFrom=void 0,p.dateSubmittedTo=void 0),m.partsOrderSearch(p,{status200:j=>{G(j.partOrders||[]),J(j.totalItemCount||0),y(!1)},error:j=>{I.error(`Error: ${j||"Failed to fetch data"}`),y(!1)},else:()=>{y(!1)}})}catch{y(!1)}}};a.useEffect(()=>{if(!n)return;const t=setTimeout(()=>{V()},v?500:0);return()=>clearTimeout(t)},[v,h,f,g,S,b,C,n]),a.useEffect(()=>{k(1)},[v,h,f,g,S,b]);const D=t=>{if(!t)return"--";const s=typeof t=="string"?new Date(t):t;return isNaN(s.getTime())?"--":s.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"})},q=t=>t===0?"Parts Order":t===1?"Supplement 1":t===2?"Supplement 2":`Supplement ${t}`;return e.jsx("div",{className:"min-h-scree",children:e.jsxs("div",{className:"bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("h1",{className:"text-foreground text-2xl font-bold",children:"Parts Order List"}),e.jsxs(pe,{onClick:ae,children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Report"]})]}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 lg:flex-row lg:items-center",children:[e.jsxs("div",{className:"relative max-w-md flex-1",children:[e.jsx(He,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(Ce,{value:v,onChange:t=>_(t.target.value),placeholder:"Filter by RO#, Sales Order #, VIN, Shop, Dealer",className:"pl-10"})]}),(n?.person?.type==="Csr"||n?.person?.type==="Dealership")&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{id:"my-orders",checked:h,onCheckedChange:t=>Y(t),className:"bg-muted rounded-full"}),e.jsx(Be,{htmlFor:"my-orders",className:"flex cursor-pointer items-center gap-2 text-sm font-medium",children:"Only View Parts Orders that are waiting On Me"})]})]}),e.jsxs("div",{className:"mb-6 flex flex-wrap items-center gap-3",children:[e.jsxs(R,{value:f,onValueChange:t=>z(t),children:[e.jsx(O,{className:"bg-muted w-48",children:e.jsx(T,{placeholder:"Type of Order"})}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"All Types"}),e.jsx(r,{value:"0",children:"original Parts Order"}),e.jsx(r,{value:"1",children:"Supplement #1"}),e.jsx(r,{value:"2",children:"Supplement #2"}),e.jsx(r,{value:"3",children:"Supplement #3"})]})]}),e.jsxs(R,{value:g,onValueChange:t=>U(t),children:[e.jsx(O,{className:"bg-muted w-48",children:e.jsx(T,{placeholder:"Status"})}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"CsrReview",children:"CSR Review"}),e.jsx(r,{value:"CsrRejected",children:"CSR Rejected"}),e.jsx(r,{value:"DealershipProcessing",children:"Dealer Processing"}),e.jsx(r,{value:"DealershipShipped",children:"Dealer Shipped"}),e.jsx(r,{value:"ShopReceived",children:"Shop Received"}),e.jsx(r,{value:"RepairCompleted",children:"Repair Completed"})]})]}),e.jsxs(R,{value:S,onValueChange:t=>W(t),children:[e.jsx(O,{className:"bg-muted w-48",children:e.jsx(T,{placeholder:"CSR Region"})}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"All Regions"}),n?.regions?.map(t=>e.jsx(r,{value:t.id?.toString()||"",children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Date Submitted Range"}),e.jsxs(R,{value:b,onValueChange:t=>{F(void 0),Q(t);const{from:s,to:m}=he(t);E(s),A(m)},children:[e.jsx(O,{className:"bg-muted w-48",children:e.jsx(T,{placeholder:"ALL Dates"})}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"All Dates"}),e.jsx(r,{value:"7",children:"Past 7 days"}),e.jsx(r,{value:"30",children:"Past 30 Days"}),e.jsx(r,{value:"month-to-date",children:"Month-To-Date"}),e.jsx(r,{value:"quarter-to-date",children:"Quarter-To-Date"}),e.jsx(r,{value:"year-to-date",children:"Year-To-Date"}),e.jsx(r,{value:"last-month",children:"Last Month"}),e.jsx(r,{value:"last-quarter",children:"Last Quarter"}),e.jsx(r,{value:"last-year",children:"Last Year"}),e.jsx(r,{value:"custom",children:"Custom"})]})]})]}),b==="custom"&&e.jsx(Fe,{value:se,onChange:t=>{F(t),E(t?.from??void 0),A(t?.to??void 0)},onClose:t=>{V(!0,t)},placeholder:"Select date range",disabled:!1})]}),e.jsx("div",{className:"bg-background overflow-hidden rounded-lg border shadow-sm",children:e.jsxs(Ie,{ref:B,children:[e.jsx(Le,{children:e.jsxs(w,{className:"bg-muted",children:[e.jsx(d,{className:"text-foreground font-semibold",children:"RO#"}),e.jsx(d,{className:"text-foreground font-semibold",children:"Sales#"}),e.jsx(d,{className:"text-foreground font-semibold",children:"Type"}),e.jsx(d,{className:"text-foreground font-semibold",children:"VIN"}),e.jsx(d,{className:"text-foreground font-semibold",children:"Year/Make/Model"}),e.jsx(d,{className:"text-foreground font-semibold",children:"Status"}),e.jsx(d,{className:"text-foreground font-semibold",children:"Shop"}),e.jsx(d,{className:"text-foreground font-semibold",children:"Dealer"}),e.jsx(d,{className:"text-foreground font-semibold",children:"CSR Region"}),e.jsx(d,{className:"text-foreground font-semibold",children:"Date Completed"}),e.jsx(d,{className:"text-foreground font-semibold",children:"Date Closed"})]})}),e.jsx(Ee,{children:K?e.jsx(w,{children:e.jsx(o,{colSpan:11,className:"py-8 text-center",children:"loading..."})}):N.length===0?e.jsx(w,{children:e.jsx(o,{colSpan:11,className:"py-8 text-center",children:e.jsx(Ne,{children:e.jsxs(De,{children:[e.jsx(Re,{variant:"icon",children:e.jsx(Oe,{className:"h-4 w-4"})}),e.jsx(Te,{children:"No data to display"}),e.jsx(Pe,{children:"No results could be found."})]})})})}):N.map(t=>{const s=t.repairOrder,m=s?.roNumber||"--",c=t.salesOrderNumber||"--",l=q(t.partsOrderNumber||0),i=s?.vin||"--",u=s&&`${s.year||""} ${s.make||""} ${s.model||""}`.trim()||"--",p=t.status||"--",j=s?.shop?`${s.shop.name||""} (${s.shop.id||""})`:"--",oe=s?.dealership?`${s.dealership.name||""} (${s.dealership.id||""})`:"--",ne=n?.person?.csrRegion?.name||"--",ie=D(t.dateCreated),de=D(s?.dateClosed),ce=s?.dealership.id!==s?.shop.sponsorDealership.id;return e.jsxs(w,{className:"hover:bg-muted/50",children:[e.jsx(o,{className:"cursor-pointer text-blue-600 hover:underline",onClick:()=>{Z({to:"/repair_orders/$id",params:{id:t.repairOrder.id.toString()}})},children:m}),e.jsx(o,{children:c}),e.jsx(o,{children:l}),e.jsx(o,{className:"font-mono text-xs",children:i}),e.jsx(o,{children:u}),e.jsx(o,{children:e.jsx(ye,{variant:"secondary",className:"whitespace-nowrap",children:le(p)})}),e.jsx(o,{className:"text-sm",children:j}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[ce&&e.jsx($e,{children:e.jsxs(Ae,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(xe,{className:"h-4 w-4 cursor-help text-yellow-500"})}),e.jsx(Me,{children:e.jsx("p",{children:"Ordered from an alternate dealer"})})]})}),e.jsx("span",{className:"text-sm",children:oe})]})}),e.jsx(o,{children:ne}),e.jsx(o,{children:ie}),e.jsx(o,{children:de||"--"})]},t.id)})})]})}),e.jsx(we,{currentPage:C,totalPages:X,totalItems:M,itemsPerPage:x,onPageChange:k})]})]})})}function At(){const{isAuthenticated:n,isLoading:h}=Ve();return h||!n?e.jsx(Ye,{}):e.jsx(Se,{children:e.jsx(Qe,{})})}export{At as component};
