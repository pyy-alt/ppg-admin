import{r as i,J as B,h as V,a9 as re,j as e,B as D,af as oe,aJ as _,t as q,Y as ne,a2 as le,K as F,aK as $,ab as ie}from"./index-bZPt74SL.js";import{P as X}from"./PersonApi-DoDgYvr6.js";import{C as Q}from"./checkbox-B0TIKdeQ.js";import{E as ce,a as de,b as me,T as xe,c as fe,d as he,D as ue}from"./data-table-pagination-DFlv6pI_.js";import{u as ge,a as je,i as pe,F as Ne,b,c as S,d as y,e as R,f as k,L as M}from"./form-C97xBvhE.js";import{S as H,a as G,b as J,c as K,d as u}from"./select-iVvteLym.js";import{T as ve,a as be,b as z,c as g,d as Se,e as j}from"./table-CDOYvhfH.js";import{u as ye}from"./use-dialog-with-confirm-JhGjfUMb.js";import{D as Re,a as Ce,b as we,c as Fe,e as Ie}from"./dialog-DyU8MlPO.js";import{I as A}from"./input-W45EOFir.js";import{R as Pe,a as ke}from"./radio-group-DWs4KW6h.js";import{S as Ae}from"./separator-AAFKv4Ad.js";import{X as Z}from"./x-BdNzPY10.js";import{P as De}from"./plus-hKtGnEnx.js";import{S as Ee}from"./search-DHWuWzUR.js";import{P as Te}from"./pencil-D035sdlA.js";import"./index-BAv-q7Sn.js";import"./index-DQajRILt.js";import"./index-CJ8ye8BA.js";import"./check-D9nIkqgl.js";import"./chevron-left-BFQH7A4v.js";import"./chevron-right-BMMQv83b.js";import"./index-BDNPEbHM.js";import"./index-B5XdlCk6.js";import"./Combination-C2X8UjKH.js";import"./index-BMiWLKrh.js";import"./chevron-down-DacainfD.js";import"./confirm-dialog-CiE2ZAWb.js";import"./index-RnQ7Y6ex.js";import"./index-BezWuCKb.js";function Ue(l,c,o=500){const f=i.useRef(!0);i.useEffect(()=>{if(f.current){f.current=!1,l();return}const h=setTimeout(()=>{l()},o);return()=>{clearTimeout(h)}},[...c,o])}const Le=B({firstName:F().min(1,"First name is required"),lastName:F().min(1,"Last name is required"),email:F().email("Invalid email address"),role:le(["ProgramAdministrator","Csr","FieldStaff"]).optional().refine(l=>l!==void 0,{message:"Please select a role"}),csrRegion:B({id:$(),name:F()}).optional(),fieldStaffRegions:ne(B({id:$(),name:F()})).optional()});function Be({open:l,onOpenChange:c,initialValues:o,onSuccess:f,onError:h}){const a=ge({resolver:je(Le),defaultValues:{firstName:"",lastName:"",email:"",role:void 0,csrRegion:void 0,fieldStaffRegions:[]}}),p=V(t=>t.auth.user?.regions||[]);i.useEffect(()=>{o&&l?a.reset({firstName:o.firstName||"",lastName:o.lastName||"",email:o.email||"",role:o.type,csrRegion:o.csrRegion,fieldStaffRegions:o.fieldStaffRegions}):!o&&l&&a.reset({firstName:"",lastName:"",email:"",role:void 0,csrRegion:void 0,fieldStaffRegions:[]})},[o,l,a]);const N=pe({control:a.control,name:"role"}),E=N==="FieldStaff",T=N==="Csr",{handleCloseRequest:I,ConfirmDialogComponent:U}=ye({form:a,onClose:()=>{a.reset(),c(!1)},title:"Discard Changes?",description:"You have unsaved changes. Are you sure you want to close? All your changes will be lost."}),v=async t=>{try{const r=oe.create({firstName:t.firstName,lastName:t.lastName,email:t.email,type:t.role,id:o?.id||void 0,csrRegion:t.csrRegion?_.create({id:t.csrRegion.id,name:t.csrRegion.name}):void 0,fieldStaffRegions:t.fieldStaffRegions?t.fieldStaffRegions.map(n=>_.create(n)):[]}),d=new X;await new Promise(n=>{o?d.edit(r,{status200:m=>{f?.(m),q.success("User updated successfully",{position:"top-right"}),c(!1),a.reset(),n(!0)},error:m=>{h?.(m),n(!1)},else:(m,w)=>{q.error(w),n(!1)}}):d.createNetworkUser(r,{status200:m=>{f?.(m),q.success("User created successfully",{position:"top-right"}),c(!1),a.reset(),n(!0)},error:m=>{h?.(m),n(!1)},else:()=>{n(!1)}})})}catch(r){throw h?.(r),r}},C=t=>{t?c(!0):I()};i.useEffect(()=>{N&&(a.setValue("csrRegion",void 0),a.setValue("fieldStaffRegions",[]))},[N,a]);const{t:x}=re();return e.jsxs(e.Fragment,{children:[e.jsx(Re,{open:l,onOpenChange:C,children:e.jsxs(Ce,{className:"sm:max-w-lg",children:[e.jsxs(we,{className:"shrink-0",children:[e.jsx(Fe,{className:"px-6 py-4 text-2xl font-semibold",children:o?"Edit Network User":"Add Network User"}),e.jsx(Ae,{}),e.jsxs("button",{onClick:()=>C(!1),className:"ring-offset-background focus:ring-ring absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsx(Ne,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(v),className:"grid gap-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsx(b,{control:a.control,name:"firstName",render:({field:t})=>e.jsxs(S,{children:[e.jsx(y,{children:x("user.firstName")}),e.jsx(R,{children:e.jsx(A,{placeholder:"Enter first name",...t})}),e.jsx(k,{})]})}),e.jsx(b,{control:a.control,name:"lastName",render:({field:t})=>e.jsxs(S,{children:[e.jsx(y,{children:"Last Name"}),e.jsx(R,{children:e.jsx(A,{placeholder:"Enter last name",...t})}),e.jsx(k,{})]})})]}),e.jsx(b,{control:a.control,name:"email",render:({field:t})=>e.jsxs(S,{children:[e.jsx(y,{children:"Email Address"}),e.jsx(R,{children:e.jsx(A,{type:"email",placeholder:"user@vwgoa.com",...t})}),e.jsx(k,{})]})}),e.jsx(b,{control:a.control,name:"role",render:({field:t})=>e.jsxs(S,{children:[e.jsx(y,{children:"Role"}),e.jsxs(H,{onValueChange:t.onChange,value:t.value,children:[e.jsx(R,{className:"w-full",children:e.jsx(G,{children:e.jsx(J,{placeholder:"Select role"})})}),e.jsxs(K,{children:[e.jsx(u,{value:"ProgramAdministrator",children:"Admin"}),e.jsx(u,{value:"Csr",children:"CSR"}),e.jsx(u,{value:"FieldStaff",children:"Field Staff"})]})]}),e.jsx(k,{})]})}),E&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{children:"Field Staff Region(s))"}),e.jsx("div",{className:"bg-muted space-y-3 rounded-md border p-4",children:p.map(t=>e.jsx(b,{control:a.control,name:"fieldStaffRegions",render:({field:r})=>e.jsxs(S,{className:"flex items-center space-x-3",children:[e.jsx(R,{children:e.jsx(Q,{checked:r.value?.some(d=>d.id===t.id),onCheckedChange:d=>{const n=d?[...r.value||[],{id:t.id,name:t.name}]:(r.value||[]).filter(m=>m.id!==t.id);r.onChange(n)}})}),e.jsx(y,{className:"cursor-pointer font-normal",children:t.name})]})},t.id))})]}),T&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{children:"CSR Region"}),e.jsx("div",{className:"bg-muted space-y-3 rounded-md border p-4",children:e.jsx(b,{control:a.control,name:"csrRegion",render:({field:t})=>e.jsx(Pe,{value:t.value?.id?.toString()||"",onValueChange:r=>{const d=p.find(n=>n.id?.toString()===r);t.onChange(d?{id:d.id,name:d.name}:void 0)},children:p.map(r=>e.jsxs(S,{className:"flex items-center space-y-0 space-x-3",children:[e.jsx(R,{children:e.jsx(ke,{value:r.id?.toString()||"",id:r.id?.toString()||""})}),e.jsx(y,{htmlFor:r.id?.toString()||"",className:"cursor-pointer font-normal",children:r.name})]},r.id))})})})]}),e.jsxs(Ie,{className:"mt-4 gap-3 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>C(!1),children:x("common.cancel")}),e.jsx(D,{type:"submit",variant:"default",disabled:a.formState.isSubmitting,children:o?a.formState.isSubmitting?x("common.submiting"):x("common.submit"):a.formState.isSubmitting?x("common.creating"):x("common.create")})]})]})})]})}),U," "]})}function qe({value:l,onChange:c,className:o,...f}){const h=()=>{if(!c)return;c({target:{value:""}})},a=typeof l=="string"&&l.length>0;return e.jsxs("div",{className:"relative flex-1",children:[e.jsx(A,{...f,value:l,onChange:c,className:`${o??""} pr-8`}),a&&e.jsx(D,{type:"button",variant:"ghost",size:"icon",className:"absolute top-1/2 right-1 h-5 w-5 -translate-y-1/2 rounded-full hover:bg-muted",onClick:h,children:e.jsx(Z,{className:"h-3 w-3 text-muted-foreground"})})]})}function Me(){const[l,c]=i.useState(!1),[o,f]=i.useState([]),[h,a]=i.useState(null),[p,N]=i.useState(0),[E,T]=i.useState(1),I=20,U=Math.ceil(p/I),[v,C]=i.useState(""),[x,t]=i.useState(void 0),[r,d]=i.useState(null),[n,m]=i.useState(!1),[w,O]=i.useState(),ee=V(s=>s.auth.user?.regions||[]);i.useEffect(()=>{r&&O(r.id)},[r]);const W=(s="",P=!1,te,ae)=>{try{const Y=ie.create({smartFilter:s,includeInactiveFlag:P,type:"Network",filterByRegionId:te,filterByNetworkRole:ae});new X().search(Y,{status200:L=>{f(L.persons),N(L.totalItemCount)},error:L=>{}})}catch{}},se=s=>{try{a(s),c(!0)}catch{}};return Ue(()=>{W(v,n,w,x)},[v,n,w,x],1e3),e.jsxs("div",{className:"bg-background text-foreground min-h-screen",children:[e.jsx("div",{className:"bg-background border-b",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("h1",{className:"text-foreground text-2xl font-bold",children:"Manage Network Users"}),e.jsxs(D,{onClick:()=>{a(null),c(!0)},children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Add New User"]})]})}),e.jsx(Be,{open:l,onOpenChange:c,initialValues:h,filterByRegion:r,onSuccess:()=>{W(v,n,w,x)},onError:s=>{}}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 lg:flex-row lg:items-center",children:[e.jsxs("div",{className:"relative max-w-md flex-1",children:[e.jsx(Ee,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(qe,{placeholder:"Filter by First Name, Last Name, Email",value:v,onChange:s=>C(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(H,{defaultValue:"all",onValueChange:s=>t(s==="all"?void 0:s),children:[e.jsx(G,{className:"bg-muted w-48",children:e.jsx(J,{placeholder:"Role"})}),e.jsxs(K,{children:[e.jsx(u,{value:"all",children:"All Roles"}),e.jsx(u,{value:"Csr",children:"Csr"}),e.jsx(u,{value:"FieldStaff",children:"FieldStaff"}),e.jsx(u,{value:"ProgramAdministrator",children:"ProgramAdministrator"})]})]}),e.jsxs(H,{defaultValue:"all",onValueChange:s=>{s==="all"?O(void 0):typeof s=="object"&&d(s)},children:[e.jsx(G,{className:"bg-muted w-48",children:e.jsx(J,{placeholder:"CSR Region"})}),e.jsxs(K,{children:[e.jsx(u,{value:"all",children:"All Regions"}),ee.map(s=>e.jsx(u,{value:s,children:s.name},s.id))]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"rounded-full",id:"show-inactive",onCheckedChange:s=>m(s)}),e.jsx(M,{htmlFor:"show-inactive",className:"cursor-pointer text-sm font-medium",children:"Show Inactive Users"})]})]})]}),o.length===0?e.jsx("div",{children:e.jsx(ce,{children:e.jsxs(de,{children:[e.jsx(me,{variant:"icon",children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(fe,{children:"No data to display"}),e.jsx(he,{children:"There are no records in this table yet. Add your first entry to get started."})]})})}):e.jsxs("div",{children:[e.jsx("div",{className:"bg-background overflow-hidden rounded-lg border shadow-sm",children:e.jsxs(ve,{children:[e.jsx(be,{children:e.jsxs(z,{className:"bg-muted",children:[e.jsx(g,{className:"text-foreground font-semibold",children:"First Name"}),e.jsx(g,{className:"text-foreground font-semibold",children:"Last Name"}),e.jsx(g,{className:"text-foreground font-semibold",children:"Email"}),e.jsx(g,{className:"text-foreground font-semibold",children:"Role"}),e.jsx(g,{className:"text-foreground font-semibold",children:"Region"}),e.jsx(g,{className:"text-foreground font-semibold",children:"Date Added"}),e.jsx(g,{className:"text-foreground font-semibold",children:"Date Last Accessed"}),e.jsx(g,{className:"text-foreground font-semibold",children:"Status"})]})}),e.jsx(Se,{children:o.map(s=>e.jsxs(z,{className:"hover:bg-background",children:[e.jsx(j,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-1",onClick:()=>se(s),children:[e.jsx(Te,{className:"h-4 w-4 hover:underline"}),e.jsx("span",{className:s.status==="Pending"?"cursor-pointer text-orange-600 hover:underline":s.status==="Inactive"?"text-gray-300":"text-foreground cursor-pointer hover:underline",children:s.firstName})]})}),e.jsx(j,{className:s.status==="Inactive"?"text-gray-300":s.status==="Pending"?"text-orange-600":"",children:s.lastName}),e.jsx(j,{className:"text-sm",children:s.status==="Inactive"?e.jsx("span",{className:"text-gray-300",children:s.email}):s.email}),e.jsx(j,{children:s.status==="Inactive"?e.jsx("span",{className:"text-gray-300",children:s.type}):s.type}),e.jsx(j,{className:s.status==="Inactive"?"text-gray-300":"",children:s.type==="Csr"?s.csrRegion?.name||"--":s.type==="FieldStaff"?s.fieldStaffRegions?.map(P=>P.name).join(", ")||"--":s.type==="ProgramAdministrator"?"All Regions":"--"}),e.jsx(j,{children:s.status==="Inactive"?e.jsx("span",{className:"text-gray-300",children:s.dateCreated&&new Date(s.dateCreated).toLocaleDateString()||"--"}):s.dateCreated&&new Date(s.dateCreated).toLocaleDateString()||"--"}),e.jsx(j,{className:s.status==="Inactive"?"text-gray-300":s.status==="Pending"?"text-orange-600":"",children:s.dateLastAccess&&new Date(s.dateLastAccess).toLocaleDateString()||"--"}),e.jsx(j,{children:s.status==="Inactive"?e.jsx("span",{className:"text-gray-300",children:s.status}):e.jsx("span",{children:s.status})})]},s.email))})]})}),e.jsx(ue,{currentPage:E,totalPages:U,totalItems:p,itemsPerPage:I,onPageChange:T})]})]})]})}const js=Me;export{js as component};
