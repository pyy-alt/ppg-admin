import{h as I,d as R,a as q,ae as A,r,A as U,t as a,j as e,L as n,i as B,B as F,af as E}from"./index-DvwH5F9Z.js";import{I as g}from"./input-DYarJNKy.js";import{L as w}from"./label-BmEJJfe9.js";import{L as V}from"./Loading-DjNax36X.js";import{H as N,L as y}from"./header-Bwi_1XOA.js";import"./dropdown-menu-qZ9h6nf4.js";import"./index-DXAlcKWc.js";import"./index-CdCeNaJ0.js";import"./Combination-BlpO5CDz.js";import"./index-DZNfOI6o.js";import"./index-B3xR7uaR.js";import"./index-pCYxKcSP.js";import"./check-iYg700vF.js";import"./chevron-right-DH-lXxLl.js";import"./form-LyoIxO0u.js";import"./dialog-KCJIwJT-.js";import"./x-2MONtELq.js";import"./separator--YnZv5Zu.js";import"./user-BoCM7DEh.js";const j=new U;function z(){const d=I("login","_a.png"),v=R(),{auth:c}=q(),{id:u,guid:m,hash:p}=A.useParams();console.log(u,m,p);const[o,f]=r.useState(!1),[b,i]=r.useState(!0),[P,x]=r.useState(!1),[l,k]=r.useState(""),[h,L]=r.useState("");r.useEffect(()=>{j.sessionCreate(u,m,p,{status200:t=>{const s=t.person;if(s){const C={id:s.id||0,email:s.email||"",firstName:s.firstName||"",lastName:s.lastName||"",type:s.type||"Shop",status:s.status||"Active",shopName:s.shop?.name,shopNumber:s.shop?.shopNumber,dealershipName:s.dealership?.name,dealershipNumber:s.dealership?.dealershipNumber};c.setUser(C)}x(!0),i(!1)},status404:()=>{a.error("Reset link is invalid or has expired."),x(!1),i(!1)},error:()=>{a.error("Failed to validate reset link. Please try again."),i(!1)}},null)},[]);const S=async t=>{if(t.preventDefault(),l!==h){a.error("Passwords do not match.");return}if(l.length<8){a.error("Password must be at least 8 characters.");return}f(!0);try{const s=E.create({newPassword:l});j.updatePassword(s,{status200:()=>{a.success("Your password has been successfully updated."),c.reset(),v({to:"/login"})},status409:()=>{a.error("Password update failed. Please try again.")},error:()=>{a.error("Failed to reset password. Please try again.")}})}catch{a.error("Failed to reset password. Please try again.")}finally{f(!1)}};return b?e.jsx(V,{}):P?e.jsxs("div",{className:"flex min-h-screen flex-col bg-background",children:[e.jsx(N,{isShowUser:!1}),e.jsx("div",{style:{backgroundImage:`url(${B})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},className:"flex flex-col items-center justify-center px-6 py-12 lg:py-16",children:d?e.jsx("img",{loading:"lazy",src:d,alt:"logo",className:"mx-auto h-36 w-auto max-w-lg space-y-8 text-center drop-shadow-xl lg:h-56"}):null}),e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-4 py-8",children:e.jsx("div",{className:"w-full max-w-md space-y-10",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx("h1",{className:"text-center text-3xl font-bold text-foreground",children:"Change Password"}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"password",className:"text-sm font-medium text-foreground",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute top-1/2 left-3 h-5 w-5 -translate-y-1/2 text-muted-foreground"}),e.jsx(g,{id:"password",type:"password",placeholder:"Enter new password",className:"h-12 rounded-full  pl-11 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-100",value:l,onChange:t=>k(t.target.value),required:!0,disabled:o})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"confirm",className:"text-sm font-medium text-foreground",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute top-1/2 left-3 h-5 w-5 -translate-y-1/2 text-muted-foreground"}),e.jsx(g,{id:"confirm",type:"password",placeholder:"Confirm new password",className:"h-12 rounded-full  pl-11 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-100",value:h,onChange:t=>L(t.target.value),required:!0,disabled:o})]})]}),e.jsx("div",{className:"text-right",children:e.jsx(n,{to:"/login",className:"text-sm font-medium text-cyan-600 transition-colors hover:text-cyan-700",children:"Back to Login"})}),e.jsx(F,{type:"submit",variant:"default",className:"h-12 w-full rounded-full font-medium shadow-md transition-all",disabled:o,children:o?"Updating...":"Update"})]})]})})})]}):e.jsxs("div",{className:"flex min-h-screen flex-col bg-background",children:[e.jsx(N,{isShowUser:!1}),e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-4 py-8",children:e.jsxs("div",{className:"w-full max-w-md space-y-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Invalid Reset Link"}),e.jsx("p",{className:"text-muted-foreground",children:"The password reset link is invalid or has expired. Please request a new one."}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(n,{to:"/password/forgot",className:"rounded-full px-4 py-2 transition-colors",children:"Request New Link"}),e.jsx(n,{to:"/login",className:"rounded-full border  px-4 py-2 text-foreground transition-colors hover:bg-muted/50",children:"Back to Login"})]})]})})]})}const re=()=>e.jsx(z,{});export{re as component};
