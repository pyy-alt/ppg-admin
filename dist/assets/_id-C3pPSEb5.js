import{j as e,J as Q,r as k,B as y,t as h,w as X,i as re,aI as xe,d as he,aJ as G}from"./index-Bkm0i40-.js";import{O as L}from"./OrderApi-CGuh07sy.js";import{u as ge,F as le,b as fe,U as je,C as ve,c as Ne,N as ie,L as be,v as we,a as ye,W as Re,T as Se,M as Ce,P as Pe,R as Oe}from"./RepairOrderDialog-BANRZSWa.js";import{D as oe,a as ce,b as me,c as pe}from"./dialog-DSGLXfvZ.js";import{L as P}from"./label-BN8Qe8K3.js";import{S as H}from"./separator-Bthd58uT.js";import{X as V}from"./x-CsoNbFna.js";import{T as ke}from"./trash-2-CTCH7piY.js";import{I as Fe}from"./input-DaKq_e4d.js";import{T as Ae}from"./textarea-CRBPewGR.js";import{C as K}from"./check-BRFXV1aI.js";import{B as D}from"./badge-MEVRXxP2.js";import{U as De}from"./users-uvAbHv3x.js";import{M as Te}from"./map-pin-Dk4q35Vy.js";import{P as ne}from"./pencil-f03JEi-E.js";import{T as Ie}from"./confirm-dialog-BSEgRwpb.js";import{P as Me}from"./plus-BIUHcGpT.js";import"./form-FwhVnNbA.js";import"./use-dialog-with-confirm-aTOHhxte.js";import"./OrganizationApi-M1CaO7zV.js";import"./Combination-K-YKTF--.js";import"./index-CnmrjRy4.js";import"./index-CN5U3HPo.js";import"./select-CXq6ZKY2.js";import"./index-ChYaYNrd.js";import"./index-Dt-JkpPh.js";import"./index-CM-w1TYN.js";import"./index-B51CDgwY.js";import"./index-Dti7BYom.js";import"./chevron-down-Cduf7_rY.js";import"./chevron-up-Ci4wS3K6.js";import"./index-BeLrdImO.js";function te({className:c,...m}){return e.jsx("div",{"data-slot":"card",className:Q("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",c),...m})}function Be({className:c,...m}){return e.jsx("div",{"data-slot":"card-header",className:Q("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",c),...m})}function $e({className:c,...m}){return e.jsx("div",{"data-slot":"card-title",className:Q("leading-none font-semibold",c),...m})}function qe({className:c,...m}){return e.jsx("div",{"data-slot":"card-content",className:Q("px-6",c),...m})}function Le({open:c,onOpenChange:m,onComplete:d,initRepaitOrderData:p}){const[F,f]=k.useState([]),{getRootProps:R,getInputProps:o,isDragActive:A}=ge({accept:{"image/*":[]},onDrop:N=>{f(w=>[...w,...N])}}),r=N=>{f(w=>w.filter((j,O)=>O!==N))},b=()=>{if(F.length===0)return h.error("Please upload at least one photo");d?.(F),m(!1)},g=()=>{f([]),m(!1)};return e.jsx(oe,{open:c,onOpenChange:g,children:e.jsxs(ce,{className:"flex max-h-[90vh] flex-col p-0 sm:max-w-4xl",children:[e.jsxs(me,{className:"flex-shrink-0",children:[e.jsx(pe,{className:"px-6 py-4 text-2xl font-semibold",children:"Mark Repair as Complete"}),e.jsx(H,{}),e.jsxs("button",{onClick:g,className:"ring-offset-background focus:ring-ring absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("div",{className:"min-h-0 flex-1 space-y-10 overflow-y-auto p-6 pt-8",children:[e.jsxs("section",{children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-3 text-lg font-medium",children:[e.jsx(le,{className:"text-muted-foreground h-6 w-6"}),"Repair Order Information"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-x-12 gap-y-6 text-sm sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-muted-foreground",children:"Shop RO#"}),e.jsx("p",{className:"text-foreground mt-1.5 font-medium",children:p?.roNumber||"--"})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-muted-foreground",children:"Ordered From Dealership"}),e.jsx("p",{className:"text-foreground mt-1.5 font-medium",children:p?.dealership?.name||"--"})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-muted-foreground",children:"Customer"}),e.jsx("p",{className:"text-foreground mt-1.5 font-medium",children:p?.customer||"--"})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-muted-foreground",children:"VIN"}),e.jsx("p",{className:"text-foreground mt-1.5 font-mono",children:p?.vin||"--"})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-muted-foreground",children:"Year/Make/Model"}),e.jsxs("p",{className:"text-foreground mt-1.5 font-medium",children:[p?.year,"/",p?.make,"/",p?.model]})]})]})]}),e.jsx(H,{className:"bg-border/60"}),e.jsxs("section",{children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-3 text-lg font-medium",children:[e.jsx(fe,{className:"text-muted-foreground h-6 w-6"}),"Attachments"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(P,{className:"text-foreground font-medium",children:["Post-Repair Photos ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{...R(),className:`relative cursor-pointer rounded-lg border-2 border-dashed p-12 text-center transition-all ${A?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:[e.jsx("input",{...o()}),e.jsx(je,{className:"text-muted-foreground mx-auto mb-4 h-12 w-12"}),e.jsxs("p",{className:"text-muted-foreground",children:["Drop your photos here or"," ",e.jsx("span",{className:"text-primary font-medium hover:underline",children:"click to browse"})]})]}),e.jsxs(y,{variant:"outline",size:"sm",className:"w-fit",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Open camera"]})]}),e.jsx("div",{children:F.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:F.map((N,w)=>e.jsxs("div",{className:"flex items-center justify-between rounded-md p-1.5",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"text-left",children:e.jsx("p",{className:"max-w-xs truncate text-sm font-medium text-blue-500 hover:underline",children:N.name})})}),e.jsx("button",{type:"button",onClick:j=>{j.stopPropagation(),r(w)},className:"text-destructive hover:bg-destructive/10 rounded p-1",children:e.jsx(ke,{className:"h-4 w-4"})})]},w))})})]})]}),e.jsxs("div",{className:"bg-muted/30 flex items-center justify-end gap-3 border-t px-6 py-4",children:[e.jsx(y,{variant:"outline",size:"lg",onClick:g,children:"Cancel"}),e.jsx(y,{size:"lg",className:"bg-black px-8 font-medium text-white hover:bg-black/90",onClick:b,children:"Mark Repair as Complete"})]})]})})}function ze({open:c,onOpenChange:m,onApprove:d,isReject:p=!1,onReject:F,initRepaitOrderData:f,selectPartsOrderData:R}){const[o,A]=k.useState(""),[r,b]=k.useState(""),[g,N]=k.useState(!1),w=()=>new Promise(async j=>{try{if(p){if(!r){h.error("Reason for rejection is required");return}}else if(!o){h.error("Sales order number is required");return}N(!0),p?(await F?.(r),j(void 0)):(await d?.(o),j(void 0)),b(""),A(""),m(!1),j(void 0)}catch(O){h.error(`Failed to ${p?"reject":"approve"} parts order ${O}|`),j(void 0)}finally{N(!1)}});return e.jsx(oe,{open:c,onOpenChange:m,children:e.jsxs(ce,{className:"max-h-screen overflow-y-auto sm:max-w-5xl",children:[e.jsxs(me,{children:[e.jsxs(pe,{className:"flex items-center gap-3 text-2xl font-semibold",children:[p?e.jsx(V,{className:"h-7 w-7 rounded-full bg-red-500 p-1 text-white"}):e.jsx(K,{className:"h-7 w-7 rounded-full bg-green-500 p-1 text-white"}),p?"Parts Order Rejected":"Parts Order Approved"]}),e.jsx(H,{}),e.jsxs("button",{onClick:()=>m(!1),className:"focus:ring-ring absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("div",{className:"space-y-10 p-6 pt-8",children:[e.jsxs("section",{children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-3 text-lg font-medium",children:[e.jsx(le,{className:"text-muted-foreground h-6 w-6"}),"Repair Order Information"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-x-12 gap-y-6 text-sm sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-muted-foreground",children:"Shop RO#"}),e.jsx("p",{className:"text-foreground mt-1.5 font-medium",children:f?.roNumber||"--"})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-muted-foreground",children:"Ordered From Dealership"}),e.jsx("p",{className:"text-foreground mt-1.5 font-medium",children:f?.dealership?.name||"--"})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-muted-foreground",children:"Customer"}),e.jsx("p",{className:"text-foreground mt-1.5 font-medium",children:f?.customer||"--"})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-muted-foreground",children:"VIN"}),e.jsx("p",{className:"text-foreground mt-1.5 font-mono",children:f?.vin||"--"})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-muted-foreground",children:"Year/Make/Model"}),e.jsxs("p",{className:"text-foreground mt-1.5 font-medium",children:[f?.year,"/",f?.make,"/",f?.model]})]})]})]}),e.jsx(H,{className:"bg-border/60"}),e.jsxs("section",{children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-3 text-lg font-medium",children:[e.jsx(Ne,{className:"text-muted-foreground h-6 w-6"}),"Parts Order Information"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-x-12 gap-y-6 text-sm sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-muted-foreground",children:"Order Submitted"}),e.jsxs("p",{className:"mt-1.5",children:[X(f?.dateLastSubmitted)||"--"," by ",R?.submittedByPerson?.firstName+" "+R?.submittedByPerson?.lastName]})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-muted-foreground",children:"Order Approved"}),f?.dateClosed&&e.jsxs("p",{className:"mt-1.5 font-medium",children:[X(f?.dateClosed)||"--"," by ",R?.reviewedByPerson?.firstName+" "+R?.reviewedByPerson?.lastName]})||e.jsx("p",{className:"text-muted-foreground mt-1.5",children:"--"})]}),e.jsxs("div",{children:[e.jsx(P,{className:"text-muted-foreground",children:"Order Shipped"}),R?.shippedByPerson?.dateLastAccess&&e.jsxs("p",{className:"text-muted-foreground mt-1.5",children:[R?.shippedByPerson?.dateLastAccess||"--"," by ",R?.shippedByPerson?.firstName+" "+R?.shippedByPerson?.lastName]})||e.jsx("p",{className:"text-muted-foreground mt-1.5",children:"--"})]})]})]}),e.jsx(H,{className:"bg-border/60"}),p?e.jsxs("section",{children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-3 text-lg font-medium",children:[e.jsx(ie,{className:"text-muted-foreground h-6 w-6"}),"Reason for Rejection"]}),e.jsx(Ae,{value:r,onChange:j=>b(j.target.value),id:"sales-order",placeholder:"Provied a reason for rejection",className:"mt-2 h-11"})]}):e.jsxs("section",{children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-3 text-lg font-medium",children:[e.jsx(ie,{className:"text-muted-foreground h-6 w-6"}),"Sales Order #"]}),e.jsxs("div",{className:"max-w-sm",children:[e.jsx(P,{htmlFor:"sales-order",className:"text-muted-foreground",children:"Assign a Sales Order #"}),e.jsx(Fe,{id:"sales-order",placeholder:"Enter sales order number (e.g. SO-174)",className:"mt-2 h-11",value:o,onChange:j=>A(j.target.value.trim())})]})]})]}),e.jsxs("div",{className:"bg-muted/30 flex items-center justify-end gap-3 border-t px-6 py-4",children:[e.jsx(y,{variant:"outline",size:"lg",onClick:()=>m(!1),children:"Cancel"}),e.jsx(y,{size:"lg",className:p?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700",onClick:w,disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"mr-2 h-4 w-4 animate-spin"}),p?"Rejecting...":"Approving..."]}):p?"Reject":"Approve"})]})]})})}const de=["OrderReview","OrderFulfillment","OrderReceived","RepairCompleted"],T=c=>{if(!c)return"";const m=typeof c=="string"?new Date(c):c;return isNaN(m.getTime())?"":m.toLocaleString("en-US",{month:"2-digit",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},x=c=>c?`${c.firstName||""} ${c.lastName||""}`.trim():"";function Ue({partsOrder:c,onResubmit:m,onMarkReceived:d,onMarkShipped:p,onApprove:F,onReject:f}){const{auth:R}=re(),o=R.user?.person?.type;if(!c)return e.jsxs(te,{className:"p-6",children:[e.jsx("h2",{className:"mb-6 text-2xl font-bold",children:"Parts Tracker"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No parts order data available"})]});const{stage:A,status:r,approvalFlag:b,dateSubmitted:g,dateReviewed:N,dateShipped:w,dateReceived:j,submittedByPerson:O,reviewedByPerson:B,shippedByPerson:U,receivedByPerson:E,orderReviewActivityLogItems:_,orderFulfillmentActivityLogItems:$,orderReceivedActivityLogItems:v}=c,n=(()=>{const t=_&&_?.length>0?_:$&&$?.length>0?$:v&&v?.length>0?v:[],M=t.find(i=>i?.type==="Submitted"),z=t.find(i=>i?.type==="Rejected"),W=t.find(i=>i?.type==="Resubmitted"),S=t.find(i=>i?.type==="Approved"),q=t.find(i=>i?.type==="Shipped"),s=t.find(i=>i?.type==="Unshipped"),a=t.find(i=>i?.type==="Received"),l=t.find(i=>i?.type==="Unreceived");return{submitted:M,rejected:z,resubmitted:W,approved:S,shipped:q,unshipped:s,received:a,unreceived:l}})(),Y=()=>["OrderReview","OrderFulfillment","OrderReceived"],I=()=>{const t=[];let M=A||"OrderReview";A==="OrderFulfillment"&&r==="DealershipShipped"&&w&&(M="OrderReceived"),A==="OrderReceived"&&(r==="ShopReceived"||r==="RepairCompleted")&&j&&(M="RepairCompleted");const z=de.indexOf(M);return Y().forEach(S=>{const q=de.indexOf(S);let s,a,l,i=!1,u=!1;q<z?(s="completed",S==="OrderReview"&&(b===!0||b===!1?(a=N,l=x(B)):(a=g,l=x(O))),S==="OrderFulfillment"&&r==="DealershipShipped"&&w&&(a=w,l=x(U))):q===z&&(S==="OrderReview"?(a=g,l=x(O),b===!0?(s="approved",a=N,l=x(B)):b===!1?(s="rejected",a=N,l=x(B)):r==="CsrReview"&&(s="waiting",i=!0,u=!0)):S==="OrderFulfillment"?(a=N,l=x(B),r==="DealershipProcessing"||r==="DealershipShipped"?r==="DealershipShipped"?(a=w,l=x(U),s="completed"):s="waiting":r==="CsrReview"&&b===!0&&(s="waiting")):S==="OrderReceived"?(a=w,l=x(U),r==="ShopReceived"||r==="RepairCompleted"?(s="completed",a=j,l=x(E)):r==="DealershipShipped"&&(s="waiting"),r==="ShopReceived"&&(s="completed")):S==="RepairCompleted"&&r==="RepairCompleted"&&(s="completed")),t.push({id:q+1,stage:S,title:ee(S),status:s,date:a,by:l,canApprove:i,canReject:u})}),t},ee=t=>({OrderReview:"Order Review",OrderFulfillment:"Order Fulfillment",OrderReceived:"Order Received",RepairCompleted:"Repair Completed"})[t],se=t=>o==="Csr"&&t.stage==="OrderReview"&&r==="CsrReview"&&t.status==="waiting"?e.jsx(D,{className:"bg-blue-700 text-white",children:"Waiting on You"}):o==="Csr"&&t.stage==="OrderFulfillment"&&t.status==="waiting"?e.jsx(D,{className:"text-muted bg-orange-400",children:"Pending Dealer"}):o==="Shop"&&t.stage==="OrderReview"&&r==="CsrReview"&&t.status==="waiting"?e.jsx(D,{className:"text-muted bg-orange-400",children:"Pending CSR"}):o==="Shop"&&t.stage==="OrderReview"&&t.status==="rejected"?e.jsx(D,{className:"bg-blue-100 text-blue-700",children:"Waiting on You"}):o==="Shop"&&t.stage==="OrderFulfillment"&&t.status==="waiting"?e.jsx(D,{className:"text-muted bg-orange-400",children:"Pending Dealer"}):o==="Dealership"&&t.stage==="OrderFulfillment"&&t.status==="waiting"?e.jsx(D,{className:"bg-blue-100 text-blue-700",children:"Waiting on You"}):o==="Shop"&&t.stage==="OrderReceived"&&t.status==="waiting"?e.jsx(D,{className:"bg-blue-100 text-blue-700",children:"Waiting on You"}):(o==="Dealership"||o==="Csr")&&t.stage==="OrderReceived"&&t.status==="waiting"?e.jsx(D,{className:"text-muted bg-orange-400",children:"Pending Shop"}):t.status==="waiting"?e.jsx(D,{className:"bg-blue-100 text-blue-700",children:"Waiting on You"}):t.status==="pending"?t.stage==="OrderReview"&&r==="CsrReview"?e.jsx(D,{className:"text-muted bg-orange-400",children:"Pending CSR"}):e.jsx(D,{className:"bg-gray-400 text-white",children:"Pending"}):null,J=I();return e.jsxs(te,{className:"p-6",children:[e.jsx("h2",{className:"mb-6 text-2xl font-bold",children:"Parts Tracker"}),e.jsx("div",{className:"space-y-8",children:J.map((t,M)=>{const W=t.stage==="OrderReview"&&t.status==="rejected"&&o==="Shop",S=t.stage==="OrderReceived"&&(t.status==="completed"||t.status==="waiting")&&d&&o==="Shop",q=t.stage==="OrderFulfillment"&&(t.status==="waiting"||t.status==="completed"&&r==="DealershipShipped")&&p&&o==="Dealership"&&!j,s=t.canApprove&&t.canReject&&o==="Csr"&&F&&f;return e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`flex h-6 w-6 items-center justify-center rounded-full p-1 text-sm font-bold text-white ${t.status==="approved"||t.status==="completed"?"bg-green-600":t.status==="rejected"?"bg-red-500":t.status==="waiting"?"bg-black":"bg-gray-400"}`,children:t.status==="approved"||t.status==="completed"?e.jsx(K,{className:"h-5 w-5"}):t.status==="rejected"?e.jsx(V,{className:"h-5 w-5"}):t.id}),M<J.length-1&&e.jsx("div",{className:"mt-2 h-full w-px border-l border-gray-300"})]}),e.jsxs("div",{className:"flex-1 pb-8",children:[e.jsxs("div",{className:"mb-1 flex items-center gap-2 p-2",children:[e.jsx("h3",{className:"font-semibold",children:t.title}),se(t)]}),t.stage==="OrderReview"&&e.jsx("div",{className:"space-y-2 text-sm",children:n?e.jsxs(e.Fragment,{children:[n.submitted&&e.jsxs("p",{className:"text-muted-foreground",children:["Request was Submitted on"," ",e.jsx("strong",{children:T(n.submitted.dateCreated)}),n.submitted.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsx("strong",{children:x(n.submitted.person)})]}),"."]}),n.rejected&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-muted-foreground",children:["Request was"," ",e.jsx("span",{className:"font-semibold text-red-600",children:"Rejected"})," ","on"," ",e.jsx("strong",{children:T(n.rejected.dateCreated)}),n.rejected.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsxs("strong",{children:[x(n.rejected.person),"."]})]})]}),n.rejected.comment&&e.jsxs("p",{className:"text-muted-foreground",children:["(Reason: ",n.rejected.comment,")"]})]}),n.resubmitted&&e.jsxs("p",{className:"text-muted-foreground",children:["Request was Resubmitted on"," ",e.jsx("strong",{children:T(n.resubmitted.dateCreated)}),n.resubmitted.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsx("strong",{children:x(n.resubmitted.person)})]}),"."]}),n.approved&&e.jsxs("p",{className:"text-muted-foreground",children:["Request was"," ",e.jsx("span",{className:"font-semibold text-green-600",children:"Approved"})," ","on"," ",e.jsx("strong",{children:T(n.approved.dateCreated)}),n.approved.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsxs("strong",{children:[x(n.approved.person),"."]})]})]})]}):g&&e.jsxs("p",{className:"text-muted-foreground",children:["Request was Submitted on"," ",e.jsx("strong",{children:T(g)}),O&&e.jsxs(e.Fragment,{children:[" by ",e.jsxs("strong",{children:[x(O),"."]})]})]})}),t.stage==="OrderFulfillment"&&e.jsx("div",{className:"space-y-2 text-sm",children:n?e.jsxs(e.Fragment,{children:[n.shipped&&e.jsxs("p",{className:"text-muted-foreground",children:["Parts were Shipped on"," ",e.jsx("strong",{children:T(n.shipped.dateCreated)}),n.shipped.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsx("strong",{children:x(n.shipped.person)})]})]}),n.unshipped&&e.jsxs("p",{className:"text-muted-foreground",children:["Parts were Unshipped on"," ",e.jsx("strong",{children:T(n.unshipped.dateCreated)}),n.unshipped.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsx("strong",{children:x(n.unshipped.person)})]})]})]}):g&&e.jsxs("p",{className:"text-muted-foreground",children:["Request was Submitted on"," ",e.jsx("strong",{children:T(g)}),O&&e.jsxs(e.Fragment,{children:[" by ",e.jsxs("strong",{children:[x(O),"."]})]})]})}),t.stage==="OrderReceived"&&e.jsx("div",{className:"space-y-2 text-sm",children:n?e.jsxs(e.Fragment,{children:[n.received&&e.jsxs("p",{className:"text-muted-foreground",children:["Parts were Received on"," ",e.jsx("strong",{children:T(n.received.dateCreated)}),n.received.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsx("strong",{children:x(n.received.person)})]})]}),n.unreceived&&e.jsxs("p",{className:"text-muted-foreground",children:["Parts were Unreceived on"," ",e.jsx("strong",{children:T(n.unreceived.dateCreated)}),n.unreceived.person&&e.jsxs(e.Fragment,{children:[" by ",e.jsx("strong",{children:x(n.unreceived.person)})]})]})]}):g&&e.jsxs("p",{className:"text-muted-foreground",children:["Request was Submitted on"," ",e.jsx("strong",{children:T(g)}),O&&e.jsxs(e.Fragment,{children:[" by ",e.jsxs("strong",{children:[x(O),"."]})]})]})}),s&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"mb-3 text-sm",children:"This request is"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:F,children:[e.jsx(K,{className:"mr-1 h-4 w-4"}),"Approved"]}),e.jsxs(y,{size:"sm",className:"bg-red-600 hover:bg-red-700",onClick:f,children:[e.jsx(V,{className:"mr-1 h-4 w-4"}),"Rejected"]})]})]}),W&&e.jsx("div",{className:"mt-4",children:e.jsx(y,{size:"sm",variant:"outline",onClick:m,className:"bg-gray-100 hover:bg-gray-200",children:"Resubmit Request"})}),q&&e.jsx("div",{className:"mt-4",children:e.jsx(y,{size:"sm",variant:"outline",onClick:()=>p(r),className:"bg-gray-100 hover:bg-gray-200",children:r==="DealershipShipped"?"Unmark Parts as Shipped":"Mark Parts as Shipped"})}),S&&r!=="RepairCompleted"&&e.jsx("div",{className:"mt-4",children:e.jsx(y,{size:"sm",variant:"outline",onClick:()=>d(r),className:"bg-gray-100 hover:bg-gray-200",children:r==="ShopReceived"?"Unmark Parts as Received":"Mark Parts as Received"})})]})]},t.id)})})]})}function Ee(){const[c,m]=k.useState(!1),[d,p]=k.useState(),[F,f]=k.useState(!1),R=xe({from:"/_authenticated/repair_orders/$id"}).id,[o,A]=k.useState(),[r,b]=k.useState(),[g,N]=k.useState(0),[w,j]=k.useState(!1),[O,B]=k.useState(!1),[U,E]=k.useState(!1),{auth:_}=re(),$=_.user?.person?.type,{user:v}=re(s=>s.auth),{brand:Z}=he(),n=Z==="vw"?we:ye,Y=async()=>{try{return new Promise((s,a)=>{new L().repairOrderGet(R,{status200:i=>{p(i),s(i)},error:i=>{a(i)}})})}catch{}},I=async()=>{try{return new Promise((s,a)=>{new L().partsOrderGetAllForRepairOrder(R,{status200:i=>{Object.prototype.toString.call(i)==="[object Array]"?A(i):A([i]);const u=Object.prototype.toString.call(i)==="[object Array]"?i:[i];b(C=>{if(u.length!==0){if(g>=0&&g<u.length)return u[g];if(C&&C.id!=null){const ae=u.find(ue=>ue.id===C.id);if(ae)return ae}return u[0]}}),s(i)},error:i=>{h.error("Error:",i),a()},else:(i,u)=>{h.error(u),a()}})})}catch{}},ee=async s=>{if(!(!r||!r.id))try{await new Promise((a,l)=>{const i=new L,u=G.create({partsOrderId:r.id,action:"Approved",salesOrderNumber:s});i.partsOrderSubmitWorkflowAction(u,{status200:()=>{h.success("Parts order approved successfully"),I(),a(!0)},error:C=>{h.error(`Failed to approve parts order ${C}|`),l(!1)},else:()=>{l(!1)}})})}catch{}},se=async s=>{if(!(!r||!r.id))try{await new Promise((a,l)=>{const i=new L,u=G.create({partsOrderId:r.id,action:"Rejected",comment:s});i.partsOrderSubmitWorkflowAction(u,{status200:()=>{h.success("Parts order rejected successfully"),I(),a(!0)},error:C=>{h.error(`Failed to reject parts order ${C}|`),l(!1)},else:()=>{l(!1)}})})}catch{}},J=async s=>{try{await new Promise((a,l)=>{const i=new L,u=G.create({partsOrderId:r.id,action:"Resubmitted",comment:s,salesOrderNumber:r.salesOrderNumber});i.partsOrderSubmitWorkflowAction(u,{status200:()=>{h.success("Parts order resubmitted successfully"),I(),a(!0)},error:C=>{h.error(`Failed to resubmit parts order ${C}|`),l(!1)},else:()=>{l(!1)}})})}catch(a){h.error(`Failed to resubmit parts order ${a}|`)}},t=()=>{m(!0),E(!0)},M=async s=>{try{await new Promise((a,l)=>{const i=new L,u=G.create({partsOrderId:r.id,action:s==="DealershipShipped"?"Unshipped":"Shipped"});i.partsOrderSubmitWorkflowAction(u,{status200:()=>{h.success("Parts order marked as shipped successfully"),I(),a(!0)},error:C=>{h.error(`Failed to mark parts order as shipped ${C}|`),l(!1)},else:()=>{l(!1)}})})}catch(a){h.error(`Failed to mark parts order as shipped ${a}|`)}},z=async s=>{try{await new Promise((a,l)=>{const i=new L,u=G.create({partsOrderId:r.id,action:s==="ShopReceived"?"Unreceived":"Received"});i.partsOrderSubmitWorkflowAction(u,{status200:()=>{h.success("Parts order marked as received successfully"),I(),a(!0)},error:C=>{h.error(`Failed to mark parts order as received ${C}|`),l(!1)},else:()=>{l(!1)}})})}catch(a){h.error(`Failed to mark parts order as received ${a}|`)}},W=async s=>{try{await new Promise((a,l)=>{const i=new L,u={id:d.id,preRepairPhotoFileAssets:s,...d};i.repairOrderComplete(u,{status200:()=>{h.success("Repair order marked as complete successfully"),Y(),I(),a(!0)},error:C=>{h.error(`Failed to mark repair order as complete ${C}|`),l(!1)},else:()=>{l(!1)}})})}catch(a){h.error(`Failed to mark repair order as complete ${a}|`)}},S=()=>{B(!0),E(!1)},q=()=>{B(!0),E(!0)};return k.useEffect(()=>{Y(),I()},[]),e.jsxs("div",{className:"bg-background text-foreground",children:[e.jsxs("div",{className:"relative h-40 w-full",children:[e.jsx("img",{src:n,alt:Z==="vw"?"VW Navigation":"Audi Navigation",className:"mt-6 h-full w-full object-cover"}),e.jsxs("div",{className:"absolute top-1/2 left-6 -translate-y-1/2",children:[e.jsx("p",{className:"text-3xl font-bold text-white",children:v?.person?.shop?.name||v?.person?.csrRegion&&v?.person?.csrRegion.name||"--"}),e.jsxs("p",{className:"mt-4 flex items-center space-x-4 text-sm text-gray-200",children:[e.jsx(Re,{className:"h-5 w-5 text-white"}),v?.person?.shop&&e.jsxs("span",{children:["Assigned Dealership:"," ",v?.person?.shop?.sponsorDealership.name??"--","("," ",v?.person?.shop?.sponsorDealership.dealershipNumber,")"]})||"--",e.jsx(De,{className:"ml-6 h-5 w-5 text-white"}),e.jsxs("span",{children:[" ","Field Support Team: ",v?.person?.firstName," ",v?.person?.lastName]})]})]}),e.jsx("div",{className:"absolute top-1/2 right-6 max-w-[320px] -translate-y-1/2 text-sm text-gray-200",children:e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"grid grid-cols-[24px_1fr] items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5 justify-self-end text-white","aria-hidden":"true"}),e.jsx("span",{className:"truncate",children:v?.person?.shop?.shopNumber??"--"})]}),e.jsxs("div",{className:"my-1 grid grid-cols-[24px_1fr] items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 justify-self-end text-white","aria-hidden":"true"}),e.jsxs("span",{className:"truncate",children:[v?.person?.shop?.address??"--",",",v?.person?.shop?.city??"--",",",v?.person?.shop?.state??"--","Â ",v?.person?.shop?.zip??"--"]})]}),e.jsxs("div",{className:"grid grid-cols-[24px_1fr] items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5 justify-self-end text-white","aria-hidden":"true"}),e.jsx("span",{className:"truncate",children:v?.person?.shop?.region.name??"--"})]})]})})]}),e.jsxs("div",{className:"mx-4 my-6 p-3",children:[e.jsxs("div",{className:"flex w-full flex-col rounded-sm border",children:[e.jsxs("div",{className:"bg-muted text-foreground flex w-full items-center justify-between p-5",children:[e.jsxs("h1",{className:"text-2xl font-bold tracking-tight",children:["Repair Order # :",d?.roNumber||"--"]}),e.jsxs("div",{className:"flex gap-3",children:[o?.every(s=>s.status==="ShopReceived"||s.status==="CsrRejected")&&$==="Shop"?e.jsxs(y,{onClick:()=>f(!0),size:"sm",className:"h-9 bg-green-600 text-xs font-medium",children:[e.jsx(K,{className:"mr-1.5 h-3.5 w-3.5"}),"Mark Repair as Complete"]}):null,$==="Shop"&&o?.every(s=>s.status!=="RepairCompleted")?e.jsxs(y,{size:"sm",variant:"outline",className:"h-9 text-xs font-medium",onClick:()=>j(!0),children:[e.jsx(ne,{className:"mr-1.5 h-3.5 w-3.5"}),"Edit Repair Order"]}):null]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 p-5 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Customer"}),e.jsx("p",{className:"font-medium",children:d?.customer||"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"VIN"}),e.jsx("p",{className:"font-mono",children:d?.vin||"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Year/Make/Model"}),e.jsxs("p",{className:"font-medium",children:[d?.year,"/",d?.make,"/",d?.model]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Date Submitted"}),e.jsxs("p",{children:[X(d?.dateLastSubmitted)||"--"," by ",r?.submittedByPerson?.firstName+" "+r?.submittedByPerson?.lastName]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Submitted To"}),e.jsx("p",{className:"font-medium",children:d?.dealership?.name||"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Date Closed"}),e.jsxs("p",{className:"text-muted-foreground",children:[X(d?.dateClosed)||"--",d?.dateClosed&&" by ",d?.dateClosed&&r?.reviewedByPerson?.firstName+" "+r?.reviewedByPerson?.lastName]})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Pre-Repair Photos"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-2",children:d&&d?.preRepairPhotoFileAssets&&d?.preRepairPhotoFileAssets.length>0?d?.preRepairPhotoFileAssets?.map(s=>e.jsx("a",{href:`undefined${s.downloadUrl}`,className:"text-blue-700 underline hover:underline",target:"_blank",children:s.filename},s.id)):"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Structural Measurements"}),e.jsx("br",{}),e.jsx("div",{className:"text-primary hover:underline",children:d?.structuralMeasurementFileAssets&&d?.structuralMeasurementFileAssets.length>0?d?.structuralMeasurementFileAssets?.map(s=>e.jsx("a",{href:`undefined${s.downloadUrl}`,className:"text-blue-700 underline hover:underline",target:"_blank",children:s.filename},s.id)):"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Post-Repair Photos"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-2",children:d?.postRepairPhotoFileAssets&&d?.postRepairPhotoFileAssets.length>0?d?.postRepairPhotoFileAssets?.map(s=>e.jsx("a",{href:s.downloadUrl,className:"text-blue-700 underline hover:underline",children:s.filename},s.id)):"--"})]})]})]})]}),e.jsxs("div",{className:"my-5 flex flex-col rounded-sm border",children:[e.jsxs("div",{className:"bg-muted flex items-center justify-between overflow-hidden p-5",children:[e.jsx("div",{className:"flex items-center gap-6 text-sm font-medium",children:o&&o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:g===0?"default":"outline",size:"sm",onClick:()=>{const s=o.find(a=>a.partsOrderNumber===0);N(0),b(s)},children:"Parts Order"}),o.filter(s=>s.partsOrderNumber&&s.partsOrderNumber>0).map((s,a)=>e.jsxs(y,{variant:g===a+1?"default":"outline",onClick:()=>{b(s),N(a+1)},children:[s.hasAlert&&e.jsx(Ie,{className:"text-destructive h-4 w-4"}),"Supplement ",s.partsOrderNumber]},s.id||a))]})}),o?.some(s=>s.status!=="RepairCompleted"||s.status==="CsrRejected"||s.status!=="RepairCompleted")&&$==="Shop"&&e.jsxs(y,{onClick:()=>{b(void 0),m(!0),E(!1)},variant:"outline",size:"sm",className:"h-9 rounded-lg font-medium",children:[e.jsx(Me,{className:"mr-1.5 h-3.5 w-3.5"}),"Supplemental Parts Order"]})]}),e.jsxs("div",{className:"m-5 flex gap-8",children:[e.jsx("div",{className:"max-w-lg flex-1",children:(r||o&&o.length>0&&o[0])&&e.jsxs(te,{className:"rounded-xl border shadow-sm",children:[e.jsx(Be,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs($e,{className:"text-foreground text-base font-semibold",children:["Sales Order #"," ",r?.salesOrderNumber||"--"]}),$==="Shop"&&r?.stage=="OrderReview"&&r?.status!=="DealershipProcessing"||$==="Csr"&&r?.status!=="CsrReview"&&r?.status!=="CsrRejected"&&r?.stage!=="OrderReceived"&&r?.status!=="RepairCompleted"?e.jsxs(y,{onClick:()=>{b(r),m(!0)},size:"sm",variant:"outline",className:"h-9 px-4 text-xs",children:[e.jsx(ne,{className:"h-3.5 w-3.5"}),"Edit Parts Order"]}):null]})}),e.jsxs(qe,{className:"space-y-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-3 font-medium",children:"Requested Parts"}),e.jsx("ol",{className:"text-foreground/90 space-y-2 pl-5 font-mono",children:r?.parts?.length>0&&r?.parts?.map((s,a)=>e.jsxs("li",{children:["(",a+1,") ",s]},s+a))||"-- No parts requested"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Parts Estimate"}),e.jsx("br",{}),r&&r.estimateFileAssets&&r.estimateFileAssets.length>0&&r.estimateFileAssets.map(s=>e.jsx("a",{href:`${void 0+s.viewUrl}`,className:"text-blue-700 underline hover:underline",children:s.filename},s.id))||"-- No estimate file"]})]})]})||"-- No parts order data"}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx(Ue,{partsOrder:r||o&&o.length>0&&o?.[0],onApprove:S,onReject:q,onResubmit:t,onMarkShipped:s=>M(s),onMarkReceived:s=>z(s)})})]})]})]}),e.jsx(Pe,{open:c,onOpenChange:m,initialData:r,initRepaitOrderData:d,onSuccess:()=>{I()},isReject:U,onHandleResubmit:J}),e.jsx(ze,{open:O,onOpenChange:B,onApprove:ee,onReject:se,isReject:U,initRepaitOrderData:d,selectPartsOrderData:r}),e.jsx(Le,{open:F,onOpenChange:f,initRepaitOrderData:d,onComplete:s=>W(s)}),e.jsx(Oe,{open:w,onOpenChange:j,initialData:d,onSuccess:Y})]})}const bs=Ee;export{bs as component};
