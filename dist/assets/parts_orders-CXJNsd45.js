import{h as le,r as a,p as ne,q as F,P as ie,w as oe,t as $,j as e,B as de,C as ce}from"./index-DiI2ffAh.js";import{O as me}from"./OrderApi-C0c8zPF8.js";import{B as ue}from"./badge-CmxtL1uP.js";import{E as he,a as xe,b as pe,T as je,c as fe,d as ge,D as Se}from"./data-table-pagination-BYSKvq0r.js";import{I as ve}from"./input-anrjtq5m.js";import{S as N,a as y,b as T,c as C,d as r}from"./select-BfIdXsKN.js";import{T as be,a as Ne,b as D,c as n,d as ye,e as l}from"./table-DfggTbkb.js";import{T as Te,a as Ce,b as De,c as Re}from"./tooltip-D0HhMqED.js";import{D as L}from"./date-picker-C8C4Gnlb.js";import{D as Oe}from"./download-CTZAi_Qa.js";import{S as Pe}from"./search-Dee6z3yd.js";import{u as we}from"./use-authenticated-DyXd3Kpo.js";import{L as $e}from"./Loading-QGL_XBaH.js";import"./chevron-left-CVoIS1tR.js";import"./chevron-right-B2dPWAbi.js";import"./index-DHosPbdR.js";import"./index-B9OW1ajA.js";import"./index-BesrJGlS.js";import"./Combination-D_vfDq5J.js";import"./index-B0ORnztA.js";import"./index-I18K8_cQ.js";import"./chevron-down-kGCTDs5u.js";import"./check-Ca0fbDYF.js";import"./index-lW_6OgVn.js";import"./popover-DSwKj0iH.js";import"./x-DoFJH5Nd.js";function Ie(){const{user:i}=le(t=>t.auth),[g,E]=a.useState(void 0),[R,M]=a.useState(void 0),[o,V]=a.useState("30"),[c,k]=a.useState("all"),[d,q]=a.useState("all"),[m,H]=a.useState("all"),[u,Y]=a.useState(""),[O,Q]=a.useState(1),[I,K]=a.useState([]),[A,U]=a.useState(0),[z,S]=a.useState(!1),v=20,G=Math.ceil(A/v),{dateFrom:h,dateTo:x}=a.useMemo(()=>{if(o==="custom")return{dateFrom:g,dateTo:R};const{from:t,to:s}=ne(o);return{dateFrom:t,dateTo:s}},[o,g,R]),J=a.useMemo(()=>`${u}|${c}|${d}|${m}|${o}|${h?.toISOString()}|${x?.toISOString()}`,[u,c,d,m,o,h,x]),W=t=>t.includes("Review")||t.includes("Rejected")?"destructive":t.includes("Shipped")||t.includes("Completed")?"default":t.includes("Received")?"secondary":t.includes("Processing")?"outline":"secondary",P=a.useCallback(async()=>{if(i){S(!0);try{const t=new me,s=h?F(h):void 0,b=x?F(x):void 0,p={smartFilter:u};c!=="all"&&(p.filterByPartsOrderNumber=parseInt(c)),d!=="all"&&(p.filterByStatus=d),m!=="all"&&(p.filterByRegionId=parseInt(m));const j=ie.create(p);s&&(j.dateSubmittedFrom=s),b&&(j.dateSubmittedTo=b);const w=oe.create({resultsLimitOffset:(O-1)*v,resultsLimitCount:v,resultsOrderBy:"dateSubmitted",resultsOrderAscending:!1});j.resultParameter=w,t.partsOrderSearch(j,{status200:f=>{K(f.partOrders||[]),U(f.totalItemCount||0),S(!1)},error:f=>{$.error("Error:",f),S(!1)},else:()=>{S(!1)}})}catch(t){t&&typeof t=="object"&&"message"in t?$.error(t.message):$.error("Error: get fail"),S(!1)}}},[i,u,c,d,m,h,x]);a.useEffect(()=>{if(!i)return;const s=setTimeout(()=>{P()},u?500:0);return()=>clearTimeout(s)},[i,u,c,d,m,h,x]),a.useEffect(()=>{i&&P()},[O,P]);const B=t=>{if(!t)return"--";const s=typeof t=="string"?new Date(t):t;return isNaN(s.getTime())?"--":s.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"})},X=t=>t===0?"Parts Order":t===1?"Supplement 1":t===2?"Supplement 2":t===3?"Supplement 3":`Supplement ${t}`;return e.jsx("div",{className:"min-h-scree",children:e.jsxs("div",{className:"bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("h1",{className:"text-foreground text-2xl font-bold",children:"Parts Order List"}),e.jsxs(de,{children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Report"]})]}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsx("div",{className:"mb-6 flex flex-col gap-4 lg:flex-row lg:items-center",children:e.jsxs("div",{className:"relative max-w-md flex-1",children:[e.jsx(Pe,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(ve,{value:u,onChange:t=>Y(t.target.value),placeholder:"Filter by RO#, Sales Order #, VIN, Shop, Dealer",className:"pl-10"})]})}),e.jsxs("div",{className:"mb-6 flex flex-wrap items-center gap-3",children:[e.jsxs(N,{value:c,onValueChange:t=>k(t),children:[e.jsx(y,{className:"bg-muted w-48",children:e.jsx(T,{placeholder:"Type of Order"})}),e.jsxs(C,{children:[e.jsx(r,{value:"all",children:"All Types"}),e.jsx(r,{value:"0",children:"original Parts Order"}),e.jsx(r,{value:"1",children:"Supplement #1"}),e.jsx(r,{value:"2",children:"Supplement #2"}),e.jsx(r,{value:"3",children:"Supplement #3"})]})]}),e.jsxs(N,{value:d,onValueChange:t=>q(t),children:[e.jsx(y,{className:"bg-muted w-48",children:e.jsx(T,{placeholder:"Status"})}),e.jsxs(C,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"csr-Review",children:"CSR Review"}),e.jsx(r,{value:"csr-rejected",children:"CSR Rejected"}),e.jsx(r,{value:"dealer-processing",children:"Dealer Processing"}),e.jsx(r,{value:"dealer-shipped",children:"Dealer Shipped"}),e.jsx(r,{value:"shop-received",children:"Shop Received"}),e.jsx(r,{value:"repair-completed",children:"Repair Completed"})]})]}),e.jsxs(N,{value:m,onValueChange:t=>H(t),children:[e.jsx(y,{className:"bg-muted w-48",children:e.jsx(T,{placeholder:"CSR Region"})}),e.jsxs(C,{children:[e.jsx(r,{value:"all",children:"All Regions"}),i?.regions?.map(t=>e.jsx(r,{value:t.id?.toString()||"",children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Date Submitted Range"}),e.jsxs(N,{value:o,onValueChange:t=>V(t),children:[e.jsx(y,{className:"bg-muted w-48",children:e.jsx(T,{placeholder:"ALL Dates"})}),e.jsxs(C,{children:[e.jsx(r,{value:"7",children:"Past 7 days"}),e.jsx(r,{value:"30",children:"Past 30 Days"}),e.jsx(r,{value:"month-to-date",children:"Month-To-Date"}),e.jsx(r,{value:"quarter-to-date",children:"Quarter-To-Date"}),e.jsx(r,{value:"year-to-date",children:"Year-To-Date"}),e.jsx(r,{value:"last-month",children:"Last Month"}),e.jsx(r,{value:"last-quarter",children:"Last Quarter"}),e.jsx(r,{value:"last-year",children:"Last Year"}),e.jsx(r,{value:"custom",children:"Custom"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"From"}),e.jsx(L,{disabled:o!=="custom",selected:g,onSelect:t=>E(t),placeholder:"Select from date"}),e.jsx("span",{className:"text-sm font-medium",children:"To"}),e.jsx(L,{disabled:o!=="custom",selected:R,onSelect:t=>M(t),placeholder:"Select to date"})]})]}),e.jsx("div",{className:"bg-background overflow-hidden rounded-lg border shadow-sm",children:e.jsxs(be,{children:[e.jsx(Ne,{children:e.jsxs(D,{className:"bg-muted",children:[e.jsx(n,{className:"text-foreground font-semibold",children:"RO #"}),e.jsx(n,{className:"text-foreground font-semibold",children:"Sales #"}),e.jsx(n,{className:"text-foreground font-semibold",children:"Type"}),e.jsx(n,{className:"text-foreground font-semibold",children:"VIN"}),e.jsx(n,{className:"text-foreground font-semibold",children:"Year/Make/Model"}),e.jsx(n,{className:"text-foreground font-semibold",children:"Status"}),e.jsx(n,{className:"text-foreground font-semibold",children:"Shop"}),e.jsx(n,{className:"text-foreground font-semibold",children:"Dealer"}),e.jsx(n,{className:"text-foreground font-semibold",children:"CSR Region"}),e.jsx(n,{className:"text-foreground font-semibold",children:"Date Completed"}),e.jsx(n,{className:"text-foreground font-semibold",children:"Date Closed"})]})}),e.jsx(ye,{children:z?e.jsx(D,{children:e.jsx(l,{colSpan:11,className:"py-8 text-center",children:"loading..."})}):I.length===0?e.jsx(D,{children:e.jsx(l,{colSpan:11,className:"py-8 text-center",children:e.jsx(he,{children:e.jsxs(xe,{children:[e.jsx(pe,{variant:"icon",children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx(fe,{children:"No data to display"}),e.jsx(ge,{children:"There are no records in this table yet. Add your first entry to get started."})]})})})}):I.map(t=>{const s=t.repairOrder,b=s?.roNumber||"--",p=t.salesOrderNumber||"--",j=X(t.partsOrderNumber||0),w=s?.vin||"--",f=s&&`${s.year||""} ${s.make||""} ${s.model||""}`.trim()||"--",Z=t.status||"--",_=s?.shop?`${s.shop.name||""} (${s.shop.id||""})`:"--",ee=s?.dealership?`${s.dealership.name||""} (${s.dealership.id||""})`:"--",te=s?.region||"--",se=B(t.dateReceived),re=B(s?.dateClosed),ae=s?.orderFromAlternateDealership||!1;return e.jsxs(D,{className:"hover:bg-muted/50",children:[e.jsx(l,{className:"text-primary font-medium",children:b}),e.jsx(l,{children:p}),e.jsx(l,{children:j}),e.jsx(l,{className:"font-mono text-xs",children:w}),e.jsx(l,{children:f}),e.jsx(l,{children:e.jsx(ue,{variant:W(d),className:"whitespace-nowrap",children:Z})}),e.jsx(l,{className:"text-sm",children:_}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[ae&&e.jsx(Te,{children:e.jsxs(Ce,{children:[e.jsx(De,{asChild:!0,children:e.jsx(ce,{className:"h-4 w-4 cursor-help text-yellow-600"})}),e.jsx(Re,{children:e.jsx("p",{children:"Ordered from an alternate dealer"})})]})}),e.jsx("span",{className:"text-sm",children:ee})]})}),e.jsx(l,{children:te}),e.jsx(l,{children:se}),e.jsx(l,{children:re||"--"})]},t.id)})})]})}),e.jsx(Se,{currentPage:O,totalPages:G,totalItems:A,itemsPerPage:v,onPageChange:Q},J)]})]})})}function lt(){const{isAuthenticated:i,isLoading:g}=we();return g||!i?e.jsx($e,{}):e.jsx(Ie,{})}export{lt as component};
