import{h as ce,r as a,b as me,p as ue,j as e,B as he,C as pe,q as A,P as xe,t as E,w as fe}from"./index-bZPt74SL.js";import{H as je}from"./header-only-layout-CdwEHF56.js";import{O as ge}from"./OrderApi-BoClc7Py.js";import{B as Se}from"./badge-B483Njh1.js";import{C as ve}from"./checkbox-B0TIKdeQ.js";import{E as ye,a as be,b as Ne,T as Ce,c as Te,d as Oe,D as De}from"./data-table-pagination-DFlv6pI_.js";import{I as Re}from"./input-W45EOFir.js";import{L as we}from"./form-C97xBvhE.js";import{S as T,a as O,b as D,c as R,d as r}from"./select-iVvteLym.js";import{T as Pe,a as Ie,b as w,c as i,d as Ee,e as n}from"./table-CDOYvhfH.js";import{T as Be,a as $e,b as Fe,c as Le}from"./tooltip-Dy5-W70q.js";import{D as M}from"./date-picker-HHB7J9Gf.js";import{D as ke}from"./download-CSF5e3oF.js";import{S as Ae}from"./search-DHWuWzUR.js";import{u as Me}from"./use-authenticated-5oKGhwjr.js";import{L as Ve}from"./Loading-DvxbuYKm.js";import"./header-qTyXPqs3.js";import"./PersonApi-DoDgYvr6.js";import"./dropdown-menu-tQledoqF.js";import"./index-BAv-q7Sn.js";import"./index-B5XdlCk6.js";import"./Combination-C2X8UjKH.js";import"./index-BMiWLKrh.js";import"./index-CJ8ye8BA.js";import"./index-BezWuCKb.js";import"./check-D9nIkqgl.js";import"./chevron-right-BMMQv83b.js";import"./dialog-DyU8MlPO.js";import"./x-BdNzPY10.js";import"./separator-AAFKv4Ad.js";import"./search-provider-DzoA6NSo.js";import"./command-D9Fefqby.js";import"./building-2-NKdgdULG.js";import"./scroll-area-C08dUgxo.js";import"./index-BDNPEbHM.js";import"./index-DQajRILt.js";import"./chevron-left-BFQH7A4v.js";import"./chevron-down-DacainfD.js";import"./popover-Xpze6ip0.js";function qe(){const{user:d}=ce(t=>t.auth),[h,V]=a.useState(!0),[x,B]=a.useState(void 0),[f,$]=a.useState(void 0),[m,q]=a.useState("7"),[j,H]=a.useState("all"),[p,Y]=a.useState("all"),[g,Q]=a.useState("all"),[P,F]=a.useState(1),[S,U]=a.useState(""),[b,W]=a.useState([]),[L,_]=a.useState(0),[z,v]=a.useState(!1),N=20,G=Math.ceil(L/N),J=me(),I=a.useRef(null),[K,X]=a.useState([]),Z=()=>{const t=(P-1)*N,s=t+N;return b.slice(t,s).map(o=>{const l=o.repairOrder||{},c=l.shop||{},y=l.dealership||{};return{"RO#":l.roNumber||"--","Sales#":o.salesOrderNumber||"--",Type:k(o.partsOrderNumber||0),VIN:l.vin||"--","Year/Make/Model":[l.year,l.make,l.model].filter(Boolean).join(" ")||"--",Status:o.status||"--",Shop:c.name?`${c.name} (${c.id})`:"--",Dealer:y.name?`${y.name} (${y.id})`:"--","CSR Region":l.region||"--","Date Completed":C(o.dateCreated),"Date Closed":C(l.dateClosed)||"--"}})},ee=async()=>{try{const t=Z();await fe(t,K)&&E.success("Exported successfully")}catch{E.error("Export failed")}};a.useEffect(()=>{if(I.current){const t=I.current.querySelectorAll("thead th"),s=Array.from(t).map(u=>u.textContent.trim());X(s)}},[b]);const te=t=>t.includes("Review")||t.includes("Rejected")?"destructive":t.includes("Shipped")||t.includes("Completed")?"default":t.includes("Received")?"secondary":t.includes("Processing")?"outline":"secondary",se=async()=>{if(d){v(!0);try{const t=new ge,s=x?A(x):void 0,u=f?A(f):void 0,o={smartFilter:S,filterByWaitingOnMe:h,filterByDealershipId:d?.person?.type==="Dealership"?d?.person?.dealership.id:void 0};j!=="all"&&(o.filterByPartsOrderNumber=parseInt(j)),p!=="all"&&(o.filterByStatus=p),g!=="all"&&(o.filterByRegionId=parseInt(g));const l=xe.create(o);s&&(l.dateSubmittedFrom=s),u&&(l.dateSubmittedTo=u),t.partsOrderSearch(l,{status200:c=>{W(c.partOrders||[]),_(c.totalItemCount||0),v(!1)},error:c=>{E.error(`Error: ${c||"Failed to fetch data"}`),v(!1)},else:()=>{v(!1)}})}catch{v(!1)}}};a.useEffect(()=>{if(!d)return;const t=setTimeout(()=>{se()},S?500:0);return()=>clearTimeout(t)},[S,h,j,p,g,m,x,f,P,d]),a.useEffect(()=>{F(1)},[S,h,j,p,g,m,x,f]),a.useEffect(()=>{if(m!=="custom"){const{from:t,to:s}=ue(m);B(t),$(s)}},[m]);const C=t=>{if(!t)return"--";const s=typeof t=="string"?new Date(t):t;return isNaN(s.getTime())?"--":s.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"})},k=t=>t===0?"Parts Order":t===1?"Supplement 1":t===2?"Supplement 2":`Supplement ${t}`;return e.jsx("div",{className:"min-h-scree",children:e.jsxs("div",{className:"bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("h1",{className:"text-foreground text-2xl font-bold",children:"Parts Order List"}),e.jsxs(he,{onClick:ee,children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Report"]})]}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 lg:flex-row lg:items-center",children:[e.jsxs("div",{className:"relative max-w-md flex-1",children:[e.jsx(Ae,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(Re,{value:S,onChange:t=>U(t.target.value),placeholder:"Filter by RO#, Sales Order #, VIN, Shop, Dealer",className:"pl-10"})]}),d?.person?.type==="Csr"||d?.person?.type==="FieldStaff"&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{id:"my-orders",checked:h,onCheckedChange:t=>V(t),className:"bg-muted rounded-full"}),e.jsx(we,{htmlFor:"my-orders",className:"flex cursor-pointer items-center gap-2 text-sm font-medium",children:"Only View Parts Orders that are waiting On Me"})]})]}),e.jsxs("div",{className:"mb-6 flex flex-wrap items-center gap-3",children:[e.jsxs(T,{value:j,onValueChange:t=>H(t),children:[e.jsx(O,{className:"bg-muted w-48",children:e.jsx(D,{placeholder:"Type of Order"})}),e.jsxs(R,{children:[e.jsx(r,{value:"all",children:"All Types"}),e.jsx(r,{value:"0",children:"original Parts Order"}),e.jsx(r,{value:"1",children:"Supplement #1"}),e.jsx(r,{value:"2",children:"Supplement #2"}),e.jsx(r,{value:"3",children:"Supplement #3"})]})]}),e.jsxs(T,{value:p,onValueChange:t=>Y(t),children:[e.jsx(O,{className:"bg-muted w-48",children:e.jsx(D,{placeholder:"Status"})}),e.jsxs(R,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"csr-Review",children:"CSR Review"}),e.jsx(r,{value:"csr-rejected",children:"CSR Rejected"}),e.jsx(r,{value:"dealer-processing",children:"Dealer Processing"}),e.jsx(r,{value:"dealer-shipped",children:"Dealer Shipped"}),e.jsx(r,{value:"shop-received",children:"Shop Received"}),e.jsx(r,{value:"repair-completed",children:"Repair Completed"})]})]}),e.jsxs(T,{value:g,onValueChange:t=>Q(t),children:[e.jsx(O,{className:"bg-muted w-48",children:e.jsx(D,{placeholder:"CSR Region"})}),e.jsxs(R,{children:[e.jsx(r,{value:"all",children:"All Regions"}),d?.regions?.map(t=>e.jsx(r,{value:t.id?.toString()||"",children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Date Submitted Range"}),e.jsxs(T,{value:m,onValueChange:t=>q(t),children:[e.jsx(O,{className:"bg-muted w-48",children:e.jsx(D,{placeholder:"ALL Dates"})}),e.jsxs(R,{children:[e.jsx(r,{value:"7",children:"Past 7 days"}),e.jsx(r,{value:"30",children:"Past 30 Days"}),e.jsx(r,{value:"month-to-date",children:"Month-To-Date"}),e.jsx(r,{value:"quarter-to-date",children:"Quarter-To-Date"}),e.jsx(r,{value:"year-to-date",children:"Year-To-Date"}),e.jsx(r,{value:"last-month",children:"Last Month"}),e.jsx(r,{value:"last-quarter",children:"Last Quarter"}),e.jsx(r,{value:"last-year",children:"Last Year"}),e.jsx(r,{value:"custom",children:"Custom"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"From"}),e.jsx(M,{disabled:m!=="custom",selected:x,onSelect:t=>B(t),placeholder:"Select from date"}),e.jsx("span",{className:"text-sm font-medium",children:"To"}),e.jsx(M,{disabled:m!=="custom",selected:f,onSelect:t=>$(t),placeholder:"Select to date"})]})]}),e.jsx("div",{className:"bg-background overflow-hidden rounded-lg border shadow-sm",children:e.jsxs(Pe,{ref:I,children:[e.jsx(Ie,{children:e.jsxs(w,{className:"bg-muted",children:[e.jsx(i,{className:"text-foreground font-semibold",children:"RO#"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Sales#"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Type"}),e.jsx(i,{className:"text-foreground font-semibold",children:"VIN"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Year/Make/Model"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Status"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Shop"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Dealer"}),e.jsx(i,{className:"text-foreground font-semibold",children:"CSR Region"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Date Completed"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Date Closed"})]})}),e.jsx(Ee,{children:z?e.jsx(w,{children:e.jsx(n,{colSpan:11,className:"py-8 text-center",children:"loading..."})}):b.length===0?e.jsx(w,{children:e.jsx(n,{colSpan:11,className:"py-8 text-center",children:e.jsx(ye,{children:e.jsxs(be,{children:[e.jsx(Ne,{variant:"icon",children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx(Te,{children:"No data to display"}),e.jsx(Oe,{children:"There are no records in this table yet. Add your first entry to get started."})]})})})}):b.map(t=>{const s=t.repairOrder,u=s?.roNumber||"--",o=t.salesOrderNumber||"--",l=k(t.partsOrderNumber||0),c=s?.vin||"--",y=s&&`${s.year||""} ${s.make||""} ${s.model||""}`.trim()||"--",re=t.status||"--",ae=s?.shop?`${s.shop.name||""} (${s.shop.id||""})`:"--",le=s?.dealership?`${s.dealership.name||""} (${s.dealership.id||""})`:"--",ne=s?.region||"--",oe=C(t.dateCreated),ie=C(s?.dateClosed),de=s?.orderFromAlternateDealership||!1;return e.jsxs(w,{className:"hover:bg-muted/50",children:[e.jsx(n,{className:"cursor-pointer text-blue-600 hover:underline",onClick:()=>{J({to:"/repair_orders/$id",params:{id:t.repairOrder.id.toString()}})},children:u}),e.jsx(n,{children:o}),e.jsx(n,{children:l}),e.jsx(n,{className:"font-mono text-xs",children:c}),e.jsx(n,{children:y}),e.jsx(n,{children:e.jsx(Se,{variant:te(p),className:"whitespace-nowrap",children:re})}),e.jsx(n,{className:"text-sm",children:ae}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[de&&e.jsx(Be,{children:e.jsxs($e,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx(pe,{className:"h-4 w-4 cursor-help text-yellow-600"})}),e.jsx(Le,{children:e.jsx("p",{children:"Ordered from an alternate dealer"})})]})}),e.jsx("span",{className:"text-sm",children:le})]})}),e.jsx(n,{children:ne}),e.jsx(n,{children:oe}),e.jsx(n,{children:ie||"--"})]},t.id)})})]})}),e.jsx(De,{currentPage:P,totalPages:G,totalItems:L,itemsPerPage:N,onPageChange:F})]})]})})}function Dt(){const{isAuthenticated:d,isLoading:h}=Me();return h||!d?e.jsx(Ve,{}):e.jsx(je,{children:e.jsx(qe,{})})}export{Dt as component};
