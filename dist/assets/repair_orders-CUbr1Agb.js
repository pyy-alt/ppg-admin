import{i as Se,r as a,k as Q,d as Ce,b as Ne,q as Re,j as e,B as be,t as $,s as ye,w as f,x as we,y as De,O as Oe}from"./index-Bkm0i40-.js";import{D as Pe,u as Te}from"./DateRangePicker-d2Mn7GNR.js";import{L as Le}from"./Loading-Z72NCMiE.js";import{O as D}from"./OrderApi-CGuh07sy.js";import{v as Fe,a as Ae,W as Ie,T as ke,M as Ee,R as Me,P as Ve}from"./RepairOrderDialog-BANRZSWa.js";import{C as _e}from"./checkbox-s4dkUmJo.js";import{C as Be,E as qe,a as $e,b as We,T as Ye,c as He,d as Ge,D as Je}from"./clearable-input-CleWMoZm.js";import{L as Qe}from"./label-BN8Qe8K3.js";import{S as W,a as Y,b as H,c as G,d as i}from"./select-CXq6ZKY2.js";import{T as Ue,a as ze,b as J,c,d as Ke,e as p}from"./table-t_A_f_TD.js";import{U as Xe}from"./users-uvAbHv3x.js";import{M as Ze}from"./map-pin-Dk4q35Vy.js";import{P as es}from"./plus-BIUHcGpT.js";import{S as ss}from"./search-BInq9IsI.js";import{T as ts}from"./confirm-dialog-BSEgRwpb.js";import"./calendar-CwXp5SEl.js";import"./chevron-left-RM5v8unW.js";import"./chevron-right-C97o7tEJ.js";import"./chevron-down-Cduf7_rY.js";import"./popover-PyNfnk6w.js";import"./index-CnmrjRy4.js";import"./Combination-K-YKTF--.js";import"./index-CN5U3HPo.js";import"./index-CM-w1TYN.js";import"./index-B51CDgwY.js";import"./index-BeLrdImO.js";import"./x-CsoNbFna.js";import"./form-FwhVnNbA.js";import"./use-dialog-with-confirm-aTOHhxte.js";import"./dialog-DSGLXfvZ.js";import"./input-DaKq_e4d.js";import"./separator-Bthd58uT.js";import"./trash-2-CTCH7piY.js";import"./OrganizationApi-M1CaO7zV.js";import"./index-Dti7BYom.js";import"./check-BRFXV1aI.js";import"./index-ChYaYNrd.js";import"./index-Dt-JkpPh.js";import"./chevron-up-Ci4wS3K6.js";function rs(){const{user:r}=Se(t=>t.auth),[h,x]=a.useState(void 0),[U,z]=a.useState([]),[O,P]=a.useState(void 0),[g,K]=a.useState(1),j=20,[T,X]=a.useState(0),Z=Math.ceil(T/j),[ee,L]=a.useState(!1),[S,se]=a.useState(!1),[C,te]=a.useState("all"),[v,re]=a.useState(""),[N,ae]=a.useState("all"),[ie]=a.useState(void 0),[oe,F]=a.useState(!1),[le,ne]=a.useState(),[de,ce]=a.useState(),[pe,me]=a.useState([]),A=Q(),I=A.search.id?Number(A.search.id):void 0,[ue,k]=a.useState(),{brand:E}=Ce(),he=E==="vw"?Fe:Ae,xe=async t=>{try{return new Promise((s,o)=>{new D().repairOrderGet(t,{status200:d=>{ce(d),s(d)},error:d=>{o(d)}})})}catch{}},M=async(t,s)=>{try{return new Promise((o,n)=>{new D().partsOrderGetAllForRepairOrder(t,{status200:l=>{ne(l),s&&F(!0),o(l)},error:()=>{n()},else:l=>{n()}})})}catch{}},R=async(t,s)=>{try{const o=new D,n=r?.person?.shop?.id||I;if(n==null){je.history.go(-1);return}const d=C==="all"?void 0:C,l=we.create({shopId:Number(n),smartFilter:v||void 0,filterByStatus:d,showRepairCompleted:!S,dateLastSubmittedFrom:h,dateLastSubmittedTo:O});l.dateLastSubmittedFrom&&(l.dateLastSubmittedFrom=f(h)),l.dateLastSubmittedTo&&(l.dateLastSubmittedTo=f(O));const b=De.create({resultsLimitOffset:(g-1)*j,resultsLimitCount:j,resultsOrderBy:"dateLastSubmitted",resultsOrderAscending:!1});l.resultParameter=b,t&&!s&&(l.dateLastSubmittedFrom=void 0,l.dateLastSubmittedTo=void 0),o.repairOrderSearch(l,{status200:async m=>{let _=m.repairOrders||[];const fe=await Promise.all(_.map(async y=>{try{const u=await M(y.id.toString()),B=Array.isArray(u)?u:u?[u]:[],w={CsrReview:0,CsrRejected:0,DealershipProcessing:0,DealershipShipped:0,ShopReceived:0,RepairCompleted:0};return B.forEach(ge=>{const q=ge.status;w.hasOwnProperty(q)&&w[q]++}),{...y,partsOrders:B,statusCounts:w}}catch{return{...y,partsOrders:[],statusCounts:{CsrReview:0,CsrRejected:0,DealershipProcessing:0,DealershipShipped:0,ShopReceived:0,RepairCompleted:0}}}}));z(_),me(fe),X(m.totalItemCount||0)},error:m=>{$.error("Failed to load repair orders")}})}catch{}},V=Ne(),je=Re();a.useEffect(()=>{if(!r)return;const t=r?.person?.type;if(t==="Dealership"||t==="Csr"||t==="FieldStaff"){V({to:"/parts_orders",replace:!0});return}const s=setTimeout(()=>{R()},v?500:0);return()=>clearTimeout(s)},[v,C,S,r,g,N]);const ve=t=>{if(!t.dateLastSubmitted)return null;const s=new Date(t.dateLastSubmitted),o=Date.now()-s.getTime(),n=10080*60*1e3,d=o>=n,l=t?.partsOrders?.length>0&&t.partsOrders.some(m=>m.status==="ShopReceived"||m.status==="CsrRejected"),b=d&&r?.person?.type==="Shop";return l||b?e.jsx(ts,{className:"text-destructive h-4 w-4"}):null};return e.jsxs("div",{className:"bg-background min-h-screen",children:[e.jsxs("div",{className:"relative h-40 w-full",children:[e.jsx("img",{src:he,alt:E==="vw"?"VW Navigation":"Audi Navigation",className:"mt-6 h-full w-full object-cover"}),e.jsxs("div",{className:"absolute top-1/2 left-6 -translate-y-1/2",children:[e.jsx("p",{className:"text-3xl font-bold text-white",children:r?.person?.shop?.name??"--"}),e.jsxs("p",{className:"mt-4 flex items-center space-x-4 text-sm text-gray-200",children:[e.jsx(Ie,{className:"h-5 w-5 text-white"}),e.jsxs("span",{children:["Assigned Dealership: ",r?.person?.shop?.sponsorDealership.name??"--","("," ",r?.person?.shop?.sponsorDealership.dealershipNumber,")"]}),e.jsx(Xe,{className:"ml-6 h-5 w-5 text-white"}),e.jsxs("span",{children:[" ","Field Support Team: ",r?.person?.firstName," ",r?.person?.lastName]})]})]}),e.jsx("div",{className:"absolute top-1/2 right-6 max-w-[320px] -translate-y-1/2 text-sm text-gray-100",children:e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"grid grid-cols-[24px_1fr] items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5 justify-self-end text-white","aria-hidden":"true"}),e.jsx("span",{className:"truncate",children:r?.person?.shop?.shopNumber??"--"})]}),e.jsxs("div",{className:"my-1 grid grid-cols-[24px_1fr] items-center gap-2",children:[e.jsx(Ze,{className:"h-5 w-5 justify-self-end text-white","aria-hidden":"true"}),e.jsxs("span",{className:"truncate",children:[r?.person?.shop?.address??"--",",",r?.person?.shop?.city??"--",",",r?.person?.shop?.state??"--"," ",r?.person?.shop?.zip??"--"]})]}),e.jsxs("div",{className:"grid grid-cols-[24px_1fr] items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 justify-self-end text-white","aria-hidden":"true"}),e.jsx("span",{className:"truncate",children:r?.person?.shop?.region.name??"--"})]})]})})]}),e.jsx("div",{className:"bg-background border-b",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("h1",{className:"text-foreground text-2xl font-bold",children:"Repair Order List"}),r?.person?.type==="Shop"&&e.jsxs(be,{variant:"outline",onClick:()=>L(!0),children:[e.jsx(es,{className:"mr-1.5 h-4 w-4"}),"New Repair Order"]})]})}),e.jsx(Me,{open:ee,onOpenChange:L,onSuccess:async t=>{JSON.parse(JSON.stringify(t)).id?(await xe(t.id),await M(t.id,!0)):$.error("Repair Order Failed to Create")},initialData:ie}),e.jsx(Ve,{open:oe,onOpenChange:F,initialData:le,initRepaitOrderData:de,onSuccess:R}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"mb-6 flex flex-col items-center justify-between gap-4 lg:flex-row lg:items-center",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative w-80",children:[e.jsx(ss,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(Be,{value:v,onChange:t=>re(t.target.value),placeholder:"Filter by RO#, Order #, VIN, Customer",className:"pl-10 text-sm placeholder:text-xs"})]}),e.jsxs(W,{defaultValue:"all",onValueChange:t=>te(t),children:[e.jsx(Y,{className:"w-48",children:e.jsx(H,{placeholder:"Status"})}),e.jsxs(G,{children:[e.jsx(i,{value:"all",children:"All Status"}),e.jsx(i,{value:"CsrReview",children:"CSR Review"}),e.jsx(i,{value:"CsrRejected",children:"CSR Rejected"}),e.jsx(i,{value:"DealershipProcessing",children:"FF Dealership ProcessingF"}),e.jsx(i,{value:"DealershipShipped",children:"Dealership Shipped"}),e.jsx(i,{value:"ShopReceived",children:"Shop Received"}),e.jsx(i,{value:"RepairCompleted",children:"Repair Completed"})]})]}),e.jsxs(W,{defaultValue:N,onValueChange:t=>{k(void 0),ae(t);const{from:s,to:o}=ye(t);x(s),P(o)},children:[e.jsx(Y,{className:"w-40",children:e.jsx(H,{placeholder:"Date Range"})}),e.jsxs(G,{children:[e.jsx(i,{value:"all",children:"All Dates"}),e.jsx(i,{value:"7",children:"Past 7 days"}),e.jsx(i,{value:"30",children:"Past 30 Days"}),e.jsx(i,{value:"month-to-date",children:"Month-To-Date"}),e.jsx(i,{value:"quarter-to-date",children:"Quarter-To-Date"}),e.jsx(i,{value:"year-to-date",children:"Year-To-Date"}),e.jsx(i,{value:"last-month",children:"Last Month"}),e.jsx(i,{value:"last-quarter",children:"Last Quarter"}),e.jsx(i,{value:"last-year",children:"Last Year"}),e.jsx(i,{value:"custom",children:"Custom"})]})]}),N==="custom"&&e.jsx("div",{className:"ml-3",children:e.jsx(Pe,{value:ue,onChange:t=>{k(t),x(t?.from??void 0),P(t?.to??void 0)},onClose:()=>R(!0),placeholder:"Select date range",disabled:!1})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(_e,{id:"show-completed",checked:S,onCheckedChange:t=>se(t),className:"rounded-full"}),e.jsx(Qe,{htmlFor:"show-completed",className:"cursor-pointer text-sm font-medium",children:"Show Repair Completed"})]})]}),U.length===0?e.jsx("div",{children:e.jsx(qe,{children:e.jsxs($e,{children:[e.jsx(We,{variant:"icon",children:e.jsx(Ye,{className:"h-4 w-4"})}),e.jsx(He,{children:"No data to display"}),e.jsx(Ge,{children:I!==void 0?"This shop doesn’t have any repair orders yet. Repair orders will appear here once they are created.":"No results could be found."})]})})}):e.jsxs("div",{children:[e.jsx("div",{className:"bg-card overflow-hidden rounded-lg border shadow-sm",children:e.jsxs(Ue,{children:[e.jsx(ze,{children:e.jsxs(J,{className:"bg-muted",children:[e.jsx(c,{className:"text-foreground font-semibold",children:"RO #"}),e.jsx(c,{className:"text-foreground font-semibold",children:"Order #"}),e.jsx(c,{className:"text-foreground font-semibold",children:"VIN"}),e.jsx(c,{className:"text-foreground font-semibold",children:"Year/Make/Model"}),e.jsx(c,{className:"text-foreground font-semibold",children:"Status"}),e.jsx(c,{className:"text-foreground font-semibold",children:"Customer"}),e.jsx(c,{className:"text-foreground font-semibold",children:"Date Submitted"}),e.jsx(c,{className:"text-foreground font-semibold",children:"Date Completed"})]})}),e.jsx(Ke,{children:pe.map(t=>{const s=t,o=s.year&&s.make&&s.model?`${s.year} ${s.make} ${s.model}`:"--";return e.jsxs(J,{className:"hover:bg-muted/50",children:[e.jsx(p,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[ve(s),e.jsx("span",{className:"cursor-pointer text-blue-600 hover:underline",onClick:()=>{V({to:"/repair_orders/$id",params:{id:s.id.toString()}})},children:s.roNumber||"--"})]})}),e.jsx(p,{children:e.jsx("div",{className:"space-y-1",children:s.salesOrderNumber?e.jsx("div",{children:s.salesOrderNumber}):e.jsx("div",{children:"--"})})}),e.jsx(p,{className:"font-mono text-sm",children:s.vin||"--"}),e.jsx(p,{children:o}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-1 text-sm",children:[s.statusCounts.DealershipShipped>1&&e.jsxs("div",{children:["Dealer Shipped (",s.statusCounts.DealershipShipped,")"]}),s.statusCounts.DealershipShipped===1&&e.jsx("div",{children:"Dealer Shipped"}),s.statusCounts.ShopReceived>1&&e.jsxs("div",{children:["Shop Received (",s.statusCounts.ShopReceived,")"]}),s.statusCounts.ShopReceived===1&&e.jsx("div",{children:"Shop Received"}),s.statusCounts.CsrReview>1&&e.jsxs("div",{children:["CSR Review (",s.statusCounts.CsrReview,")"]}),s.statusCounts.CsrReview===1&&e.jsx("div",{children:"CSR Review"}),s.statusCounts.CsrRejected>1&&e.jsxs("div",{children:["CSR Rejected (",s.statusCounts.CsrRejected,")"]}),s.statusCounts.CsrRejected===1&&e.jsx("div",{children:"CSR Rejected"}),s.statusCounts.DealershipProcessing>1&&e.jsxs("div",{children:["Dealer Processing (",s.statusCounts.DealershipProcessing,")"]}),s.statusCounts.DealershipProcessing===1&&e.jsx("div",{children:"Dealer Processing"}),s.statusCounts.RepairCompleted>1&&e.jsxs("div",{children:["Repair Completed (",s.statusCounts.RepairCompleted,")"]}),s.statusCounts.RepairCompleted===1&&e.jsx("div",{children:"Repair Completed"}),Object.values(s.statusCounts).every(n=>n===0)&&e.jsx("div",{children:"--"})]})}),e.jsx(p,{children:s.customer||"--"}),e.jsx(p,{children:f(s.dateLastSubmitted)}),e.jsx(p,{className:"text-muted-foreground",children:f(s.dateClosed)})]},s.id||s.roNumber)})})]})}),e.jsx(Je,{currentPage:g,totalPages:Z,totalItems:T,itemsPerPage:j,onPageChange:K})]})]})]})}function Ws(){const{isAuthenticated:r,isLoading:h}=Te(),x=Q();return h||!r?e.jsx(Le,{}):x.pathname==="/repair_orders"?e.jsx(rs,{}):e.jsx(Oe,{})}export{Ws as component};
