import{h as ce,r as a,b as me,p as ue,j as e,B as he,C as pe,q as k,w as xe,P as fe,t as B,x as je}from"./index-DiI2ffAh.js";import{H as ge}from"./header-only-layout-Cpt2MNT6.js";import{O as Se}from"./OrderApi-C0c8zPF8.js";import{B as ve}from"./badge-CmxtL1uP.js";import{C as ye}from"./checkbox-DnhwHROs.js";import{E as be,a as Ne,b as Ce,T as Oe,c as Te,d as De,D as Re}from"./data-table-pagination-BYSKvq0r.js";import{I as Pe}from"./input-anrjtq5m.js";import{L as we}from"./form-BztM4JIr.js";import{S as T,a as D,b as R,c as P,d as r}from"./select-BfIdXsKN.js";import{T as Ie,a as Be,b as w,c as i,d as Ee,e as o}from"./table-DfggTbkb.js";import{T as Le,a as $e,b as Ae,c as Fe}from"./tooltip-D0HhMqED.js";import{D as M}from"./date-picker-C8C4Gnlb.js";import{D as ke}from"./download-CTZAi_Qa.js";import{S as Me}from"./search-Dee6z3yd.js";import{u as Ve}from"./use-authenticated-DyXd3Kpo.js";import{L as qe}from"./Loading-QGL_XBaH.js";import"./header-BJ4bOhv6.js";import"./PersonApi-CgbCoTOu.js";import"./dropdown-menu-DS9Dg1PJ.js";import"./index-B9OW1ajA.js";import"./index-BesrJGlS.js";import"./Combination-D_vfDq5J.js";import"./index-B0ORnztA.js";import"./index-lW_6OgVn.js";import"./index-DTR4e_QT.js";import"./check-Ca0fbDYF.js";import"./chevron-right-B2dPWAbi.js";import"./dialog-BfbMbQ8-.js";import"./x-DoFJH5Nd.js";import"./separator-unOUWFl-.js";import"./search-provider-DE3XVmHF.js";import"./command-CWvopmmU.js";import"./building-2-Buu7Mufq.js";import"./scroll-area-CFguzc3f.js";import"./index-DHosPbdR.js";import"./index-I18K8_cQ.js";import"./chevron-left-CVoIS1tR.js";import"./chevron-down-kGCTDs5u.js";import"./popover-DSwKj0iH.js";function He(){const{user:d}=ce(t=>t.auth),[p,V]=a.useState(!0),[j,E]=a.useState(void 0),[g,L]=a.useState(void 0),[u,q]=a.useState("7"),[S,H]=a.useState("all"),[x,Y]=a.useState("all"),[v,Q]=a.useState("all"),[N,$]=a.useState(1),[y,U]=a.useState(""),[C,W]=a.useState([]),[A,_]=a.useState(0),[z,b]=a.useState(!1),f=20,G=Math.ceil(A/f),J=me(),I=a.useRef(null),[K,X]=a.useState([]),Z=()=>{const t=(N-1)*f,s=t+f;return C.slice(t,s).map(l=>{const n=l.repairOrder||{},m=n.shop||{},c=n.dealership||{};return{"RO#":n.roNumber||"--","Sales#":l.salesOrderNumber||"--",Type:F(l.partsOrderNumber||0),VIN:n.vin||"--","Year/Make/Model":[n.year,n.make,n.model].filter(Boolean).join(" ")||"--",Status:l.status||"--",Shop:m.name?`${m.name} (${m.id})`:"--",Dealer:c.name?`${c.name} (${c.id})`:"--","CSR Region":n.region||"--","Date Completed":O(l.dateCreated),"Date Closed":O(n.dateClosed)||"--"}})},ee=async()=>{try{const t=Z();await je(t,K)&&B.success("Exported successfully")}catch{B.error("Export failed")}};a.useEffect(()=>{if(I.current){const t=I.current.querySelectorAll("thead th"),s=Array.from(t).map(h=>h.textContent.trim());X(s)}},[C]);const te=t=>t.includes("Review")||t.includes("Rejected")?"destructive":t.includes("Shipped")||t.includes("Completed")?"default":t.includes("Received")?"secondary":t.includes("Processing")?"outline":"secondary",se=async()=>{if(d){b(!0);try{const t=new Se,s=j?k(j):void 0,h=g?k(g):void 0,l={smartFilter:y,filterByWaitingOnMe:p,filterByDealershipId:d?.person?.type==="Dealership"?d?.person?.dealership.id:void 0};S!=="all"&&(l.filterByPartsOrderNumber=parseInt(S)),x!=="all"&&(l.filterByStatus=x),v!=="all"&&(l.filterByRegionId=parseInt(v));const n=xe.create({resultsLimitOffset:(N-1)*f,resultsLimitCount:f,resultsOrderBy:"dateSubmitted",resultsOrderAscending:!1});l.resultParameter=n;const m=fe.create(l);s&&(m.dateSubmittedFrom=s),h&&(m.dateSubmittedTo=h),t.partsOrderSearch(m,{status200:c=>{W(c.partOrders||[]),_(c.totalItemCount||0),b(!1)},error:c=>{B.error(`Error: ${c||"Failed to fetch data"}`),b(!1)},else:()=>{b(!1)}})}catch{b(!1)}}};a.useEffect(()=>{if(!d)return;const t=setTimeout(()=>{se()},y?500:0);return()=>clearTimeout(t)},[y,p,S,x,v,u,j,g,N,d]),a.useEffect(()=>{$(1)},[y,p,S,x,v,u,j,g]),a.useEffect(()=>{if(u!=="custom"){const{from:t,to:s}=ue(u);E(t),L(s)}},[u]);const O=t=>{if(!t)return"--";const s=typeof t=="string"?new Date(t):t;return isNaN(s.getTime())?"--":s.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"})},F=t=>t===0?"Parts Order":t===1?"Supplement 1":t===2?"Supplement 2":`Supplement ${t}`;return e.jsx("div",{className:"min-h-scree",children:e.jsxs("div",{className:"bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("h1",{className:"text-foreground text-2xl font-bold",children:"Parts Order List"}),e.jsxs(he,{onClick:ee,children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Report"]})]}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 lg:flex-row lg:items-center",children:[e.jsxs("div",{className:"relative max-w-md flex-1",children:[e.jsx(Me,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(Pe,{value:y,onChange:t=>U(t.target.value),placeholder:"Filter by RO#, Sales Order #, VIN, Shop, Dealer",className:"pl-10"})]}),d?.person?.type==="Csr"||d?.person?.type==="FieldStaff"&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{id:"my-orders",checked:p,onCheckedChange:t=>V(t),className:"bg-muted rounded-full"}),e.jsx(we,{htmlFor:"my-orders",className:"flex cursor-pointer items-center gap-2 text-sm font-medium",children:"Only View Parts Orders that are waiting On Me"})]})]}),e.jsxs("div",{className:"mb-6 flex flex-wrap items-center gap-3",children:[e.jsxs(T,{value:S,onValueChange:t=>H(t),children:[e.jsx(D,{className:"bg-muted w-48",children:e.jsx(R,{placeholder:"Type of Order"})}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"All Types"}),e.jsx(r,{value:"0",children:"original Parts Order"}),e.jsx(r,{value:"1",children:"Supplement #1"}),e.jsx(r,{value:"2",children:"Supplement #2"}),e.jsx(r,{value:"3",children:"Supplement #3"})]})]}),e.jsxs(T,{value:x,onValueChange:t=>Y(t),children:[e.jsx(D,{className:"bg-muted w-48",children:e.jsx(R,{placeholder:"Status"})}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"csr-Review",children:"CSR Review"}),e.jsx(r,{value:"csr-rejected",children:"CSR Rejected"}),e.jsx(r,{value:"dealer-processing",children:"Dealer Processing"}),e.jsx(r,{value:"dealer-shipped",children:"Dealer Shipped"}),e.jsx(r,{value:"shop-received",children:"Shop Received"}),e.jsx(r,{value:"repair-completed",children:"Repair Completed"})]})]}),e.jsxs(T,{value:v,onValueChange:t=>Q(t),children:[e.jsx(D,{className:"bg-muted w-48",children:e.jsx(R,{placeholder:"CSR Region"})}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"All Regions"}),d?.regions?.map(t=>e.jsx(r,{value:t.id?.toString()||"",children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Date Submitted Range"}),e.jsxs(T,{value:u,onValueChange:t=>q(t),children:[e.jsx(D,{className:"bg-muted w-48",children:e.jsx(R,{placeholder:"ALL Dates"})}),e.jsxs(P,{children:[e.jsx(r,{value:"7",children:"Past 7 days"}),e.jsx(r,{value:"30",children:"Past 30 Days"}),e.jsx(r,{value:"month-to-date",children:"Month-To-Date"}),e.jsx(r,{value:"quarter-to-date",children:"Quarter-To-Date"}),e.jsx(r,{value:"year-to-date",children:"Year-To-Date"}),e.jsx(r,{value:"last-month",children:"Last Month"}),e.jsx(r,{value:"last-quarter",children:"Last Quarter"}),e.jsx(r,{value:"last-year",children:"Last Year"}),e.jsx(r,{value:"custom",children:"Custom"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"From"}),e.jsx(M,{disabled:u!=="custom",selected:j,onSelect:t=>E(t),placeholder:"Select from date"}),e.jsx("span",{className:"text-sm font-medium",children:"To"}),e.jsx(M,{disabled:u!=="custom",selected:g,onSelect:t=>L(t),placeholder:"Select to date"})]})]}),e.jsx("div",{className:"bg-background overflow-hidden rounded-lg border shadow-sm",children:e.jsxs(Ie,{ref:I,children:[e.jsx(Be,{children:e.jsxs(w,{className:"bg-muted",children:[e.jsx(i,{className:"text-foreground font-semibold",children:"RO#"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Sales#"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Type"}),e.jsx(i,{className:"text-foreground font-semibold",children:"VIN"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Year/Make/Model"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Status"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Shop"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Dealer"}),e.jsx(i,{className:"text-foreground font-semibold",children:"CSR Region"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Date Completed"}),e.jsx(i,{className:"text-foreground font-semibold",children:"Date Closed"})]})}),e.jsx(Ee,{children:z?e.jsx(w,{children:e.jsx(o,{colSpan:11,className:"py-8 text-center",children:"loading..."})}):C.length===0?e.jsx(w,{children:e.jsx(o,{colSpan:11,className:"py-8 text-center",children:e.jsx(be,{children:e.jsxs(Ne,{children:[e.jsx(Ce,{variant:"icon",children:e.jsx(Oe,{className:"h-4 w-4"})}),e.jsx(Te,{children:"No data to display"}),e.jsx(De,{children:"There are no records in this table yet. Add your first entry to get started."})]})})})}):C.map(t=>{const s=t.repairOrder,h=s?.roNumber||"--",l=t.salesOrderNumber||"--",n=F(t.partsOrderNumber||0),m=s?.vin||"--",c=s&&`${s.year||""} ${s.make||""} ${s.model||""}`.trim()||"--",re=t.status||"--",ae=s?.shop?`${s.shop.name||""} (${s.shop.id||""})`:"--",le=s?.dealership?`${s.dealership.name||""} (${s.dealership.id||""})`:"--",ne=s?.region||"--",oe=O(t.dateCreated),ie=O(s?.dateClosed),de=s?.orderFromAlternateDealership||!1;return e.jsxs(w,{className:"hover:bg-muted/50",children:[e.jsx(o,{className:"cursor-pointer text-blue-600 hover:underline",onClick:()=>{J({to:"/repair_orders/$id",params:{id:t.repairOrder.id.toString()}})},children:h}),e.jsx(o,{children:l}),e.jsx(o,{children:n}),e.jsx(o,{className:"font-mono text-xs",children:m}),e.jsx(o,{children:c}),e.jsx(o,{children:e.jsx(ve,{variant:te(x),className:"whitespace-nowrap",children:re})}),e.jsx(o,{className:"text-sm",children:ae}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[de&&e.jsx(Le,{children:e.jsxs($e,{children:[e.jsx(Ae,{asChild:!0,children:e.jsx(pe,{className:"h-4 w-4 cursor-help text-yellow-600"})}),e.jsx(Fe,{children:e.jsx("p",{children:"Ordered from an alternate dealer"})})]})}),e.jsx("span",{className:"text-sm",children:le})]})}),e.jsx(o,{children:ne}),e.jsx(o,{children:oe}),e.jsx(o,{children:ie||"--"})]},t.id)})})]})}),e.jsx(Re,{currentPage:N,totalPages:G,totalItems:A,itemsPerPage:f,onPageChange:$})]})]})})}function Rt(){const{isAuthenticated:d,isLoading:p}=Ve();return p||!d?e.jsx(qe,{}):e.jsx(ge,{children:e.jsx(He,{})})}export{Rt as component};
