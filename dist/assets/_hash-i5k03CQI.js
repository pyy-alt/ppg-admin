import{b as I,r as l,aI as L,i as E,t,A as k,j as s,m as U,B as q,aN as H}from"./index-Bkm0i40-.js";import{I as o}from"./input-DaKq_e4d.js";import{L as i}from"./label-BN8Qe8K3.js";import{L as z}from"./Loading-Z72NCMiE.js";import{H as B,U as M,L as V}from"./header-Vf3flhB_.js";import{S as $}from"./ViewTeamDialog-CoFVDWax.js";import{M as O}from"./map-pin-Dk4q35Vy.js";import{E as P,a as S}from"./eye-BEY6uIFQ.js";import"./index-CnmrjRy4.js";import"./PersonApi-BZdXp9je.js";import"./dropdown-menu-BJ11OL3K.js";import"./index-Dt-JkpPh.js";import"./Combination-K-YKTF--.js";import"./index-CN5U3HPo.js";import"./index-CM-w1TYN.js";import"./index-B51CDgwY.js";import"./index-BeLrdImO.js";import"./index-tCO809zo.js";import"./check-BRFXV1aI.js";import"./chevron-right-C97o7tEJ.js";import"./form-FwhVnNbA.js";import"./dialog-DSGLXfvZ.js";import"./x-CsoNbFna.js";import"./separator-Bthd58uT.js";import"./users-uvAbHv3x.js";import"./badge-MEVRXxP2.js";function D(){const w=I(),[d,m]=l.useState(!1),[a,b]=l.useState({email:"",firstName:"",lastName:"",shopName:"",shopNumber:"",shopAddress:"",password:"",confirmPassword:""}),{id:f,hash:x,guid:g}=L({from:"/registration/complete/$id/$guid/$hash"}),[u,C]=l.useState(!1),[p,A]=l.useState(!1),[F,h]=l.useState(!0),v=new k,{auth:N}=E(),j=l.useRef(!1);l.useEffect(()=>{if(!j.current){if(!f||!g||!x){t.error("Invalid registration link parameters."),h(!1);return}j.current=!0,v.sessionCreate(f,g,x,{status200:e=>{if(e){N.setUser(e);const r=e.person?.shop||e.person?.dealership,c=[r?.address,r?.city,r?.state,r?.zip].filter(Boolean).join(", ");b({email:e.person?.email||"",firstName:e.person?.firstName||"",lastName:e.person?.lastName||"",shopName:r?.name||"",shopNumber:e.person?.shop?.shopNumber||e.person?.dealership?.dealershipNumber||"",shopAddress:c||"",password:"",confirmPassword:""})}h(!1)},status404:()=>{t.error("Registration link is invalid or has expired."),h(!1)},error:()=>{t.error("Failed to validate reset link. Please try again."),h(!1),j.current=!1}},null)}},[f,g,x]);const y=(e,r)=>{b(n=>({...n,[e]:r}))},R=async e=>{if(e.preventDefault(),a.password!==a.confirmPassword){t.error("Passwords do not match.");return}if(a.password.length<8){t.error("Password must be at least 8 characters.");return}m(!0);try{const r=H.create({firstName:a.firstName,lastName:a.lastName,newPassword:a.password});v.registrationComplete(r,{status200:()=>{N.reset(),t.success("Registration completed successfully!"),w({to:"/login",replace:!0}),m(!1)},status409:()=>{m(!1)},error:n=>{const c=n?.message||String(n);if(c.includes("JSON.parse")||c.includes("unexpected character")||c.includes("successful operation")){N.reset(),t.success("Registration completed successfully!"),w({to:"/login",replace:!0}),m(!1);return}m(!1)}})}catch{t.error("Failed to reset password. Please try again."),m(!1)}};return F?s.jsx(z,{}):s.jsxs("div",{className:"bg-background flex min-h-screen flex-col",children:[s.jsx(B,{isShowUser:!1}),s.jsx("div",{className:"bg-primary text-primary-foreground relative mt-12 h-32 lg:h-40",children:s.jsx("img",{src:U,alt:"New Shop User Registration",className:"absolute inset-0 h-full w-full object-cover opacity-70",loading:"lazy"})}),s.jsx("div",{className:"flex flex-1 items-start justify-center px-4 py-8 lg:py-12",children:s.jsxs("form",{onSubmit:R,className:"w-full max-w-4xl space-y-10",children:[s.jsxs("section",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(M,{className:"text-foreground h-6 w-6"}),s.jsx("h2",{className:"text-foreground text-xl font-semibold",children:"Personal Information"})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"email",className:"text-foreground text-sm font-medium",children:"Email"}),s.jsx(o,{id:"email",type:"email",value:a.email,className:"bg-muted h-12 rounded-lg",disabled:!0})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"firstName",className:"text-foreground text-sm font-medium",children:"First Name"}),s.jsx(o,{id:"firstName",value:a.firstName,className:"bg-muted h-12 rounded-lg",disabled:!0})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"lastName",className:"text-foreground text-sm font-medium",children:"Last Name"}),s.jsx(o,{id:"lastName",value:a.lastName,className:"bg-muted h-12 rounded-lg",disabled:!0})]})]})]})]}),s.jsxs("section",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx($,{className:"text-foreground h-6 w-6"}),s.jsx("h2",{className:"text-foreground text-xl font-semibold",children:"Shop Information"})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"shopName",className:"text-foreground text-sm font-medium",children:"Name"}),s.jsx(o,{id:"shopName",value:a.shopName,className:"bg-muted h-12 rounded-lg",disabled:!0})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"shopNumber",className:"text-foreground text-sm font-medium",children:"Number"}),s.jsx(o,{id:"shopNumber",value:a.shopNumber,className:"bg-muted h-12 rounded-lg",disabled:!0})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"shopAddress",className:"text-foreground text-sm font-medium",children:"Address"}),s.jsxs("div",{className:"relative",children:[s.jsx(O,{className:"text-muted-foreground absolute top-3.5 left-3 h-5 w-5"}),s.jsx(o,{id:"shopAddress",value:a.shopAddress,className:"bg-muted h-12 rounded-lg pl-11",disabled:!0})]})]})]}),s.jsxs("section",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(V,{className:"text-foreground h-6 w-6"}),s.jsx("h2",{className:"text-foreground text-xl font-semibold",children:"Password"})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"password",className:"text-foreground text-sm font-medium",children:"Password"}),s.jsxs("div",{className:"relative",children:[s.jsx(o,{id:"password",type:u?"text":"password",placeholder:"Enter your password",className:"h-12 rounded-lg focus:border-cyan-500 focus:ring-2 focus:ring-cyan-100",value:a.password,onChange:e=>y("password",e.target.value),required:!0,disabled:d}),s.jsx("button",{type:"button",onClick:()=>C(!u),className:"text-muted-foreground hover:text-foreground absolute top-1/2 right-3 -translate-y-1/2 transition-colors",disabled:d,"aria-label":u?"Hide password":"Show password",children:u?s.jsx(P,{className:"h-5 w-5"}):s.jsx(S,{className:"h-5 w-5"})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"confirmPassword",className:"text-foreground text-sm font-medium",children:"Confirm Password"}),s.jsxs("div",{className:"relative",children:[s.jsx(o,{id:"confirmPassword",type:p?"text":"password",placeholder:"Confirm your password",className:"h-12 rounded-lg pr-12 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-100",value:a.confirmPassword,onChange:e=>y("confirmPassword",e.target.value),required:!0,disabled:d}),s.jsx("button",{type:"button",onClick:()=>A(!p),className:"text-muted-foreground hover:text-foreground absolute top-1/2 right-3 -translate-y-1/2 transition-colors",disabled:d,"aria-label":p?"Hide password":"Show password",children:p?s.jsx(P,{className:"h-5 w-5"}):s.jsx(S,{className:"h-5 w-5"})})]})]})]})]}),s.jsx("div",{className:"flex justify-end pt-6",children:s.jsx(q,{type:"submit",variant:"default",className:"h-12 rounded-full px-8 font-medium shadow-md transition-all",disabled:d,children:d?"Completing...":"Complete Registration"})})]})})]})}const xs=D;export{xs as component};
